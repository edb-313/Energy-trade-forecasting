'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1512:function(F,K,c){c.r(K);c.d(K,"RtcUtils",function(){return k});F=c(0);var l=c(7),f=c(1542),a=c(35);class k{static h7e(x,y=f.RealtimeChannel.KMf){let n;try{n=a.c(x)}catch(u){throw x=String.format("Failed to JSON-serialize payload : {0}",u),l.ULS.sendTraceTag(18637072,500,10,x),Error.argument("payload",x);}if(n.length>y)throw x=String.format("Payload exceeds maximum length: {0} > {1}.",n.length,y),l.ULS.sendTraceTag(18637074,
500,10,x),Error.argument("payload",x);return n}static deserialize(x,y,n){if(!x)return null;if(Object.getType(x)!==String){var u=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",y,Object.getType(x).getName(),n);l.ULS.sendTraceTag(18637075,500,10,u);return null}u=null;try{u=a.a(x)}catch(z){x=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",y,z,n),l.ULS.sendTraceTag(18637077,
500,10,x)}return u}static Iec(x){if(!x)return"";if("string"===typeof x)return x.toString();try{return a.c(x)}catch(y){return x.toString()}}static gAl(x){let y,n,u;y=0;u=n=null;if(!x)return{epi:y,gpi:n,exception:u};try{const z=x.source;z&&Object.getType(z)===String&&(u=z);const w=x.context;w&&(x=w,y=x.status?x.status:0,n=x.statusText?x.statusText:null)}catch(z){}return{epi:y,gpi:n,exception:u}}}Object(F.a)(k,"RtcUtils",null,[])},1532:function(F,K,c){c.r(K);F=c(0);var l=c(7),f=c(55),a=c(82),k;(function(u){u[u.SendNotification=
0]="SendNotification";u[u.SendPersistentState=1]="SendPersistentState";u[u.FindSession=2]="FindSession";u[u.Last=3]="Last"})(k||(k={}));Object(F.b)("ApiType",k);var x;(function(u){u[u.AttemptCount=0]="AttemptCount";u[u.SuccessCount=1]="SuccessCount";u[u.DropCount=2]="DropCount";u[u.FailedCount=3]="FailedCount";u[u.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";u[u.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";u[u.ThrottledCount=6]="ThrottledCount";u[u.Last=7]="Last"})(x||(x=
{}));Object(F.b)("EventCountType",x);var y=c(1632);c.d(K,"FrequentLoggingMetrics",function(){return n});class n{constructor(u){this.PHh=this.U_h=null;this.PNi=this.P2h=0;this.Wt=null;this.Z5g=this.TJe=0;this.Xf=u;this.rAm();this.GAe=this.KVg=this.CKe=!1;this.Uwc=0}get yzl(){return this.GAe}pDo(u){this.Z5g=u;window.setInterval(Object(f.a)(this,this.WKf,"logMetricsBatchAndReset"),u);this.TJe=(new Date).getTime()}VO(u,z){this.Xro(u)&&!this.KVg||this.yzl||!window.navigator.onLine||this.Xf.qQa||(this.Wt[u][z]++,
this.CKe=!0)}rAm(){this.Wt=Array(3);for(let u=0;3>u;u++){this.Wt[u]=Array(7);for(let z=0;7>z;z++)this.Wt[u][z]=0}}LOk(){const u={};for(let z=0;3>z;z++)for(let w=0;7>w;w++)this.KVm(z,w)&&(u[k[z]+x[w]]=this.Wt[z][w]);u.FSDomain=this.U_h;u.ConnectionDomain=this.PHh;u.FSRetryInterval=this.P2h;u.MaxPayloadSize=this.PNi;u.LogNumber=this.Uwc;1===this.Uwc&&(u.FSLatencies=y.a.instance.zXl(),u.ConLatencies=y.a.instance.gSl());return u}KVm(u,z){return 2===u&&3!==z&&0!==z?!1:!0}Xro(u){return 2===u?!1:!0}WKf(){if(this.CKe){this.Uwc++;
if((new Date).getTime()-this.TJe<5E3+this.Z5g){var u=a.a.toJSON(this.LOk());l.ULS.sendTraceTag(50644352,500,15,u)}this.TJe=(new Date).getTime();for(u=0;3>u;u++)for(let z=0;7>z;z++)this.Wt[u][z]=0;this.CKe=!1}}Ean(){this.KVg=!0}static get instance(){return n._instance}static create(u){n.instance||(n._instance=new n(u));return n.instance}}n._instance=null;Object(F.a)(n,"FrequentLoggingMetrics",null,[875])},1542:function(F,K,c){c.r(K);F=c(0);var l=c(7),f=c(55),a=c(457),k=c(873),x=c(77),y=c(2);class n{constructor(ya,
Ga){this.status=ya;this.Scc=Ga}}Object(F.a)(n,"UserStatusInfo",null,[]);var u=c(57),z=c(1632);class w{constructor(ya,Ga){this.data=ya;this.timeStamp=Ga}}Object(F.a)(w,"PresenceData",null,[]);class E{constructor(ya){this.JBa=!1;this.pyb=0;this.Dwe=!1;this.setTimeout=E.Edf;this.clearTimeout=E.xdf;this.T8m=Object(f.a)(this,this.H7m,"logRtcConnectingUsageStatement");this.Hw=ya}Ann(){this.JBa||(this.pyb=this.setTimeout(()=>{this.JBa=!1;this.dLi()},8E3),this.JBa=!0,this.Dwe=!1)}von(){this.g_()}Cvn(){this.dLi()}dLi(){this.g_();
this.Dwe||(this.Dwe=!0,this.T8m())}H7m(){l.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Hw)}g_(){this.JBa&&this.clearTimeout(this.pyb);this.pyb=0;this.JBa=!1}static Edf(ya,Ga){return window.setTimeout(ya,Ga)}static xdf(ya){window.clearTimeout(ya)}}Object(F.a)(E,"ConnectedUsageKpiLogger",null,[898]);class G{constructor(){this.W7i=this.x3f;this.Z7i=this.A3f;this.Y7i=this.z3f;this.c8i=this.C3f;this.b8i=this.B3f;this.N3f=this.O3f;this.X3c=this.L3f;this.LMb=
this.J3f;this.MMb=this.K3f;this.X7i=this.y3f;this.uRa=this.MQf;this.Klb=this.NQf}x3f(){}A3f(){}z3f(){}C3f(){}B3f(){}L3f(){}K3f(){}J3f(){}O3f(){}y3f(){}MQf(){}NQf(){}}Object(F.a)(G,"NoopRealtimeChannelMetrics",null,[886,200]);class H{}H.pbd="presenceUpdated";H.updateNotification="updateNotification";H.V1i="persistentStateCleared";H.updatePersistentState="persistentStateUpdated";Object(F.a)(H,"RtcClientMethodNames",null,[]);class L{}L.dvm="realtimeChannelHub";L.pbd="UpdatePresence";L.bN="SendUpdateNotification";
L.Kof="GetCompletePersistentStateWithMetadata";L.updatePersistentState="UpdatePersistentState";L.sqb="UpdateClientInfo";Object(F.a)(L,"RtcHubMethodNames",null,[]);class I{constructor(ya){this.dw=ya}hYn(ya){this.dw.on(H.pbd,ya)}bZn(ya){this.dw.on(H.updateNotification,ya)}gYn(ya){this.dw.on(H.updatePersistentState,ya)}fYn(ya){this.dw.on(H.V1i,ya)}lTo(ya){this.dw.off(H.pbd,ya)}vTo(ya){this.dw.off(H.updateNotification,ya)}kTo(ya){this.dw.off(H.updatePersistentState,ya)}jTo(ya){this.dw.off(H.V1i,ya)}pbd(ya){return this.dw.invoke(L.pbd,
ya)}sqb(ya){return this.dw.invoke(L.sqb,ya)}bN(ya,Ga){return this.dw.invoke(L.bN,ya,Ga)}Kof(ya){return this.dw.invoke(L.Kof,ya)}updatePersistentState(ya,Ga){return this.dw.invoke(L.updatePersistentState,ya,Ga)}}Object(F.a)(I,"RealtimeChannelProxy",null,[892,893,894]);class N{constructor(){this.aue=this.JMg=!1;this.Zte=0;this.Tve=this.wSe=this.vSe=this.bte=!1;this.gBe=0;this.heh=!1;this.geh=this.feh=0;this.SQe=!1;this.ZQe=this.XQe=this.aRe=this.TQe=0;this.YQe=!1}get RJk(){return this.aue}get QJk(){return this.Zte}get lCk(){return this.bte}get Bto(){return this.vSe}get Cto(){return this.wSe}get i_k(){return this.Tve}get wMd(){return this.gBe}get L$n(){return this.heh}get mgj(){return this.feh}get K$n(){return this.geh}get G$n(){return this.SQe}get H$n(){return this.TQe}get sgj(){return this.aRe}get ngj(){return this.XQe}get pgj(){return this.ZQe}get ogj(){return this.YQe}static createInstance(ya){const {RealtimeChannel:Ga}=
c(1542);return ya?Object.assign(new N,{JMg:ya.$("AwayStatusManagerIsEnabled"),aue:ya.$("AwayStatusOneMinuteTimeoutIsEnabled"),Zte:ya.mc("AwayCoauthorThresholdMs",9E5),bte:ya.$("RtcAllowCrossDomainAccessEnabled"),vSe:ya.$("ShouldLogOnContentNotification"),wSe:ya.$("ShouldLogOnHostSubscriptionNotification"),Tve:ya.$("RtcClientMetricsEnabled"),gBe:ya.mc("RtcFindSessionRequestTimeoutInMS",6E4),heh:ya.$("RtcJsClientFrequentlyLogsMetrics"),feh:ya.mc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),
geh:ya.mc("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),SQe:ya.$("RtcClientMessageTelemetryEnabled"),TQe:ya.mc("RtcClientMessageTelemetrySampleSize",5),aRe:ya.mc("RtcSendTelemetryMessageIntervalInMS",3E5),XQe:ya.mc("RtcLogClientMessageMetricsTimeOutInMs",2E4),ZQe:ya.mc("RtcMaxPayloadSizeInCharactersOverride",Ga.KMf),YQe:ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new N,{JMg:!1,aue:!1,Zte:9E5,bte:!1,vSe:!1,wSe:!0,Tve:!1,gBe:9E4,SQe:!1,
TQe:5,aRe:3E5,XQe:2E4,ZQe:Ga.KMf,YQe:!1})}}Object(F.a)(N,"RealtimeChannelSettings",null,[891]);var Q=c(1762),M=c(67),J=c(148);class V{constructor(ya){this.qCc=null;this.RSa=0;this.eDb=!1;this.Hm=ya;this.Hm.Kta(Object(f.a)(this,this.Zha,"onConnectionStateChanged"))}Zha(ya,Ga){this.RSa=Ga.newState}iwn(){l.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Hm.Ice()}Oym(ya){this.qCc.init(ya)}}Object(F.a)(V,"ARtcMessageHandler",null,[]);var X=c(352);class W{constructor(){this.Presence=
null;this.TimeStamp=0}}Object(F.a)(W,"PresenceDataEntryForClients",null,[]);var U=c(82);class Y{constructor(ya,Ga=""){this.hjk=ya;this.Dsa=Ga}send(){return this.hjk()}get messageId(){return this.Dsa}}Object(F.a)(Y,"MessageHandler",null,[903]);var ba=c(1661);class aa extends Sys.EventArgs{constructor(ya,Ga,wa,hb){super();this.Z6f=ya;this.reconnectDelay=Ga;this.reason=wa;this.o$f=hb}}Object(F.a)(aa,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var fa=c(1717);class na{constructor(){this.QTe=this.gi=
null}get si(){return this.gi?this.QTe?this.QTe.getTime()-this.gi.getTime():(new Date).getTime()-this.gi.getTime():0}start(){this.gi=new Date}stop(){this.QTe=new Date}}Object(F.a)(na,"SimpleStopwatch",null,[]);var oa=c(1718),ja;(function(ya){ya[ya.contentUpdate=0]="contentUpdate";ya[ya.editorsTableUpdate=1]="editorsTableUpdate";ya[ya.fileNameUpdate=2]="fileNameUpdate";ya[ya.wetContentUpdate=3]="wetContentUpdate";ya[ya.persistedContentUpdate=4]="persistedContentUpdate";ya[ya.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";ya[ya.replicationTelemetry=6]="replicationTelemetry";ya[ya.lockUpdate=7]="lockUpdate";ya[ya.collabServiceContentUpdate=8]="collabServiceContentUpdate";ya[ya.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";ya[ya.saveTargetUpdate=10]="saveTargetUpdate";ya[ya.uploadToOcsUpdate=11]="uploadToOcsUpdate";ya[ya.labelUpdate=12]="labelUpdate";ya[ya.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";ya[ya.subscribeOrExtend=14]="subscribeOrExtend";
ya[ya.elapsedBootTelemetry=15]="elapsedBootTelemetry";ya[ya.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";ya[ya.clientToClientResponseMessage=17]="clientToClientResponseMessage";ya[ya.verifyNotificationPipeline=18]="verifyNotificationPipeline";ya[ya.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";ya[ya.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";ya[ya.last=21]="last"})(ja||(ja={}));Object(F.b)("UpdateNotificationType",ja);var qa=c(751),Ia=c(591),Va=c(592);
class Na extends V{constructor(ya,Ga,wa,hb,eb,jb,ub,ab,Ea,Wa){super(ub);this.dw=null;this.P5g=!1;this.Dsa=0;this.XNe=new J.a;this.R$j=Na.ISl();this.eNe=y.AFrameworkApplication.K.jb("OwningFeatureCrewForRtcNotificationKpis");this.Uf=ya;this.y8g=this.x8g=0;this.qCc=Ga;this.qCc.aAd(Object(f.a)(this,this.iwn,"onTooManyUndeliveredMessages"));this._clientId=wa;this.Ngk=eb;this.Hm.Gzk(Object(f.a)(this,this.Dtn,"onRefreshProxyRequired"));this.Hm.Ezk(Object(f.a)(this,this.Btn,"onRefreshAllPersistentStateRequest"));
this.Hm.Ozk(Object(f.a)(this,this.bN,"sendUpdateNotification"));this.Hm.Exk(Object(f.a)(this,this.Kqn,"onInternalPresenceUpdated"));this.Hm.Fxk(Object(f.a)(this,this.Lqn,"onInternalUpdateNotificationReceived"));this.Hm.Dxk(Object(f.a)(this,this.Jqn,"onInternalPersistentStateUpdated"));this.Hm.Cxk(Object(f.a)(this,this.Iqn,"onInternalPersistentStateCleared"));this.Hm.Mzk(Object(f.a)(this,this.Kic,"sendPersistentState"));this.Hm.bAk(Object(f.a)(this,this.sqb,"updateClientInfo"));this.ge=jb;this.Hw=
hb;this.Wt=ab;this.VV=Ea;this.qxc=Wa;this.Xda=Object(M.a)(String,y.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Dtn(ya,Ga){this.dw=this.Ngk(Ga.hubConnection);this.qCc.reset();this.dw.hYn(Object(f.a)(this,this.J4,"onPresenceUpdated"));this.dw.gYn(Object(f.a)(this,this.JRa,"onPersistentStateUpdated"));this.dw.fYn(Object(f.a)(this,this.ffc,"onPersistentStateCleared"));this.dw.bZn(Object(f.a)(this,this.A0,"onUpdateNotificationReceived"))}Zha(ya,Ga){this.RSa=Ga.newState;2===Ga.newState&&
this.ffo()}ffo(){for(let ya of this.XNe)this.bN(null,new fa.a(ya.key,ya.value,!1,new a.a));this.XNe=new J.a}Btn(ya,Ga){Ga.M7e();for(ya=0;3>ya;++ya)this.Heo(ya,Ga)}Heo(ya,Ga){try{this.dw.Kof(ya).done(wa=>{Ga.pnc(Ga.H9e,"GetCompletePresenceSuccess")&&(Ga.M4k.Cvn(),l.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.Hw),this.Hm.yPn(),this.Ksn(ya,wa),this.Hm.NOn(wa),Ga.AYh.mb(ya)&&this.Hm.V6i(ya,Ga.AYh.J(ya),new a.a))}).fail(wa=>{const {RtcUtils:hb}=c(1512);
Ga.pnc(Ga.H9e,"GetCompletePresenceFail")&&(l.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}]",hb.Iec(wa),this.Hw),this.Hm.Ice())}).always(()=>{Ga.WA&&Ga.WA.stop()})}catch(wa){l.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",Ga.H9e,wa.message)}}Kic(ya,Ga){var {RtcUtils:wa}=c(1512);ya=Ga.presence;let hb;const eb=
Ga.v7a;this.VV.VO(1,0);try{hb=wa.h7e(ya,this.qxc)}catch(ub){this.VV.VO(1,3);l.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",ub.message);eb.setException(ub);return}wa=new x.a;wa.Z(this._clientId,Object.assign(new W,{Presence:ya,TimeStamp:(new Date).getTime()}));this.Hm.b7i(Ga.type,wa);if(2!==this.RSa)this.Wt.LMb(),this.VV.VO(1,2),eb.Bg(null);else{var jb=this.Dsa.toString();++this.Dsa;ya=new Y(()=>this.hfo(Ga.type,hb,jb),jb);ya=this.vzj(0,
Ga.type).add(ya);ya.L7d(ub=>{2===ub&&this.VV.VO(1,6);eb.Bg(null)});ya.K7d(()=>{})}}hfo(ya,Ga,wa){let hb=null;const eb=new na,jb=new ba.a;l.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.Hw);if(2!==this.RSa)return this.Wt.LMb(),this.VV.VO(1,2),l.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.Hw),jb.vMf(),jb;this.ge&&20>this.x8g&&(hb=this.ge.Zf("WebServiceCall","Send Presence Message"),this.x8g++);eb.start();jb.TYc(1);try{this.dw.updatePersistentState(ya,
Ga).done(()=>{this.Wt.X3c();this.VV.VO(1,1);l.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",wa,this.Hw);jb.rlb(1);eb&&(eb.stop(),eb.si>this.Uf.mgj?this.VV.VO(1,4):this.VV.VO(1,5))}).fail(ub=>{const {RtcUtils:ab}=c(1512);this.eDb||(this.Wt.LMb(),this.VV.VO(1,3),l.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",wa,ab.Iec(ub),this.Hw));jb.rlb(2)}).always(()=>{hb&&hb.stop()})}catch(ub){l.ULS.sendTraceTag(593072906,
500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",ub.message),this.VV.VO(1,3),jb.rlb(2)}return jb}sqb(ya,Ga){({RtcUtils:ya}=c(1512));const wa=Ga.h_k,hb=Ga.v7a;let eb;try{eb=ya.h7e(wa,this.qxc)}catch(jb){l.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",jb.message);hb.setException(jb);return}try{this.dw.sqb(eb).done(()=>{l.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(jb=>{const {RtcUtils:ub}=
c(1512);this.eDb||l.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",ub.Iec(jb));hb.Bg(null)})}catch(jb){l.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",jb.message),hb.Bg(null)}}bN(ya,Ga){({RtcUtils:ya}=c(1512));const wa=Ga.type,hb=Ga.yL,eb=Ga.ull,jb=Ga.v7a;let ub;this.VV.VO(0,0);try{ub=ya.h7e(hb,this.qxc)}catch(Ea){this.VV.VO(0,3);l.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",
Ea.message);jb.setException(Ea);return}if(2!==this.RSa)eb?this.XNe.Z(wa,hb):(this.Wt.LMb(),this.VV.VO(0,2)),jb.Bg(null);else{var ab=this.Dsa.toString();++this.Dsa;Ga=new Y(()=>this.Xfo(wa,ub,ab),ab);Ga=this.vzj(1,wa).add(Ga);Ga.L7d(Ea=>{2===Ea&&this.VV.VO(0,6);jb.Bg(null)});Ga.K7d(()=>{})}}Xfo(ya,Ga,wa){let hb=null;const eb=new na,jb=new ba.a;l.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.Hw);if(2!==this.RSa)return this.Wt.LMb(),this.VV.VO(0,2),l.ULS.sendTraceTag(7934172,
500,15,"Connection is lost - unable to send the message for [{0}]",this.Hw),jb.vMf(),jb;this.ge&&3===ya&&20>this.y8g&&(hb=this.ge.Zf("WebServiceCall","Send WetContent Update"),this.y8g++);eb.start();jb.TYc(1);this.dw.bN(ya,Ga).done(()=>{this.Wt.X3c();this.VV.VO(0,1);l.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",wa,this.Hw);jb.rlb(1);eb&&(eb.stop(),eb.si>this.Uf.mgj?this.VV.VO(0,4):this.VV.VO(0,5))}).fail(ub=>{const {RtcUtils:ab}=c(1512);this.eDb||
(this.Wt.LMb(),this.VV.VO(0,3),l.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",wa,ab.Iec(ub),this.Hw));jb.rlb(2)}).always(()=>{hb&&hb.stop()});return jb}K5(){this.dw.lTo(Object(f.a)(this,this.J4,"onPresenceUpdated"));this.dw.kTo(Object(f.a)(this,this.JRa,"onPersistentStateUpdated"));this.dw.jTo(Object(f.a)(this,this.ffc,"onPersistentStateCleared"));this.dw.vTo(Object(f.a)(this,this.A0,"onUpdateNotificationReceived"))}Kqn(ya,Ga){this.J4(Ga.dra,
Ga.eJd)}J4(ya){this.Wt.MMb();this.JRa(0,ya)}Jqn(ya,Ga){this.JRa(Ga.type,Ga.dra)}Ksn(ya,Ga){const wa={};for(let hb in Ga)wa[hb]=Ga[hb].Presence;this.MWi(ya,wa,Ga)}JRa(ya,Ga){this.Wt.MMb();this.MWi(ya,Ga)}MWi(ya,Ga,wa=null){var {RtcUtils:hb}=c(1512);if(l.ULS.Y9(500,100))for(var eb in Ga);delete Ga[this._clientId];if(!U.a.isEmpty(Ga)){for(var jb in Ga)eb=jb,Ga[eb]=hb.deserialize(Ga[jb],"Presence",eb,!1,this.qxc);hb=new x.a;jb=(new Date).getTime();for(let ub in Ga){eb=Ga[ub];let ab=ub,Ea;wa?(Ea=wa[ab],
Ea.Presence=eb):Ea=Object.assign(new W,{Presence:eb,TimeStamp:jb});hb.Z(ab,Ea)}this.Hm.b7i(ya,hb);switch(ya){case 0:this.P5g||(l.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.Hw),this.P5g=!0,y.AFrameworkApplication.Lg&&y.AFrameworkApplication.Lg.xan());this.Hm.O6i(Ga,[]);break;default:this.Hm.oPn(ya,Ga)}}}Iqn(ya,Ga){this.ffc(Ga.jEd)}ffc(ya){this.Wt.MMb();if(l.ULS.Y9(500,100))for(let Ga=0;Ga<ya.length;++Ga);ya.length&&(this.Hm.OPn(ya),this.Hm.nPn(ya),this.Hm.O6i({},
ya))}Lqn(ya,Ga){this.A0(Ga.type,Ga.yL)}A0(ya,Ga=null){this.Uf.Bto&&0===ya&&l.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===ya&&this.eNe&&0<this.eNe.length){var wa=Object.assign(new qa.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.eNe,vetoPillar:"RealTimeCoauth"});(wa=X.a.getInstance(wa))&&wa.logKpiUsage(this.R$j)}this.Uf.Cto&&13===ya&&l.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",
Ga||"<none>"));this.Wt.MMb();5===ya?(Ga=(ya=this.SBn(Ga))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",ya.reason,ya.reconnectDelay):"Received client reconnection request from the server without params.",l.ULS.sendTraceTag(18637071,500,50,Ga),this.Hm.Ice(ya)):(Ga=c(1512).RtcUtils.deserialize(Ga,String.format("UpdateNotification-{0}",ja[ya]),null,!1,this.qxc),this.Hm.NPn(ya,Ga))}SBn(ya){try{if(!ya||""===ya)return null;const Ga=JSON.parse(ya);
return new aa(Ga[oa.a.$8f],Ga[oa.a.F$n],Ga[oa.a.J$n],Ga[oa.a.o$f])}catch(Ga){return l.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",Ga.message),null}}vzj(ya,Ga){return this.qCc.Rgm(this.Sgm(ya,Ga))}Sgm(ya,Ga){return ya+","+Ga}static ISl(){var ya=new Map;ya.set("SkipAria","True");ya=Object.assign(new Ia.a,{extendedProperties:ya});return Object.assign(new Va.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:ya,blockFutureEmissionDurationInMs:3E5})}}
Object(F.a)(Na,"RtcMessageHandler",V,[]);class za{oMh(ya,Ga=""){const {MaxOutstandingThrottler:wa}=c(1714);return wa.createInstance(ya,Ga)}kcl(ya,Ga=""){const {MaxRateThrottler:wa}=c(1716);return wa.createInstance(ya,Ga)}}Object(F.a)(za,"ThrottlerFactory",null,[888]);var la=c(80),va=c(1719);class ia{constructor(ya){this.Uf=null;this.Zh=!1;this.ra=new la.a;this.nKe=new x.a;this.lKe=new x.a;this.rVe=ya;this.DVb=this.rVe.oMh(Ga=>Ga.send(),"GlobalMaxOustandingThrottler");this.DVb.aAd(()=>{this.ra.raiseEvent("TMUDM")})}init(ya){this.Zh||
(this.Uf=ya,this.DVb.init(this.Uf.Wpb,this.Uf.mlm),this.Zh=!0)}Rgm(ya){var {MaxRateThrottler:Ga}=c(1716),{MaxOutstandingThrottler:wa}=c(1714);this.Zh||this.init(new va.a(Ga.HPh,wa.hQh,wa.SPh,ia.ecn));({value:Ga}=this.nKe.Dc(ya)).returnValue||(({value:Ga}=this.lKe.Dc(ya)).returnValue||(Ga="MaxOutstandingThrottler-"+ya,Ga=this.rVe.oMh(Object(f.a)(this.DVb,this.DVb.add,"add"),Ga),Ga.init(this.Uf.Wpb,this.Uf.dcn),Ga.aAd(()=>{this.ra.raiseEvent("TMUDM")}),this.lKe.add(ya,Ga)),wa="MaxRateThrottler-"+ya,
Ga=this.rVe.kcl(Object(f.a)(Ga,Ga.add,"add"),wa),Ga.init(this.Uf.een),this.nKe.add(ya,Ga));return Ga}reset(){for(let ya of this.nKe)ya.value.M3f();for(let ya of this.lKe)ya.value.M3f(),ya.value.reset();this.DVb.M3f();this.DVb.reset()}aAd(ya){this.ra.addHandler("TMUDM",ya)}}ia.ecn=1E3;Object(F.a)(ia,"ThrottlerManager",null,[887]);var pa;(function(ya){ya[ya.unspecified=0]="unspecified";ya[ya.word=1]="word";ya[ya.excel=2]="excel";ya[ya.powerPoint=3]="powerPoint";ya[ya.test=4]="test";ya[ya.wacFrontEnd=
5]="wacFrontEnd";ya[ya.oneNote=6]="oneNote";ya[ya.visio=7]="visio";ya[ya.officeMobile=8]="officeMobile";ya[ya.cosmosDBChangefeed=9]="cosmosDBChangefeed";ya[ya.last=10]="last"})(pa||(pa={}));Object(F.b)("RtcClientAppName",pa);const sa=(ya,Ga,wa,hb,eb,jb,ub,ab,Ea=null,Wa=null,Bb=null,Mb=null)=>{const Fb=N.createInstance(y.AFrameworkApplication.K),vb=y.AFrameworkApplication.buildVersion?y.AFrameworkApplication.buildVersion:"1.0",$a=Ha(ya,Ga,ub,vb),kb=Fb.i_k?c(1875).RealtimeChannelMetrics.createInstance($a):
new G;var Ua=c(1532).FrequentLoggingMetrics.create(eb);Fb.L$n&&Ua.pDo(Fb.K$n);var Sa="";Sa=Ea&&""!==Ea?Ea:"/rtc2/";Ua.U_h=u.a.C_(Sa);const xb=Sa+"signalr";Ea=Sa+"findsession";const Qb=L.dvm;Sa=new za;Bb=Bb||Q.a.getInstance();l.ULS.shipAssertTag(556867617,500,Fb.pgj<=c(1542).RealtimeChannel.QNi,"Client attempting to override max payload size beyond absolute limit");const Ib=Math.min(Fb.pgj,c(1542).RealtimeChannel.QNi);Ua.PNi=Ib;Ua=new Na(Fb,new ia(Sa),ya,$a,$b=>new I($b.createHubProxy(Qb)),ab,Bb,kb,
Ua,Ib);Wa||(Wa=c(1766).FindSessionStrategy.createInstance(Ga,eb,Ea,ab,vb,ub,ya,$a,Bb,jb,hb,Mb));Wa.wMd=Fb.wMd;Ga=new E($a);wa=wa?wa.split(","):null;ya=new (c(1542).RealtimeChannel)(ya,wa,$a,ab,()=>$.hubConnection(xb),Wa,Ua,Ga,Bb,kb,Fb,eb);ya.init();return ya},Ha=(ya,Ga,wa)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",ya,ra(pa[wa]),ra("browser"),Ga),ra=ya=>ya?ya.charAt(0).toLocaleUpperCase()+ya.substring(1,ya.length):ya;c.d(K,"RealtimeChannel",function(){return Ma});class Ma{constructor(ya,
Ga,wa,hb,eb,jb,ub,ab,Ea,Wa,Bb,Mb){this.OTe=!1;this.e6=null;this.G2=new x.a;this.Gqc=1;this.fea=null;this.am=!1;this.pIe=(new Date(0)).getTime();this.Jgh=0;this._clientId=ya;this.lxd=Ga;this.B$=0;this.ge=hb;this.Cwe=ab;this.Iik=ub;this.nVj=Ea;this.E_j=eb;this.m9a=jb;this.Hw=wa;this.Wt=Wa;this.Uf=Bb;this.Xf=Mb;this.Kkk=1>100*Math.random()}get eRa(){return this.m9a.eRa}set eRa(ya){this.m9a.eRa=ya}get Vnb(){return this.Iik}get Hm(){return this.nVj}init(){this.Hm.Fzk(Object(f.a)(this,this.dJd,"disconnectAndCreateNewConnection"));
this.Hm.eAk(Object(f.a)(this,this.Dwn,"onUpdatePersistentStateRequestReceivedInternal"));this.Hm.dAk(Object(f.a)(this,this.Cwn,"onUpdatePersistentStateClearedRequestReceived"));this.Xf.B0b(this.Wt);y.AFrameworkApplication.cI(()=>{const {FrequentLoggingMetrics:ya}=c(1532);this.Wt.N3f();ya.instance&&ya.instance.WKf()});this.GMh();this.Fol();this.Hm.Qzk(Object(f.a)(this,this.vVo,"updateConnectionQueryString"))}Fol(){try{const wa=$.signalR;if(!wa)throw Error.invalidOperation("Failed to retrieve Signalr object");
const hb=wa.version;if(!hb)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===hb){var ya=wa.transports;if(!ya)throw Error.invalidOperation("Failed to retrieve transports object");var Ga=ya.longPolling;if(!Ga)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!Ga.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");Ga.supportsKeepAlive=this.Kel()}}catch(wa){l.ULS.sendTraceTag(6432339,
500,15,"Failed to disable longPolling KeepAlives: {0}",wa.message)}}Kel(){return()=>!1}GMh(){const ya=++this.Gqc;this.pIe=(new Date(0)).getTime();this.fea=this.E_j();this.Hm.vPn(this.fea);this.fea.stateChanged(Ga=>{this.Enn(Ga,ya)});this.fea.connectionSlow(Object(f.a)(this,this.tvn,"onSlowConnection"));this.fea.error(Object(f.a)(this,this.lvn,"onSignalRError"));this.fea.log=Object(f.a)(this,this.mvn,"onSignalRLog")}pnc(ya,Ga){return ya!==this.Gqc?(l.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",
Ga),!1):!0}connect(){2!==this.B$&&1!==this.B$&&(l.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Hw),this.Cwe.Ann(),z.a.instance.qDo(),this.Zha(1,this.B$),this.svj())}svj(){const ya=this.Gqc;this.OTe=!1;this.Wt.W7i();this.m9a.Bbm(Object(f.a)(this,this.K4k,"connectSignalrConnection"),Object(f.a)(this,this.SUi,"onFailureToConnect"),Object(f.a)(this.Vnb,this.Vnb.Oym,"initThrottlerManager"),Object(f.a)(this,this.pnc,"verifyConnectionToken"),ya)}SUi(ya=null){this.Wt.Y7i();
let Ga=null;!ya||"documentsessiondeleted"!==(Ga=ya.toLowerCase())&&"documentsessionexpired"!==Ga?this.dJd():(l.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.Hw,ya),this.disconnect())}dJd(ya,Ga=null){l.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.e6);ya=(ya=2===this.B$||1===this.B$)&&!this.Vnb.eDb;let wa=!0,hb=0;Ga&&Object.getType(Ga)!==Object.getType(Sys.EventArgs.Empty)&&
Ga.Z6f&&""!==Ga.Z6f&&(ya=!0,this.m9a.Kno(Ga.Z6f),wa=Ga.o$f,hb=Ga.reconnectDelay);ya&&this.Zha(1,this.B$);++this.Gqc;this.Vnb.K5();this.CEo(wa);this.m9a.dql();this.GMh();ya&&window.setTimeout(Object(f.a)(this,this.svj,"startConnecting"),Math.min(hb,3E4))}vVo(){let ya=null;const Ga=({correlationId:ya}=this.m9a.r9h()).returnValue;this.fea.qs=Ga;l.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Hw,ya)}K4k(ya){const {FrequentLoggingMetrics:Ga}=
c(1532);this.pIe=(new Date).getTime();let wa=null;this.fea.qs=({correlationId:wa}=this.m9a.r9h()).returnValue;this.Uf.lCk&&(this.fea.url=ya,Ga.instance&&(Ga.instance.PHh=u.a.C_(ya)));let hb=null;this.ge&&(hb=this.ge.Zf("WebServiceCall","ConnectToServer"));l.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.Hw);ya={};this.lxd&&(ya.transport=1===this.lxd.length?this.lxd[0]:this.lxd);ya.pingInterval=null;z.a.instance.W3c(1,0);ya.waitForPageLoad=!1;this.fea.start(ya,null).done(eb=>
{this.Wt.Z7i();z.a.instance.W3c(1,1,!0);l.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",eb.id,wa)}).fail(eb=>{l.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.m9a.cX,wa,this.Hw);this.SUi();this.Wt.X7i(eb);z.a.instance.W3c(1,1,!1);this.Hm.S6i(0,{["CorrelationId"]:wa,["ErrorDetails"]:eb,["ConnectionState"]:k.a[this.B$]})}).always(()=>{const {FrequentLoggingMetrics:eb}=
c(1532);hb&&hb.stop();eb.instance&&(eb.instance.GAe=!1)})}disconnect(){const {FrequentLoggingMetrics:ya}=c(1532);0===this.B$?l.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Hw):(this.Wt.b8i(),ya.instance&&(ya.instance.GAe=!0),l.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.Hw),this.Vnb.eDb=!0,this.Cwe.von(),this.Zha(0,this.B$),this.dJd(),this.Vnb.eDb=!1)}CEo(ya){const Ga=this.ySk(),wa=this.fea,hb=this.e6,
eb=()=>{if(this.OTe)l.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.OTe=!0,wa.stop(!0,ya)}catch(jb){l.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",jb.message)}};0<Ga?(l.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",hb,Ga),window.setTimeout(eb,Ga)):(l.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",hb),eb())}ySk(){let ya=0;0===this.fea.state&&(ya=this.pIe+Ma.l4o-
(new Date).getTime(),0>ya&&(ya=0));return ya}get connectionState(){return this.B$}Kta(ya){this.Hm.Kta(ya)}xhc(ya){this.Hm.xhc(ya)}Bjj(ya){this.Kic(0,ya)}Kic(ya,Ga){const wa=new a.a;this.Hm.V6i(ya,Ga,wa);return wa.task}iZa(ya){this.Hm.iZa(ya)}iNb(ya){this.Hm.iNb(ya)}fEc(ya){this.Hm.fEc(ya)}U4c(ya){this.Hm.U4c(ya)}Yzd(ya){this.Hm.Yzd(ya)}Qde(ya){this.Hm.Qde(ya)}hQc(ya){return this.Rim(ya)}TDb(){return this.n7b(0)}n7b(ya){const Ga={};for(let wa of this.G2)wa.value.mb(ya)&&(Ga[wa.key]=wa.value.J(ya).data);
return Ga}Rim(ya){return this.G2.mb(ya)&&this.G2.J(ya).mb(0)?this.G2.J(ya).J(0).data:null}Dwn(ya,Ga){for(let wa of Ga.j0o)this.G2.mb(wa.key)||this.G2.Z(wa.key,new J.a),ya=wa.value,this.G2.J(wa.key).Z(Ga.type,new w(ya.Presence,new Date(ya.TimeStamp))),wa.key===this._clientId&&0===Ga.type&&this.Hm.$On(ya.Presence)}Cwn(ya,Ga){for(const wa of Ga.jEd)this.G2.remove(wa)}OMl(){const ya=new J.a;if(!this.G2.mb(this._clientId))return ya;for(let Ga of this.G2.J(this._clientId))ya.Z(Ga.key,Ga.value.data);return ya}bN(ya,
Ga=null,wa=!1){const hb=new a.a;this.Hm.V2f(ya,Ga,wa,hb);return hb.task}g3(ya){this.Hm.g3(ya)}jNb(ya){this.Hm.jNb(ya)}lib(ya){let Ga,wa;return({value:Ga}=this.G2.Dc(ya)).returnValue&&({value:wa}=Ga.Dc(0)).returnValue?new n(this.Wim(wa),wa.timeStamp):null}vNc(){const ya={};for(let Ga of this.G2)Ga.value.Dc(0).returnValue&&(ya[Ga.key]=this.lib(Ga.key));return ya}sqb(ya){const Ga=new a.a;this.Hm.a7i(ya,Ga);return Ga.task}get clientId(){return this._clientId}get Fzo(){return this.Kkk}dispose(){const {FrequentLoggingMetrics:ya}=
c(1532);this.am||(this.Vnb.K5(),this.Xf.Gde(this.Wt),this.Wt.N3f(),ya.instance&&ya.instance.WKf(),this.am=!0)}Enn(ya,Ga){this.pnc(Ga,"StateChangedSignalR")&&this.Zha(this.AJh(ya.newState),this.AJh(ya.oldState))}Zha(ya,Ga){var {FrequentLoggingMetrics:wa}=c(1532),{ClientToClientMessageTelemetry:hb}=c(1779);if((1!==this.B$||0!==Ga||1!==ya)&&this.B$!==Ga){const eb=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.B$,
Ga,ya]));l.ULS.sendTraceTag(3290053,500,10,eb)}if(this.B$!==ya){switch(ya){case 2:wa.instance&&wa.instance.Ean();this.e6=this.fea.id;l.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.e6,this.Hw);this.w8m(this.fea);l.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");wa=null;this.ge&&(wa=this.ge.Zf("WebServiceCall","Receive First Presence"));hb=this.Gqc;this.Hm.uPn(Object(f.a)(this,this.pnc,"verifyConnectionToken"),hb,this.Cwe,Object(f.a)(this,
this.M7e,"clearExistingPersistentState"),this.OMl(),wa);this.Uf.G$n&&(wa=100*Math.random()<=this.Uf.H$n,c(1779).ClientToClientMessageTelemetry.v8b(this.Hm,this.Uf,wa).start());break;case 1:2===Ga&&l.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.e6);break;case 0:if(hb.instance&&hb.instance.stop(),this.Vnb.eDb)l.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.e6);else{1===Ga&&(l.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.e6),this.Wt.c8i());2===Ga&&l.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.e6);this.dJd();return}}this.B$=ya;this.Hm.yOn(ya,Ga)}}w8m(ya){if(ya&&ya.transport&&ya.transport.name){ya=ya.transport.name;var Ga=ya.toLowerCase();
"websockets"===Ga?l.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",ya,this.Hw):"serversentevents"===Ga?l.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",ya,this.Hw):"foreverframe"===Ga?l.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",ya,this.Hw):"longpolling"===Ga?l.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",ya,this.Hw):"mocktransport"!==Ga&&l.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
ya)}else l.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}tvn(){if(this.Uf.ogj){const ya=u.a.aU(this.eRa,"mid");l.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.e6,ya)}else l.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.e6)}lvn(){l.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.e6)}mvn(ya){ya=c(1512).RtcUtils.Iec(ya);if(this.Uf.ogj&&ya.startsWith("Keep alive timed out.")){const Ga=
u.a.aU(this.eRa,"mid");l.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",ya,Ga)}else this.Fzo&&2E3>this.Jgh&&!ya.startsWith("Invok")&&!ya.startsWith("Trigger")&&(l.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",ya),this.Jgh++)}M7e(){let ya;const Ga=[];({value:ya}=this.G2.Dc(this._clientId)).returnValue&&this.G2.remove(this._clientId);for(let wa of this.G2.keys)Array.add(Ga,wa);for(const wa of Ga)this.G2.remove(wa);ya&&this.G2.Z(this._clientId,ya);this.Hm.UOn(Ga)}AJh(ya){switch(ya){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",ya,"Unknown SignalR state");}}Wim(ya){return ya&&ya.timeStamp?(new Date).getTime()-ya.timeStamp.getTime()>(this.Uf.RJk?6E4:this.Uf.QJk)?2:1:1}static createInstance(ya,Ga,wa,hb,eb,jb,ub,ab=null,Ea=null,Wa=null,Bb=null,Mb=null,Fb=null){return sa(ya,Ga,wa,Fb,hb,eb,jb,ub,ab,Ea,Wa,Mb,Bb)}}Ma.QNi=31E3;Ma.KMf=8E3;Ma.l4o=15E3;Object(F.a)(Ma,"RealtimeChannel",null,[859,860])},1632:function(F,K,c){c.d(K,"a",function(){return l});
F=c(0);class l{constructor(){this.Lhh=!1;this.Owb=null;this.XQg=0;this.eBe=this.ZNh();this.hgd=this.ZNh();this.gsb=this.yVb=0;this.iq=()=>new Date}get OFo(){return this.Lhh}ZNh(){const f=Array(6);for(let a=0;a<f.length;a++)f[a]=0;return f}zXl(){return this.eBe.toString()}gSl(){return this.hgd.toString()}qDo(){this.Owb=this.iq()}W3c(f,a,k=!1){this.OFo||(k&&(this.Lhh=!0),k=this.iq(),0===f&&5<this.yVb||1===f&&5<this.gsb||(this.XQg<f?(1===this.yVb%2&&(this.eBe[this.yVb]=-1,this.yVb++),this.XQg=f,1===
a&&(this.hgd[this.gsb]=-1,this.gsb++),this.hgd[this.gsb]=this.Ngg(k),this.gsb++):0===f?(this.eBe[this.yVb]=this.Ngg(k),this.yVb++):(this.hgd[this.gsb]=this.Ngg(k),this.gsb++)))}Ngg(f){const a=f.getTime()-this.Owb.getTime();this.Owb=f;return a}static get instance(){l._instance||(l._instance=new l);return l._instance}static set instance(f){l._instance=f}}l._instance=null;Object(F.a)(l,"LatencyMetrics",null,[])},1661:function(F,K,c){F=c(0);class l{constructor(){this.TNg=this.wwe=!1;this.callback=null}P_c(a){this.callback=
a;this.GBj()}gNi(a){this.wwe||(this.wwe=!0,this.w_j=a,this.GBj())}GBj(){this.wwe&&this.callback&&!this.TNg&&(this.TNg=!0,this.callback(this.w_j))}}Object(F.a)(l,"CompletionTask",null,[]);c.d(K,"a",function(){return f});class f{constructor(){this.$6g=new l;this.Y6g=new l}L7d(a){this.$6g.P_c(a)}K7d(a){this.Y6g.P_c(a)}TYc(a){this.$6g.gNi(a)}rlb(a){this.Y6g.gNi(a)}vMf(){this.TYc(2);this.rlb(2)}}Object(F.a)(f,"MessageStatus",null,[902])},1714:function(F,K,c){c.r(K);c.d(K,"MaxOutstandingThrottler",function(){return k});
F=c(0);var l=c(55),f=c(80);K=c(1715);var a=c(1661);class k extends K.a{constructor(x,y=""){super(x,y);this.Qdc=this.Wpb=0;this.ra=new f.a;this.FWb=!1;this.Upd=this.Lgd=this.igd=this.qVe=0;this.X2=[];this.clearTimeout=k.xdf}add(x){this.GWb||this.init(k.hQh,k.SPh);this.tyb++;const y=new a.a;this.nbc?this.She(x,y):this.Upd<this.Qdc?this.Q6c(x,y):(this.She(x,y),this.FWb=!1);return y}Q6c(x,y){x=this.dfh(x);const n=this.setTimeout(Object(l.a)(this,this.Ern,"onMessageWaitTimeExpired"),this.Wpb);++this.Upd;
Array.add(this.X2,n);const u=this.igd;x.L7d(z=>{y.TYc(z)});x.K7d(z=>{this.igd===u&&(this.Drn(u,n),y.rlb(z))})}Drn(x,y){this.igd===x&&(--this.Upd,this.clearTimeout(y),Array.remove(this.X2,y),this.nbc&&this.Kfo())}Kfo(){this.nbc&&!this.FWb&&(this.qVe=this.setTimeout(Object(l.a)(this,this.Lfo,"sendThrottledMessageFromTimer"),0),this.FWb=!0)}Lfo(){this.FWb=!1;if(this.nbc){const x=this.Iwd,y=this.l_b;this.MGc(!1);this.Q6c(x,y)}}Ern(){++this.Lgd;this.Lgd>Math.floor(this.Qdc/2)&&(this.Lgd=-1E9,this.ra.raiseEvent("TMUDM"))}aAd(x){this.ra.addHandler("TMUDM",
x)}reset(){this.tyb=this.pCc=this.vsc=this.Lgd=0;++this.igd;for(const x of this.X2)this.clearTimeout(x);this.Upd=0;this.X2=[];this.MGc(!0);this.FWb&&(this.clearTimeout(this.qVe),this.qVe=0,this.FWb=!1)}init(x,y){this.GWb||(this.Wpb=x,this.Qdc=y,this.GWb=!0)}static createInstance(x,y=""){return new k(x,y)}static xdf(x){window.clearTimeout(x)}}k.hQh=15E3;k.SPh=5;Object(F.a)(k,"MaxOutstandingThrottler",K.a,[899,900])},1715:function(F,K,c){c.d(K,"a",function(){return f});F=c(0);var l=c(7);class f{constructor(a,
k=""){this.vsc=this.pCc=0;this.oGe=!1;this.l_b=this.Iwd=null;this.GWb=!1;this.dfh=a;this.wzj=k;this.setTimeout=f.Edf;this.tyb=this.pCc=this.vsc=0}M3f(){0<this.tyb&&0<this.vsc&&l.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.wzj,this.vsc,this.tyb);0<this.tyb&&0<this.pCc&&l.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.wzj,this.pCc,this.tyb)}get nbc(){return this.oGe}She(a,k){this.pCc++;this.MGc(!0);this.oGe=
!0;this.Iwd=a;this.l_b=k}MGc(a){this.oGe=!1;this.l_b&&a&&(this.vsc++,this.l_b.vMf());this.l_b=this.Iwd=null}static Edf(a,k){return window.setTimeout(a,k)}}Object(F.a)(f,"ThrottlerBase",null,[])},1716:function(F,K,c){c.r(K);c.d(K,"MaxRateThrottler",function(){return a});F=c(0);var l=c(55);K=c(1715);var f=c(1661);class a extends K.a{constructor(k,x=""){super(k,x);this.Zdc=0;this.wwc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(k){this.GWb||(this.Zdc=k,this.GWb=!0)}add(k){this.GWb||
this.init(a.HPh);this.tyb++;const x=this.currentTime(),y=new f.a;this.wwc>x&&(this.wwc=x);this.nbc?(this.MGc(!0),this.She(k,y)):this.wwc+this.Zdc<=x?this.Q6c(k,y):(this.She(k,y),this.setTimeout(Object(l.a)(this,this.Jfo,"sendThrottledMessage"),this.wwc+this.Zdc-x));return y}Jfo(){if(this.nbc){const k=this.Iwd,x=this.l_b;this.MGc(!1);this.Q6c(k,x)}}Q6c(k,x){this.wwc=this.currentTime();k=this.dfh(k);k.L7d(y=>{x.TYc(y)});k.K7d(y=>{x.rlb(y)})}static createInstance(k,x=""){return new a(k,x)}}a.HPh=200;
Object(F.a)(a,"MaxRateThrottler",K.a,[901,900])},1717:function(F,K,c){c.d(K,"a",function(){return l});F=c(0);class l extends Sys.EventArgs{constructor(f,a,k,x){super();this.type=f;this.yL=a;this.ull=k;this.v7a=x}}Object(F.a)(l,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1718:function(F,K,c){c.d(K,"a",function(){return l});F=c(0);class l{}l.$8f="rr";l.J$n="rd";l.F$n="rbp";l.o$f="sa";Object(F.a)(l,"RtcReconnectParams",null,[])},1719:function(F,K,c){c.d(K,"a",function(){return l});F=c(0);class l{constructor(f,
a,k,x){this.een=f;this.Wpb=a;this.dcn=k;this.mlm=x}}Object(F.a)(l,"ThrottlerManagerSettings",null,[])},1762:function(F,K,c){F=c(0);class l extends Sys.EventArgs{constructor(J,V){super();this.newState=J;this.oldState=V}}Object(F.a)(l,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class f extends Sys.EventArgs{constructor(J,V){super();this.h_k=J;this.v7a=V}}Object(F.a)(f,"ClientInfoEventArgs",Sys.EventArgs,[]);class a extends Sys.EventArgs{constructor(J){super();this.presence=J}}Object(F.a)(a,
"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var k=c(1877),x=c(1876),y=c(1874);class n extends Sys.EventArgs{constructor(J,V=null){super();this.$j=J;this.pok=V}get type(){return this.$j}get yL(){return this.pok}}Object(F.a)(n,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class u extends Sys.EventArgs{constructor(){super()}}Object(F.a)(u,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class z extends Sys.EventArgs{constructor(J,V,X,W,U,Y){super();this.pnc=J;this.H9e=V;this.M4k=
X;this.AYh=U;this.M7e=W;this.WA=Y}}Object(F.a)(z,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class w extends Sys.EventArgs{constructor(J){super();this.hubConnection=J}}Object(F.a)(w,"RefreshProxyEventArgs",Sys.EventArgs,[]);class E extends Sys.EventArgs{constructor(J,V){super();this.uga=J;this.errorMessage=V}}Object(F.a)(E,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class G extends Sys.EventArgs{constructor(J,V,X){super();this.type=J;this.presence=V;this.v7a=X}}Object(F.a)(G,"SendPersistentStateEventArgs",
Sys.EventArgs,[]);var H=c(1717);class L extends Sys.EventArgs{constructor(){super()}}Object(F.a)(L,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class I extends Sys.EventArgs{constructor(J){super();this.jEd=J}}Object(F.a)(I,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class N extends Sys.EventArgs{constructor(J,V){super();this.type=J;this.j0o=V}}Object(F.a)(N,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var Q=c(80);c.d(K,"a",function(){return M});class M{constructor(){this.ra=
new Q.a}yOn(J,V){this.ra.raiseEvent("CSC",new l(J,V))}vPn(J){this.ra.raiseEvent("RP",new w(J))}Ice(J){this.ra.raiseEvent("RC",J)}yPn(){this.ra.raiseEvent("RMID")}uPn(J,V,X,W,U,Y){this.ra.raiseEvent("RPS",new z(J,V,X,W,U,Y))}b7i(J,V){this.ra.raiseEvent("UPSR",new N(J,V))}O6i(J,V){this.ra.raiseEvent("PU",new y.a(J,V))}$On(J){this.ra.raiseEvent("MPU",new a(J))}V2f(J,V,X,W){this.ra.raiseEvent("SUN",new H.a(J,V,X,W))}NPn(J,V){this.ra.raiseEvent("UNR",new n(J,V))}V6i(J,V,X){this.ra.raiseEvent("SP",new G(J,
V,X))}oPn(J,V){this.ra.raiseEvent("PSU",new x.a(J,V))}nPn(J){this.ra.raiseEvent("PSC",new k.a(J))}UOn(J){this.ra.raiseEvent("IPSC",new k.a(J))}OPn(J){this.ra.raiseEvent("UPSC",new I(J))}APn(J,V){this.ra.raiseEvent("SPC",new L(J,V))}S6i(J,V){this.ra.raiseEvent("RCF",new E(J,V))}NOn(J){this.ra.raiseEvent("CPSWM",new u(J))}a7i(J,V){this.ra.raiseEvent("UCI",new f(J,V))}Kta(J){this.ra.addHandler("CSC",J)}xhc(J){this.ra.removeHandler("CSC",J)}Gzk(J){this.ra.addHandler("RP",J)}Fzk(J){this.ra.addHandler("RC",
J)}Jzk(J){this.ra.addHandler("RMID",J)}Ezk(J){this.ra.addHandler("RPS",J)}eAk(J){this.ra.addHandler("UPSR",J)}iZa(J){this.ra.addHandler("PU",J)}iNb(J){this.ra.removeHandler("PU",J)}Exk(J){this.ra.addHandler("IPU",J)}bAk(J){this.ra.addHandler("UCI",J)}Ozk(J){this.ra.addHandler("SUN",J)}Fxk(J){this.ra.addHandler("IUNR",J)}g3(J){this.ra.addHandler("UNR",J)}jNb(J){this.ra.removeHandler("UNR",J)}fEc(J){this.ra.addHandler("PSU",J)}U4c(J){this.ra.removeHandler("PSU",J)}Dxk(J){this.ra.addHandler("IPSU",J)}Yzd(J){this.ra.addHandler("PSC",
J)}Qde(J){this.ra.removeHandler("PSC",J)}Cxk(J){this.ra.addHandler("IPSC",J)}dAk(J){this.ra.addHandler("UPSC",J)}Mzk(J){this.ra.addHandler("SP",J)}Qzk(J){this.ra.addHandler("SPC",J)}static getInstance(){return M._instance||(M._instance=new M)}}M._instance=null;Object(F.a)(M,"RtcEventHub",null,[890])},1766:function(F,K,c){c.r(K);F=c(0);var l=c(7),f=c(55),a=c(74),k=c(873);class x{}x.Zdc="throttling_messageDelay";x.EVc="enabled";x.Wpb="throttling_timeToWaitForResponse";x.Qdc="throttling_maxNumberOfOutstandingMessages";
x.Eki="throttling_globalMaxNumberOfOutstandingMessages";x.errorMessage="errorMessage";x.Ctj="url";x.UGa="queryString";x.cX="connectionString";Object(F.a)(x,"RtcFindSessionOutputFieldNameConstants",null,[]);var y=c(2),n=c(57),u=c(39),z=c(310),w=c(1380),E=c(82),G=c(19),H=c(140);class L{constructor(){this.Fki=this.NNi=this.ONi=this.TNi=0;this.B_d=!1;this.correlationId=this.cX=this.UGa=this.I9e=this.errorMessage=null}get I3k(){return this.I9e+"?"+this.UGa}}Object(F.a)(L,"FindSessionResponse",null,[]);
var I=c(582);class N{constructor(aa,fa,na,oa,ja,qa){this.HXa=null;const {FindSessionStrategy:Ia}=c(1766);this.Wgk=aa;aa=String.format("{0}={1}",I.a.clientId,G.a.Tj(oa));aa=String.format("{0}&{1}={2}",aa,I.a.userSessionId,G.a.Tj(ja));aa=String.format("{0}&{1}={2}",aa,I.a.hJj,G.a.Tj(na.toString()));aa=String.format("{0}&{1}={2}",aa,I.a.userType,G.a.Tj("1"));aa=String.format("{0}&{1}={2}",aa,I.a.tJj,G.a.Tj(fa));aa=String.format("{0}&{1}={2}",aa,I.a.XEh,G.a.Tj(Ia.j_k));(fa=N.Onf(na,qa))&&(aa=String.format("{0}&{1}",
aa,fa));this.G_j=aa}c9i(){this.HXa=this.Wgk()}generate(){this.HXa&&""!==this.HXa||(this.c9i(),l.ULS.sendTraceTag(575784194,500,this.HXa&&""!==this.HXa?50:15,"Query signature delegate called for refresh returned: {0} ",this.HXa));const aa=String.format("{0}={1}",I.a.zMb,G.a.Tj(this.HXa));return String.format("{0}&{1}",aa,this.G_j)}static Onf(aa,fa){return 4===aa?String.format("{0}={1}",I.a.pRi,"1"):fa?fa.Bji():null}}Object(F.a)(N,"FindSessionQueryStringGenerator",null,[]);var Q=c(1532),M=c(1632),J=
c(1512),V=c(1719);class X{}X.CEl="FSType";Object(F.a)(X,"RtcFindSessionRequestHeaders",null,[]);class W{}W.LQn="polling";Object(F.a)(W,"RtcFindSessionTypes",null,[]);var U=c(1718);class Y{}Y.Z2o="RTC-TokenProofkey";Y.dWm="RTC-IsWacJsBootFsRequest";Object(F.a)(Y,"RtcRequestHeaders",null,[]);c.d(K,"FindSessionStrategy",function(){return ba});class ba{constructor(aa,fa,na,oa,ja,qa,Ia,Va,Na,za,la,va,ia=null){this.V3g=(new Date(0)).getTime();this.g6g=0;this.Kod=!1;this.qfh=null;this.b4f=36E5;this.RTb=
ba.fri;this.Zsc=0;this.vNb=null;this.RSa=0;this.iic=this.RHh=null;this.Yhk=[x.EVc,x.errorMessage,x.Ctj,x.cX,x.UGa,x.Eki,x.Qdc,x.Wpb,x.Zdc];this.Xhk=[x.EVc,x.errorMessage];this.cX=this.eRa=null;this.CVg=new N(la?la:()=>y.AFrameworkApplication.im,ja,qa,Ia,aa,fa);this.Zpc=va;this.ge=oa;this.Xf=fa;this.iBe=na;this.Hw=Va;this.Hm=Na;this.stc=ia;this.DVg=!1;this.wMd=9E4;za&&za.execute(pa=>{pa.fZa(()=>{l.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Hw);
this.CVg.c9i()})});2>=100*Math.random()&&(this.b4f=3E5);Q.FrequentLoggingMetrics.instance&&(Q.FrequentLoggingMetrics.instance.P2h=this.b4f)}Kno(aa){this.iic=aa}init(){this.Hm.Jzk(Object(f.a)(this,this.I6n,"resetGetMachineIdDelay"));this.Hm.Kta(Object(f.a)(this,this.Zha,"onConnectionStateChanged"))}Zha(aa,fa){this.RSa=fa.newState;2===fa.newState&&(this.Zsc=0)}r9h(){let aa;aa=this.vNb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.vNb.UGa,ba.lKh,G.a.Tj(aa)),correlationId:aa}}Bbm(aa,
fa,na,oa,ja){this.Eeo(()=>{oa(ja,"GetMachineIdSuccess")&&(l.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.cX,this.Hw),aa(this.qfh),na(this.Tgm()))},qa=>{oa(ja,"GetMachineIdFailure")&&(l.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Hw),fa(qa))},oa,ja)}dql(){this.DEh();this.ixm()}Eeo(aa,fa,na,oa){l.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",
this.cX);if(this.cX)aa();else{var ja=this.GRk();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(aa,fa,na,oa)},ja)}}sendFindSessionRequestToServerInternal(aa,fa,na,oa){na(oa,"RequestMachineId")&&(this.V3g=(new Date).getTime(),na=u.a.af(),this.GPd(ja=>{const qa=u.a.af();this.H0i(ja);this.rbg();aa();ja=u.a.af()-qa;l.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ja)},ja=>{const qa=u.a.af();this.DEh();Q.FrequentLoggingMetrics.instance&&Q.FrequentLoggingMetrics.instance.VO(2,
3);fa(ja);ja=u.a.af()-qa;l.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ja)},!1),na=u.a.af()-na,l.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",na))}ixm(){this.RTb+=ba.w3l;this.RTb=Math.min(this.RTb,ba.Obn)}GRk(){var aa=(new Date).getTime();aa=this.V3g+this.RTb-aa;0>aa&&(aa=0);return aa}H0i(aa){try{this.vNb=aa,this.eRa=aa.I3k,this.cX=aa.cX,this.RHh=aa.UGa,this.qfh=aa.I9e}catch(fa){l.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
fa.toString())}}DEh(){this.cX=null;this.EEh()}rbg(){this.EEh();this.Kod=!0;this.g6g=window.setTimeout(Object(f.a)(this,this.UUn,"refreshMachineId"),this.b4f)}EEh(){this.Kod&&(window.clearTimeout(this.g6g),this.Kod=!1)}UUn(){this.Kod=!1;this.GPd(aa=>{const fa=this.RHh!==aa.UGa,na=this.cX!==aa.cX,oa=this.cX;this.H0i(aa);0!==this.RSa&&(na?(l.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",oa||"null",aa.cX),this.Hm.Ice()):(this.Hm.APn(fa,na),
this.rbg()))},()=>{Q.FrequentLoggingMetrics.instance&&Q.FrequentLoggingMetrics.instance.VO(2,3);this.rbg()},!0)}I6n(){this.RTb=ba.fri}Tgm(){return new V.a(this.vNb.TNi,this.vNb.ONi,this.vNb.NNi,this.vNb.Fki)}bOo(aa){if(Object.getType(aa)!==Object)return null;for(let fa in aa);return this.Aal(aa)}Aal(aa){if(!(x.EVc in aa))return null;const fa=aa[x.EVc];var na=fa?this.Yhk:this.Xhk;for(const oa of na)if(!(oa in aa))return null;na=Object.assign(new L,{B_d:aa[x.EVc],errorMessage:aa[x.errorMessage],correlationId:H.a.create().toString()});
fa&&(na.I9e=aa[x.Ctj],na.UGa=aa[x.UGa],na.cX=aa[x.cX],na.Fki=aa[x.Eki],na.NNi=aa[x.Qdc],na.ONi=aa[x.Wpb],na.TNi=aa[x.Zdc]);return na}AXl(aa,fa){l.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.stc.V_h.continueWith(()=>{this.stc.V_h.result?(l.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),aa(this.stc.W_h)):(l.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),fa(this.stc.W_h))})}Sdj(aa,fa,
na,oa,ja=!1){return qa=>{M.a.instance.W3c(0,1);aa&&aa.stop();this.Zpc=this.iic=null;this.aLi(qa.data,!0,fa);var Ia=J.RtcUtils.deserialize(qa.data.ve,"FindSession",null);if(Ia)if(Ia=this.bOo(Ia)){if(Ia.B_d&&Ia.UGa&&Ia.cX){l.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.Hw);this.i3m(qa.data);na(Ia);return}fa.FindSessionFailureReason="FindSessionInvalidResponse";fa.IsRtcEnabled=Ia.B_d;fa.IsQueryStringEmpty=!Ia.UGa;fa.IsConnectionStringEmpty=!Ia.cX;l.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.Hw,Ia.B_d,!Ia.UGa,!Ia.cX)}else fa.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",l.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Hw);else fa.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",l.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.Hw);this.T6i(fa,ja);oa(null)}}Mdj(aa,fa,na,oa=!1){return ja=>{M.a.instance.W3c(0,1);aa&&aa.stop();this.Zpc=this.iic=null;this.aLi(ja.data,!1,fa);let qa=null;var Ia="unknown";let Va="unknown";ja.data&&((Ia=ja.data.Bj)&&ba.h6c in Ia&&(qa=Ia[ba.h6c].toString()),Ia=w.a[ja.data.status],Va=ja.data.Qe.toString());fa.FindSessionFailureReason="FindSessionRequestFailed";fa.HttpErrorCode=Va;fa.HttpErrorStatus=Ia;fa[ba.h6c]=qa;l.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
Ia,Va,this.Hw,qa,oa);this.T6i(fa,oa);na(Va)}}GPd(aa,fa,na=!1){let oa=null;l.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Hw);const ja={};var qa=this.CVg.generate();ja[z.a.N7]=H.a.create().toString();this.iic&&""!==this.iic?qa=String.format("{0}&{1}={2}",qa,U.a.$8f,this.iic):this.Zpc&&""!==this.Zpc&&(qa=String.format("{0}&{1}={2}",qa,U.a.$8f,this.Zpc),ja[Y.Z2o]="True",ja[Y.dWm]="True");qa=this.iBe+"?"+qa;na&&(ja[X.CEl]=W.LQn);const Ia={};Ia.IsNetworkOfflineBeforeSendRequest=
this.Xf.qQa;Ia.HasAvailableConnectionsBeforeSendRequest=this.Xf.cVd;Ia.MaxConnectionsAllowed=this.Xf.Ndc;Ia.IsRefreshMachineId=na;this.stc&&!this.DVg?(this.AXl(this.Sdj(null,Ia,aa,fa,na),this.Mdj(null,Ia,fa,na)),this.DVg=!0):(this.ge&&(oa=this.ge.Zf("WebServiceCall","GetMachineIdFromTheServer")),Q.FrequentLoggingMetrics.instance&&Q.FrequentLoggingMetrics.instance.VO(2,0),0>this.Xf.mzb(qa,1,null,ja,[ba.xGd,ba.h6c,ba.u_c,ba.Z8f,ba.mQi,ba.PSi,ba.OSi],1,this.Sdj(oa,Ia,aa,fa,na),this.Mdj(oa,Ia,fa,na),
null,!1,null,this.wMd,"3",null,!0)&&(5<this.Zsc&&200>this.Zsc&&l.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.Zsc),window.setTimeout(()=>{this.Zsc++;fa("-1")},1E3)))}aLi(aa,fa,na){na||(na={});na.IsNetworkOfflineAfterRequestComplete=this.Xf.qQa;na.IsRequestSucceeded=fa;aa&&(na.EnqueueTime=aa.lOa,na.InvokedTime=aa.KH,na.CompletedTime=aa.nT,aa.Bj&&(ba.xGd in aa.Bj&&(na.CorrelationId=aa.Bj[ba.xGd]),ba.u_c in
aa.Bj&&(na[ba.u_c]=aa.Bj[ba.u_c])));l.ULS.sendTraceTag(38633565,500,fa?50:15,J.RtcUtils.Iec(na))}T6i(aa,fa){aa||(aa={});aa.ConnectionState=k.a[this.RSa];fa||this.Hm.S6i(1,aa)}i3m(aa){try{var fa=!1,na=!1,oa=aa.Bj,ja=n.a.C_(aa.request.get_url());if(oa&&ba.Z8f in oa){const za=oa[ba.Z8f].toString().toLocaleLowerCase();na="true"===za;fa="false"===za}oa=!1;const Na=0<=ja.toLocaleLowerCase().indexOf("collab");na&&!Na?oa=!0:fa&&Na&&(oa=!0);if(oa){fa={};fa.HostName=ja;fa.Status=w.a[aa.status];fa.HttpStatus=
aa.Qe.toString();var qa=aa.request.get_headers();for(let za in qa){var Ia=qa[za];(ja=za)&&0<ja.length&&(na=0,Ia&&(na=Ia.toString().length),fa["r_"+ja]=na)}if(aa.Bj){const za=new a.a;za.add(ba.xGd);za.add(ba.u_c);za.add(ba.h6c);za.add(ba.PSi);za.add(ba.OSi);za.add(ba.mQi);ba.lvk(fa,aa.Bj,za)}ba.Xuk(aa.request.get_url(),fa);var Va=E.a.toJSON(fa);l.ULS.sendTraceTag(559437006,500,15,Va)}}catch(Na){l.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Na.toString())}}static createInstance(aa,
fa,na,oa,ja,qa,Ia,Va,Na,za,la,va=null){return ba.Abl(aa,fa,na,oa,ja,qa,Ia,Va,Na,za,la,va)}static Abl(aa,fa,na,oa,ja,qa,Ia,Va,Na,za,la,va=null){aa=aa||H.a.create().toString();aa=new ba(aa,fa,na,oa,ja,qa,Ia,Va,Na,za,null,la,va);aa.init();return aa}static lvk(aa,fa,na){for(let oa of na)oa in fa&&(aa[oa]=fa[oa])}static Xuk(aa,fa){if(aa){var na=aa.indexOf("?");if(-1!==na)for(aa=aa.substr(na+1).split("&"),na=0;na<aa.length;++na){var oa=aa[na].split("=");if(2===oa.length){const ja=oa[0];if(ja&&0<ja.length){let qa=
0;if(oa=oa[1])qa=oa.length;fa["q_"+ja]=qa}}}}}}ba.w3l=3E3;ba.Obn=3E5;ba.j_k="1.0";ba.fri=1E3;ba.xGd="X-CorrelationId";ba.lKh="corrid";ba.h6c="RtcErrorCode";ba.u_c="X-OfficeCluster";ba.Z8f="X-NewEnv";ba.mQi="X-MSEdge-Ref";ba.OSi="X-OFFICEFD";ba.PSi="X-OfficeFE";Object(F.a)(ba,"FindSessionStrategy",null,[885])},1779:function(F,K,c){c.r(K);F=c(0);var l=c(7),f=c(55),a=c(457),k=c(58),x=c(74);class y{constructor(u){this.messageId=u;this.Nfo=(new Date).getTime();this.MIf=new x.a}}Object(F.a)(y,"MessageLatencyDetails",
null,[]);c.d(K,"ClientToClientMessageTelemetry",function(){return n});class n{constructor(u,z,w){this.kLa=null;this.UJe=this.TRe=0;this.Uf=z;this.a7g=w;this.cBc=!1;this.Hm=u;this.Hm.g3(Object(f.a)(this,this.jRn,"receiveMessage"))}start(){if(this.a7g&&!this.cBc){const u=this.Uf.sgj;this.UJe=this.Uf.ngj;u<=this.UJe?(l.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",
this.Uf.sgj,this.Uf.ngj),this.a7g=!1):(this.cBc=!0,this.TRe=window.setInterval(Object(f.a)(this,this.sendMessage,"sendMessage"),u))}}sendMessage(){if(this.cBc){const u=k.a.create().toString();this.kLa=new y(u);this.Hm.V2f(16,u,!1,new a.a);window.setTimeout(()=>{this.H5m(u)},this.UJe)}}H5m(u){this.kLa&&this.kLa.messageId===u&&(0<this.kLa.MIf.count?(u=this.kLa.MIf.toArray().join(","),l.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",u)):l.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),
this.kLa=null)}stop(){this.TRe&&(window.clearInterval(this.TRe),this.cBc=!1)}jRn(u,z){16===z.type?this.Hm.V2f(17,z.yL,!1,new a.a):17===z.type&&this.cBc&&z.yL&&this.processMessage(z.yL)}processMessage(u){u&&this.kLa&&u.toString()===this.kLa.messageId&&(u=(new Date).getTime()-this.kLa.Nfo,this.kLa.MIf.add(u))}static get instance(){return n._instance}static v8b(u,z,w){return n.instance||(n._instance=new n(u,z,w))}}n._instance=null;Object(F.a)(n,"ClientToClientMessageTelemetry",null,[])},1874:function(F,
K,c){c.d(K,"a",function(){return l});F=c(0);class l extends Sys.EventArgs{constructor(f,a){super();this.dra=f;this.eJd=a}}Object(F.a)(l,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1875:function(F,K,c){c.r(K);c.d(K,"RealtimeChannelMetrics",function(){return x});F=c(0);var l=c(7),f=c(196),a=c(82),k=c(1512);class x{constructor(){this.I8g=this.J8g=this.K8g=this.E8g=this.D8g=this.F8g=this.$xc=this.HLe=0;this.qKa=this.PIe=this.ywc=this.BIe=this.LWa=this.oIe=this.$ab=this.iwc=this.PWb=this.nIe=this.qjd=
this.lVb=null;this.fKe=this.pxc=this.ofh=this.YOg=0;this.b7g=!1;this.W7i=this.x3f;this.Z7i=this.A3f;this.Y7i=this.z3f;this.c8i=this.C3f;this.b8i=this.B3f;this.N3f=this.O3f;this.X3c=this.L3f;this.LMb=this.J3f;this.MMb=this.K3f;this.X7i=this.y3f;this.uRa=this.MQf;this.Klb=this.NQf}x3f(){this.HLe++;this.nIe=new Date;this.lVb||(this.lVb=new Date)}A3f(){this.$xc++;this.$ab=new Date;this.qjd||(this.qjd=this.$ab);this.ywc=this.$ab;this.a4k()}z3f(){this.F8g++;this.oIe=new Date}C3f(){this.D8g++;this.PWb=new Date}B3f(){this.E8g++;
this.iwc=new Date}L3f(){this.LWa=new Date;this.K8g++}K3f(){this.qKa||(this.qKa=new Date);this.J8g++}J3f(){this.BIe=new Date;this.I8g++}O3f(){!this.b7g&&this.HLe&&(l.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.W0k())),this.b7g=!0)}y3f(y){let n,u;({epi:y,gpi:n,exception:u}=k.RtcUtils.gAl(y));y&&y!==f.a.My&&(l.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:y,["HttpErrorStatus"]:n,["Exception"]:u})),f.a.mCf(y)&&this.YOg++,f.a.nGf(y)&&this.ofh++)}MQf(){this.PIe=new Date}NQf(){this.PWb=
this.ywc=new Date}W0k(){return{["numberOfConnectionAttempts"]:this.HLe,["numberOfSuccessfulConnections"]:this.$xc,["numberOfFailedConnections"]:this.F8g,["numberOfDisconnectedConnections"]:this.D8g,["numberOfExplicitDisconnectedConnections"]:this.E8g,["numberOfSentMessages"]:this.K8g,["numberOfReceivedMessages"]:this.J8g,["numberOfLostMessages"]:this.I8g,["firstConnectionAttempt"]:this.lVb?this.lVb:null,["firstMessageReceived"]:this.qKa?this.qKa:null,["firstConnectionSuccess"]:this.qjd?this.qjd:null,
["lastConnectionAttempt"]:this.nIe?this.nIe:null,["lastConnectionSuccess"]:this.$ab?this.$ab:null,["lastConnectionFailure"]:this.oIe?this.oIe:null,["lastMessageSent"]:this.LWa?this.LWa:null,["lastMessageLost"]:this.BIe?this.BIe:null,["lastDisconnect"]:this.PWb?this.PWb:null,["lastExplicitDisconnect"]:this.iwc?this.iwc:null,["lastTimeOnline"]:this.ywc?this.ywc:null,["lastTimeOffline"]:this.PIe?this.PIe:null,["maxDisconnectedTimeMs"]:this.pxc,["maxExplicitDisconnectedTimeMs"]:this.fKe,["clientConnectionErrors"]:this.YOg,
["serverConnectionErrors"]:this.ofh}}a4k(){this.lVb&&1===this.$xc&&(this.pxc=Math.max(this.pxc,this.$ab.getTime()-this.lVb.getTime()));this.PWb&&1<this.$xc&&(this.pxc=Math.max(this.pxc,this.$ab.getTime()-this.PWb.getTime()));this.iwc&&1<this.$xc&&(this.fKe=Math.max(this.fKe,this.$ab.getTime()-this.iwc.getTime()))}static createInstance(y){x._instance||(x._instance=new x,l.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",y));return x._instance}}x._instance=null;Object(F.a)(x,
"RealtimeChannelMetrics",null,[886,200])},1876:function(F,K,c){c.d(K,"a",function(){return l});F=c(0);class l extends Sys.EventArgs{constructor(f,a){super();this.type=f;this.dra=a}}Object(F.a)(l,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1877:function(F,K,c){c.d(K,"a",function(){return l});F=c(0);class l extends Sys.EventArgs{constructor(f){super();this.jEd=f}}Object(F.a)(l,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},2066:function(F,K,c){c.r(K);var l=c(0),f=c(55);class a{constructor(Da,
nb){this.Tea=null;this.hzc=Da;this.Ufk=nb}init(){this.hzc.continueWith(()=>{this.Tea=this.hzc.result;this.Tea.U0b(Object(f.a)(this,this.Mca,"onUsersUpdated"))})}Mca(){a.y2e(this.Tea.L0a())&&(this.Tea.n6f(Object(f.a)(this,this.Mca,"onUsersUpdated")),this.Ufk.IsRealCoauthSession=!0)}get CRm(){return this.Tea?a.y2e(this.Tea.L0a()):!1}static y2e(Da){let nb=null;for(const nc of Da)if(nc)if(Da=nc.isAnonymous||!nc.email?nc.clientId:nc.email.toUpperCase(),!nb)nb=Da;else if(nb!==Da)return!0;return!1}}Object(l.a)(a,
"CoauthTelemetry",null,[246]);var k=c(7),x=c(457),y=c(67),n=c(2),u;(function(Da){Da[Da.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";Da[Da.notImplemented=1]="notImplemented";Da[Da.renderHandled=2]="renderHandled";Da[Da.renderHandledWithVeto=3]="renderHandledWithVeto"})(u||(u={}));Object(l.b)("CoauthorGalleryTelemetryEndResult",u);var z=c(83),w=c(82),E=c(129);class G{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc){this.Gah=this.sPg=this.uD=null;this.Q5=Da;this.uvd=new x.a;this.Fa=nc;this.gwe=
nb;this.WY=Hc;this.Tf=bd;this.aOe=ee;this.Tbb=ic;this.aXj=af;this.rYg=this.kYg=!1;this.Pwd=0;this.qPg=1;this.Orb=Vc;this.bDc=this.Fa.$("PeoplesWellExtraButtonInfoIsEnabled");this.Xda=Object(y.a)(String,n.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get Wvj(){return this.uvd.task}init(){E.Task.WAA.call(null,this.Tbb,this.gwe,this.aOe).continueWith(()=>{this.uD=this.Tbb.result;this.sPg=this.gwe.result;this.Gah=this.aOe.result;E.Task.WAA.call(null,this.gwe.result.g3b,this.aOe.result.Fzj).continueWith(()=>
{this.qPg=this.sPg.g3b.result;this.Pwd=this.Gah.Fzj.result;this.uD.U0b(Object(f.a)(this,this.T8d,"onUsersUpdatedEventListener"));this.uD.L0a().length&&this.Mca()})})}T8d(){this.Mca()}Mca(){this.aXj(this.uD.L0a())?(this.uD.n6f(Object(f.a)(this,this.T8d,"onUsersUpdatedEventListener")),this.gpn(this.kYg)):this.uvd.YR(1);this.kYg=!0}gpn(Da){this.rYg?this.Wvj.continueWith(()=>{k.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",u[this.Wvj.result])}):(this.rYg=
!0,this.xKn(0===this.qPg&&!Da))}xKn(Da){Da?this.WY.Ak(4,Object(f.a)(this,this.HUf,"onInteractiveReady")):this.uvd.YR(1)}HUf(){const Da=this.Tf.gF("AppInitStatus_interactivityReady");k.ULS.shipAssertTag(42259235,325,!!this.Pwd);const nb=this.Pwd-Da,nc={};nc.InteractiveTime=Da;nc.ReactRenderComplete=this.Pwd;nc.HadTabSwitch=this.Orb();nc.IsModernGallery=this.bDc;k.ULS.sendTraceTag(594883104,325,50,w.a.toJSON(nc));this.bDc?(k.ULS.sendTraceTag(42062997,325,15,nb.toString()),this.uvd.YR(this.v3o(nb)?3:
2)):k.ULS.sendTraceTag(594883103,325,15,nb.toString())}v3o(Da){const nb=Da>this.Fa.mc("CoauthorGalleryTimeToRenderDurationMs",1E4),nc="Word"===this.Xda;if(this.Orb())return k.ULS.sendTraceTag(50455714,325,50,nb.toString()),!1;nc&&z.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);nb&&(nc&&z.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),k.ULS.sendTraceTag(42062998,325,15,Da.toString()));
return nb}}Object(l.a)(G,"CoauthorGalleryTelemetry",null,[244]);class H{constructor(Da){this.uD=null;this.Qfd={};this.yrd={};this.Tuc=null;this.Tbb=Da}NRd(Da){const nb=new x.a;this.init().continueWith(()=>{Da in this.Qfd?nb.YR(this.Qfd[Da]):this.yrd[Da]=nb});return nb.task}init(){if(this.Tuc)return this.Tuc.task;this.Tuc=new x.a;this.Tbb.continueWith(()=>{this.uD=this.Tbb.result;this.uD.U0b(Object(f.a)(this,this.Mca,"onUsersUpdated"));this.DHj();this.Tuc.Bg(null)});return this.Tuc.task}DHj(){const Da=
this.uD.L0a();Da.sort(Object(f.a)(this,this.A3k,"comparePresenceUsers"));this.Qfd={};for(let nb=0;nb<Da.length&&Da[nb]&&Da[nb].LQa;nb++)this.Puk(this.Qfd,Da[nb].clientId,nb)}Puk(Da,nb,nc){Da[nb]=nc;nb in this.yrd&&(this.yrd[nb].YR(nc),delete this.yrd[nb])}Mca(){this.DHj()}A3k(Da,nb){return Da.LQa>nb.LQa?1:Da.LQa<nb.LQa?-1:0}}Object(l.a)(H,"CoauthorPositionFinder",null,[245]);var L=c(583),I=c(354),N=c(498),Q=c(74),M=c(140);class J{constructor(){this.QBa=null;this.Jpc=Array(32)}xor(Da){if(!Da)throw Error.argumentNull("Guid argument cannot be null");
const nb=new J,nc=new Sys.StringBuilder;for(let Hc=0;Hc<Da.Jpc.length;Hc++){const bd=this.Jpc[Hc]^Da.Jpc[Hc];nb.Jpc[Hc]=bd;nc.append(bd.toString(16));7!==Hc&&11!==Hc&&15!==Hc&&19!==Hc||nc.append("-")}nb.QBa=M.a.Ef(nc.toString());return nb}toString(){return this.QBa.toString()}equals(Da){if(!Da)throw Error.argumentNull("Guid argument cannot be null");return this.QBa.equals(Da.QBa)}static f7b(Da){if(!Da)throw Error.argumentNull("String input cannot be null");const nb=new J;nb.QBa=M.a.Ef(Da);const nc=
nb.QBa.toString();let Hc=0;for(let ee=0;ee<nc.length;ee++){var bd=Da.charAt(ee);if(J.zMm(bd))bd=J.dtm(bd,Da.charCodeAt(ee)),nb.Jpc[Hc++]=bd;else if(!J.WLm(bd))throw Error.argument("String contains characters not valid in Guids");}return nb}static zMm(Da){return"0"<=Da&&"9">=Da||"A"<=Da&&"F">=Da||"a"<=Da&&"f">=Da}static WLm(Da){return"{"===Da||"}"===Da||"-"===Da}static dtm(Da,nb){if("0"<=Da&&"9">=Da)return nb-48;if("A"<=Da&&"F">=Da)return nb-65+10;if("a"<=Da&&"f">=Da)return nb-97+10;throw Error.argument("Char is not valid hex digit");
}}Object(l.a)(J,"Guid",null,[]);class V{constructor(Da,nb,nc,Hc){this.Tea=null;this.IRg=this.I7g=!1;this.K4g=0;this.hzc=Da;this.yUe=nb;this.Fa=nc;this.yXb=Hc;this.vWj=n.AFrameworkApplication.wRb||n.AFrameworkApplication.bpa;this.R5g=new L.a(I.a.Fh())}get Pcf(){return this.Fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.hzc.continueWith(()=>{this.Tea=this.hzc.result;this.Tea.U0b(Object(f.a)(this,this.Mca,"onUsersUpdated"))})}Mca(){this.T0k(this.Tea.L0a())}T0k(Da){var nb=
0;const nc=new N.a(I.a.Fh());for(const Hc of Da)if(Hc&&Hc.isAnonymous){n.AFrameworkApplication.ue("70eb6120;2gfeb930");if(nc.mb(Hc.userName))nc.J(Hc.userName).add(Hc.clientId);else{let bd;nc.add(Hc.userName,(bd=new Q.a,bd.add(Hc.clientId),bd))}Hc.clientId!==this.yXb?(nb++,2<=nb&&!this.I7g&&this.Q5m()):!this.IRg&&this.Pcf&&"Guest"===Hc.userName&&(k.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.IRg=!0)}if(this.Pcf&&this.K4g!==nb){k.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",
nb+(this.vWj?1:0));this.K4g=nb;for(let Hc of nc.keys)2<=nc.J(Hc).count&&(Da=this.RVl(nc.J(Hc)),this.R5g.contains(Da)||(nb={},nb.guestsWithSameName=nc.J(Hc).count,nb.identifier=Da,k.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",nb),this.R5g.add(Da)))}}Q5m(){k.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.I7g=!0;this.Pcf&&this.yUe&&this.yUe.continueWith(()=>{window.setTimeout(()=>{this.yUe.result.logActivity("MultipleGuestsCoauthoring",
null)},15E3)})}RVl(Da){if(!Da||1>=Da.count)return"";let nb=J.f7b(Da.J(0));for(let nc=1;nc<Da.count;nc++)nb=nb.xor(J.f7b(Da.J(nc)));return nb.toString()}}Object(l.a)(V,"GuestCoauthTelemetry",null,[]);var X=c(242);class W{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(l.a)(W,"PL",null,[]);var U=c(35);class Y{constructor(){this.ct=this.vt=this.d=0}static Rjj(Da,nb,nc){const Hc=new Y;Hc.d=Da;Hc.vt=nb;Hc.ct=nc;return U.c(Hc)}}Object(l.a)(Y,"VD",null,
[]);var ba=c(115);class aa{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc,Mg,We){this.xfh=!1;this._id=Da;this.gi=nb;this.khh=nc;this.es=Hc;this.$Ke=bd;this.nVe=ee;this.Myb=ic;this.Esb=af;this.IZj=Vc;this.Orb=Mg;this.Ekh=We;this.Xda=Object(y.a)(String,n.AFrameworkApplication.sessionStartInfoSettings.Application)||""}hpe(Da){const nb=[this.$Ke,this.nVe];this.Ekh&&nb.push(this.khh);E.Task.WAA.apply(null,nb).continueWith(()=>{if(this.$Ke.result<=this.nVe.result)Da.YR(!1);else{this.Ekh&&(this.gi=this.khh.result);
var nc=this.es-this.gi,Hc=new W;Hc.id=this._id;Hc.et=this.es;Hc.st=this.gi;Hc.d=this.es-this.gi;Hc.mp=this.$Ke.result;Hc.tp=this.nVe.result;Hc.ct=this.ZQl(this.IZj);Hc.vc=this.Orb();var bd=U.c(Hc),ee="Word"===this.Xda,ic="PowerPoint"===this.Xda;k.ULS.sendTraceTag(42078597,302,15,bd);if(ee){const af=new Map;af.set("data",bd);z.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",af)}nc>this.Myb.value&&!this.xfh&&!Hc.vc&&(this.xfh=!0,Da.YR(!0),Hc=Object.assign(new ba.a,{inStaging:!0,
extendedProperties:new Map}),Hc.extendedProperties.set("data",bd),ee&&z.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Hc),nc<this.Esb.value&&(k.ULS.sendTraceTag(42078598,302,15,Y.Rjj(nc,this.Myb.value,this.Esb.value)),nc=n.AFrameworkApplication.K.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),ic&&nc&&z.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],
!1,!0,!0,!1,Hc)));Da.task.isCompleted||Da.YR(!1)}})}ZQl(Da){switch(Da){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(l.a)(aa,"PresenceLatencyActivityLogger",null,[]);class fa{constructor(Da,nb,nc){this.iOg=this.oPg=this.wfd=this.Pfd=this.ESb=0;this._id=Da;this.Myb=nb;this.Esb=nc;this.Xda=Object(y.a)(String,n.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get Mrh(){return this.ESb}set Mrh(Da){this.ESb=Da;this.g7e()}get BFh(){return this.Pfd}set BFh(Da){this.Pfd=
Da;this.g7e()}get FBh(){return this.wfd}set FBh(Da){this.wfd=Da;this.g7e()}get CFh(){return 0!==this.oPg}get GBh(){return 0!==this.iOg}g7e(){!this.CFh&&this.ESb&&this.Pfd&&(this.oPg=this.hpe(this.Pfd,"CoauthGalleryLightupDurationTooLong"));!this.GBh&&this.ESb&&this.wfd&&(this.iOg=this.hpe(this.wfd,"CanvasPresenceLightupDurationTooLong"))}hpe(Da,nb){const nc=Da-this.ESb;var Hc=new W;Hc.id=this._id;Hc.et=Da;Hc.st=this.ESb;Hc.d=nc;var bd=U.c(Hc),ee="Word"===this.Xda;Da="PowerPoint"===this.Xda;Hc="CanvasPresenceLightupDurationTooLong"===
nb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===nb?k.ULS.sendTraceTag(572289499,302,15,bd):k.ULS.sendTraceTag(571524118,302,15,bd);if(ee){var ic=new Map;ic.set("data",bd);z.Health.instance.recordKpiUsage(Hc,0,"wordcollabrel",ic)}return nc>this.Myb.value?(ic=Object.assign(new ba.a,{inStaging:!0,extendedProperties:new Map}),ic.extendedProperties.set("data",bd),bd=nc<this.Esb.value,ic.extendedProperties.set("cash",bd?"true":"false"),ee&&z.Health.instance.recordKpiFailure(Hc,
nb,!1,!0,ic),ee=n.AFrameworkApplication.K.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientRenderLatencyQoSError"),Da&&ee&&z.Health.instance.recordQosError(nb,[Hc],!1,!0,!0,!1,ic),k.ULS.sendTraceTag(572289500,302,15,Y.Rjj(nc,this.Myb.value,this.Esb.value)),bd?2:1):3}}Object(l.a)(fa,"PresenceLightupLatencyLogger",null,[]);var na=c(47),oa=c(164);class ja{constructor(Da,nb,nc,Hc,bd,ee,ic,af=null,Vc=null,Mg=null){this.Mbh={};this.fwe={};this.n3g=new Q.a;this.efd=this.Uuc=this.uD=
this.hj=null;this.ETe=this.BTe=0;this.Myb=new X.a(()=>af.IO("PresenceBootLatencyThreshold",1E4));this.Esb=new X.a(()=>af.IO("PresenceBootLatencyCutoffThreshold",6E4));this.gpk=new X.a(()=>af.IO("PresenceLightupLatencyThreshold",2E3));this.L0j=new X.a(()=>af.IO("PresenceLightupLatencyCutoffThreshold",1E4));this.WY=Hc;this.Fa=af;this.agk=bd;this.rPg=Da;this.keh=nb;this.Tbb=nc;this.Tf=ee;this.yXb=Vc;this.Orb=ic;this.yYg=Mg;this.vue=!1;this.init()}cLc(Da,nb,nc=null,Hc=0){nc&&(k.ULS.shipAssertTag(42274970,
302,!this.yXb||this.yXb===nc,"_myClientId is already set and you are trying to update it to something different"),this.yXb=nc);const bd=new x.a;this.init().continueWith(()=>{this.atn(Da);this.Bvl(bd,Da,nb,Hc)})}get wQf(){return this.yXb||"{"+n.AFrameworkApplication.userSessionId+"}"}init(){if(this.Uuc)return this.Uuc.task;this.Uuc=new x.a;this.Orb()&&k.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.rPg.continueWith(()=>{const Da=this.rPg.result,nb=Da.g3b,nc=Da.wfn;nc.continueWith(()=>
{nb.continueWith(()=>{this.yYg&&this.yYg.addQosPillar("RealTimeCoauth");this.ygg(nb.result,nc.result);this.Uuc.Bg(null)})})});this.keh.continueWith(()=>{this.hj=this.keh.result;this.hj.Kta(Object(f.a)(this,this.qun,"onRtcConnection"));this.hj.g3(Object(f.a)(this,this.dnn,"onCoauthorBootReceived"))});this.Tbb.continueWith(()=>{this.uD=this.Tbb.result;this.uD.U0b(Object(f.a)(this,this.T8d,"onUsersUpdatedEventListener"));0<this.uD.L0a().length&&this.Mca()});return this.Uuc.task}q6h(){return this.Tf.Sfa(na.a.k8a)?
this.Tf.gF(na.a.k8a):oa.a.peb?window.performance.timing.fetchStart:-1}Bai(){this.efd||(this.efd=new x.a,this.WY.Ak(4,()=>{this.efd.YR(this.Tf.gF("AppInitStatus_interactivityReady"))}));return this.efd.task}qun(Da,nb){if(!this.vue&&2===nb.newState)if(this.Foe){const nc=this.Bai();nc.continueWith(()=>{var Hc=nc.result;Hc=Date.now()-Hc;const bd={};bd.clientId=this.wQf;bd.bootTime=Hc;this.vue=!0;this.hj.bN(15,bd)})}else Da=this.q6h(),Da=Date.now()-Da,nb={},nb.clientId=this.wQf,nb.bootTime=Da,this.vue=
!0,this.hj.bN(15,nb)}dnn(Da,nb){if(15===nb.type){Da=Date.now();nb=nb.yL;var nc=nb.bootTime;this.Crf(nb.clientId).Mrh=Da-nc}}T8d(){this.Mca()}Mca(){const Da=Date.now();var nb=this.uD.L0a();const nc=new Q.a;for(const Hc of nb)this.n3g.contains(Hc.clientId)||(this.n3g.add(Hc.clientId),nc.add(Hc.clientId));if(0<nc.count)for(let Hc of nc)nb=this.Crf(Hc),nb.CFh||(nb.BFh=Da)}atn(Da){Da=this.Crf(Da);Da.GBh||(Da.FBh=Date.now())}Crf(Da){return Da in this.fwe?this.fwe[Da]:this.fwe[Da]=new fa(Da,this.gpk,this.L0j)}ygg(Da,
nb=0){this.BTe=Da;this.ETe=nb?nb:(new Date).getTime()}Bvl(Da,nb,nc,Hc){nc=nc?nc.getTime():(new Date).getTime();if(nb in this.Mbh)Da.xja();else{const bd=this.Foe?0:this.fem(),ee=this.Foe?this.gem():null;Hc=new aa(nb,bd,ee,nc,this.NRd(this.wQf),this.NRd(nb),this.Myb,this.Esb,Hc,this.Orb,this.Foe);this.Mbh[nb]=Hc;Hc.hpe(Da)}}fem(){return 1===this.BTe?this.ETe:this.q6h()}gem(){return 1===this.BTe?E.Task.P3(this.ETe):this.Bai()}NRd(Da){return this.agk.NRd(Da)}get Foe(){return this.Fa.$("UseAppInteractiveBootTimeForPresenceTelemetry")}}
Object(l.a)(ja,"PresenceBootTelemetry",null,[243]);var qa=c(131),Ia=c(178),Va=c(231),Na=c(22),za=c(623);class la{get name(){return"Common.App.CoauthTelemetry"}xc(Da){Da.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").singleInstance().Rd(()=>new a(za.a.zp(Da.Sa("Common.IPeopleInfoProvider")),n.AFrameworkApplication.Lg));Da.register(G,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").singleInstance().Rd(()=>
new G(n.AFrameworkApplication.va,za.a.zp(Da.Sa("Common.ICoauthoringTelemeryInfoProvider")),n.AFrameworkApplication.K,qa.a.get_instance(),Va.a.instance,za.a.zp(Da.Sa("Common.IPeoplesWell")),za.a.zp(Da.Sa("Common.IPeopleInfoProvider")),a.y2e,()=>this.syh()));Da.register(ja,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").singleInstance().Rd(()=>new ja(za.a.zp(Da.Sa("Common.ICoauthoringTelemeryInfoProvider")),za.a.zp(Da.Sa("Common.IRealtimeChannelBasic")),
za.a.zp(Da.Sa("Common.IPeopleInfoProvider")),qa.a.get_instance(),Da.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),Va.a.instance,()=>this.syh(),n.AFrameworkApplication.K,null,z.Health.instance));Da.register(H,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").singleInstance().Rd(()=>new H(za.a.zp(Da.Sa("Common.IPeopleInfoProvider"))));Da.register(V,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").singleInstance().Rd(()=>new V(za.a.zp(Da.Sa("Common.IPeopleInfoProvider")),
za.a.zp(Da.Sa("Common.ISystemInitiatedFeedback")),n.AFrameworkApplication.K,"{"+n.AFrameworkApplication.userSessionId+"}"))}init(){n.AFrameworkApplication.K.Po(()=>{Na.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Na.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();n.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&Na.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();n.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&
(Na.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),Na.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}syh(){return oa.a.peb&&Va.a.instance.Sfa(na.a.Rbd)?0<Va.a.instance.gF(na.a.Rbd)[na.a.BKj]:!1}static main(){Ia.a.instance.Fc(new la)}}Object(l.a)(la,"CoauthTelemetryPackage",null,[1,2]);class va extends Sys.EventArgs{constructor(){super()}}Object(l.a)(va,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var ia;(function(Da){Da[Da.notYetStarted=
0]="notYetStarted";Da[Da.polling=1]="polling";Da[Da.subscribed=2]="subscribed";Da[Da.blocked=3]="blocked";Da[Da.permanentlyStopped=4]="permanentlyStopped"})(ia||(ia={}));Object(l.b)("RtcHostNotificationSubscriptionState",ia);var pa=c(90),sa=c(1415),Ha=c(80);class ra{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc){this.Kh=!1;this.vaa=this.AYb=this.gfa=this.TXa=null;this.SBc=ra.bse;this.ra=new Ha.a;this.Rcb=new sa.a(0);this.Rcb.f0e(Object(f.a)(this,this.yvn,"onStateMachineChanged"));this.Hik=Da;this.Mtd=nb;
this.Gik=nc;this.VQe=Hc;this.Gb=bd;this.$e=ee;ic.execute(Mg=>{this.Kh||(this.AYb=Mg,this.AYb.g3(Object(f.a)(this,this.A0,"onUpdateNotificationReceived")),this.start())});af.execute(Mg=>{this.Kh||(this.vaa=Mg,Mg.fZa(Object(f.a)(this,this.dia,"onTokenRefreshed")))});this.Mwd=Vc}get Qkc(){return this.Rcb.currentState}get bCi(){return!this.$e||this.$e.Ywa}get uCi(){return 2===this.Qkc&&this.Mwd()<this.SBc}start(){0!==this.Qkc?k.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",
ia[this.Qkc]):(this.Rcb.event(1),this.F$f(null))}F$f(){this.TXa=null;if(this.bCi){k.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",ia[this.Qkc]);let Da=null;this.VQe&&this.VQe.length&&(Da={},Da.etts=this.VQe);this.AYb.bN(14,Da,!0);this.Lhj(this.Hik)}else this.Rcb.event(3)}Lhj(Da){this.TXa=pa.a.S7(1E3*Da,Object(f.a)(this,this.F$f,"sendSubscribeEvent"),this.Mtd,192,"RtcHostNotificationSubscribe");this.Gb.Vb(this.TXa)}fco(Da){Da=1E3*(Da+this.Gik);
const nb=this.Mwd().getTime()+Da;this.SBc=new Date(nb);Da-=this.Mtd;this.gfa?this.Gb.O0(this.gfa,Da):(this.gfa=pa.a.S7(Da,Object(f.a)(this,this.VNo,"transitionToPollingEvent"),this.Mtd/2,194,"RtcHostNotificationTransitionToPolling"),this.Gb.Vb(this.gfa))}VNo(){this.gfa=null;2===this.Qkc&&(this.Rcb.event(1),k.ULS.shipAssertTag(573100185,502,!!this.TXa,"Missing task to ensure that we re-subscribe."))}dia(){this.Rmm()}Rmm(){3===this.Qkc&&this.bCi&&(this.Rcb.event(this.uCi?2:1),this.F$f(null))}A0(Da,
nb){if(13===nb.type&&(Da=nb.yL,k.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:Da,["DurationBeforeExpirationToResubscribeInSec"]:this.Mtd}),nb=Da.cts,!this.FQo(nb))){if(Da.sb){var nc=2;this.fco(Da.cts)}else nc=1,this.SBc=ra.bse,this.gfa&&(this.Gb.Xe(this.gfa),this.gfa=null);this.Rcb.event(nc);this.TXa?this.Gb.O0(this.TXa,1E3*nb):this.Lhj(nb)}}FQo(Da){if(!isNaN(Da)&&isFinite(Da)&&0<Da)return!1;this.kwj(!1);return!0}kwj(Da){this.TXa&&
(this.Gb.Xe(this.TXa),this.TXa=null);this.gfa&&(this.Gb.Xe(this.gfa),this.gfa=null);this.AYb&&(this.AYb.jNb(Object(f.a)(this,this.A0,"onUpdateNotificationReceived")),this.AYb=null);this.vaa&&(this.vaa.hNb(Object(f.a)(this,this.dia,"onTokenRefreshed")),this.vaa=null);Da||this.Rcb.event(4)}yvn(Da,nb){Da=nb.newState;const nc=nb.V_f,Hc={};Hc.NewState=ia[Da];Hc.PreviousState=ia[nc];Hc.PreviousStateHits=nb.W_f;Hc.PreviousStateTransitionTime=nb.X_f.toISOString();Hc.IsSubscribed=this.uCi;this.SBc!==ra.bse&&
(Hc.SubscriptionExpiringTime=this.SBc.toISOString());k.ULS.sendTraceTag(572346515,502,4===Da?15:50,"HostNotificationChanged: {0}",Hc);this.ra.raiseEvent("HN",new va(nc,Da))}dispose(){this.Kh||(this.Kh=!0,this.kwj(!0),this.gfa&&(this.Gb.Xe(this.gfa),this.gfa=null))}}ra.bse=new Date(0);Object(l.a)(ra,"RtcHostNotificationSubscriptionManager",null,[242,10]);var Ma=c(397);class ya{constructor(){this.Zh=this.Kh=!1}get name(){return"RtcHostNotificationSubscription"}xc(Da){Da.register(ra,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").singleInstance().Rd(()=>
{const nb=n.AFrameworkApplication.K;return new ra(nb.mc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),nb.mc("RtcHostNotificationRetryIntervalBufferInSeconds",120),nb.mc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.Sbm(nb),n.AFrameworkApplication.nc,Ma.SessionStatusManager.instance,Da.Sa("Common.IRealtimeChannelBasic"),Da.Sa("Common.ISessionExpirationManager"),()=>new Date)})}init(){n.AFrameworkApplication.K.Po(()=>{!this.Kh&&n.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&
(this.Zh=!0,Na.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Kh||(this.Kh=!0,this.Zh&&Na.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}Sbm(Da){return Da.Sw("RtcEventTypesToSubscribe")?Da.LC("RtcEventTypesToSubscribe"):null}static main(){Ia.a.instance.Fc(new ya)}}Object(l.a)(ya,"RtcHostNotificationSubscriptionPackage",null,[1,2]);var Ga=c(464),wa=c(636);
class hb{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc,Mg,We){this.clientId=Da;this.SkypeChatThreadId=nc;this.chatThreadDiscoveryUri=Hc;this.inChat=bd;this.localColbaltSessionId=nb;this.capabilities=ee;this.email=ic;this.isReadOnly=af;this.userName=Vc;this.isAnonymous=Mg;this.presenceStatus=We}}Object(l.a)(hb,"SerializablePresenceUserData",null,[]);class eb extends Ga.a{constructor(Da,nb,nc,Hc,bd=null,ee=null,ic=null,af=null,Vc=null,Mg=!1,We=!1,Jh=!1,pi=null){super(Da,nb,nc,Hc,ee,ic,af,Vc,Mg,We,Jh);this.bP=
bd;this.presenceStatus=pi}getData(){return new hb(this.clientId,this.bP,this.qGc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}ORd(Da){return(Da=Da.value)?Da.user:null}clone(){return new eb(this.clientId,this.userName,this.color,this.capabilities.clone(),this.bP,this.qGc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static xBb(Da){return Da.clientId?
new eb(Da.clientId,Da.userName,null,new wa.a(void 0===Da.capabilities?0:Da.capabilities),Da.localColbaltSessionId,Da.SkypeChatThreadId,Da.email,null,Da.chatThreadDiscoveryUri,Da.isAnonymous,Da.inChat,Da.isReadOnly,Da.presenceStatus):null}static LLh(Da,nb,nc,Hc=null,bd=null,ee=null,ic=null,af=null,Vc=!1,Mg=!1,We=!1,Jh=null){return Da?new eb(Da,nb,null,new wa.a(void 0===nc?0:nc),Hc,bd,ee,ic,af,We,Vc,Mg,Jh):null}}Object(l.a)(eb,"PresenceUser",Ga.a,[1417,1418,28]);class jb extends eb{constructor(){super();
this.zgc=this.jKf=null}N4l(){const Da=n.AFrameworkApplication.userName,nb=n.AFrameworkApplication.K.jb("UserPrincipalName"),nc=this.jKf?this.jKf.bP:null,Hc=n.AFrameworkApplication.wRb||n.AFrameworkApplication.bpa,bd=this.zgc?this.zgc.getStatus():null;return new eb(this.clientId,Da,this.color,this.capabilities,nc,this.qGc,nb,this.client,this.chatThreadDiscoveryUri,Hc,this.inChat,this.isReadOnly,bd)}}Object(l.a)(jb,"MyPresenceUser",eb,[1464,28]);var ub=c(214);class ab{constructor(Da,nb,nc,Hc,bd){this.Uf=
Da;this._clientId=nb;this.N1j=bd;this.E5j=nc||(()=>null);this.F5j=Hc||(()=>null)}get id(){return this.Uf.id}get Jyd(){return this.Uf.Jyd}get Nyd(){return this.Uf.Nyd}get Myd(){return this.Uf.Myd}get Lyd(){return this.Uf.Lyd}get Kyd(){return this.Uf.Kyd}get Pyd(){return this.Uf.Pyd}get DYe(){return this.Uf.DYe}get qkc(){return this.Uf.qkc}get Kje(){return this.Uf.Kje}get s5d(){return this.Uf.s5d}get clientId(){return this._clientId}get hQc(){return this.E5j}get lib(){return this.F5j}get Npl(){return this.N1j}static createInstance(Da,
nb,nc,Hc,bd=!1){return new ab(Da,nb,nc,Hc,bd)}}Object(l.a)(ab,"PeoplesWellSettings",null,[]);var Ea=c(9),Wa=c(66),Bb=c(171),Mb=c(108),Fb=c(205),vb=c(159),$a=c(399),kb=c(335);class Ua extends Fb.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(l.a)(Ua,"PeopleButtonProps",Fb.a,[]);var Sa=c(414),xb=c(415),Qb=c(19),Ib=c(77);class $b{constructor(Da){this.Sbd=new Ib.a;this.Ocf=null;this.clientId=
Da}Mpo(Da){this.ZZn();this.oio(Da);for(const nb of Da)nb.clientId!==this.clientId&&this.Pph(nb)}get iog(){const Da=[];for(let nb of this.Sbd.values){const nc=this.Dij(nb);Array.add(Da,nc)}return Da}get Xlb(){return this.Sbd.count}u_e(Da,nb){Da=Da.toUpperCase();let nc;({value:nc}=this.Sbd.Dc(Da)).returnValue||(nc=[],this.Sbd.Z(Da,nc));Array.add(nc,nb)}ZZn(){this.Sbd=new Ib.a}oio(Da){for(const nb of Da)if(nb.clientId===this.clientId){this.Ocf=nb;break}}}Object(l.a)($b,"UserTracker",null,[986]);class hc extends $b{constructor(Da,
nb){super(Da);this.G5j=nb}Pph(Da){Da.isAnonymous||!Da.email?this.u_e(Da.clientId,Da):this.Ocf&&I.a.Fh().equals(this.Ocf.email,Da.email)||this.u_e(Da.email,Da)}Dij(Da){let nb=new Date(0),nc=0<Da.length?Da[0]:null;for(const Hc of Da)(Da=this.G5j(Hc.clientId))&&nb.getTime()<Da.Scc.getTime()&&(nb=Da.Scc,nc=Hc);return nc}}Object(l.a)(hc,"UniqueUserTracker",$b,[]);class pb extends $b{constructor(Da){super(Da)}Pph(Da){this.u_e(Da.clientId,Da)}Dij(Da){return Da[0]}}Object(l.a)(pb,"UserInstanceTracker",$b,
[]);const dc=(Da,nb,nc)=>nc?new hc(Da,nb):new pb(Da);var Ob=c(68),Vb=c(596),ob=c(13);class Xb{constructor(Da,nb=null,nc=null){this.uD=null;this.wVe=new x.a;this.Uf=Da;this.u$d=nb;nc&&nc.continueWith(()=>{this.uD=nc.result;this.uD.U0b(Object(f.a)(this,this.Mca,"onUsersUpdated"));this.dde()});new Ga.a(this.settings.clientId,"Anonymous user","#cccccc",new wa.a(7));this.cZd=this.pHe=!0;this.fDe=this.$Ne=!1;this.nza=dc(this.settings.clientId,this.settings.lib,Da.Npl)}get settings(){return this.Uf}get kIm(){return n.AFrameworkApplication.K?
n.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get Bvi(){return n.AFrameworkApplication.K?n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}XSl(){let Da;let nb,nc,Hc,bd;var ee=this.YSl();this.nza.Xlb?1===this.nza.Xlb?(nb=!0,nc=this.settings.qkc.cluster,Hc=this.settings.qkc.zHd,bd=this.nza.iog[0].color):(nb=!0,nc=this.settings.s5d.cluster,Hc=this.settings.s5d.zHd,bd=""):(nb=!1,bd=Hc=nc="");Da=ee[0];ee=ee.slice(1);return{Kyn:Da,Lyn:ee,Gyn:nb,Rlp:nc,Iyn:Hc,Hyn:bd}}YSl(){if(2<=
this.nza.Xlb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.nza.Xlb)];if(1===this.nza.Xlb){const Da=this.nza.iog[0],nb=this.settings.lib(Da.clientId);return nb&&2===nb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Da.userName]:[Da.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,Da.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}Xim(Da){return this.Yim(Da)}gBh(Da,
nb,nc){return nb?this.zTk(nb)?(Da=this.settings.lib(Da))&&2===Da.status?!1:!0:(nc&&k.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(nc&&k.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}mem(Da){return Da.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}Yim(Da){if(!Da.capabilities.JEa(1))return this.mem(Da);const nb=Da.isReadOnly,nc=this.settings.lib(Da.clientId);
Da=this.settings.hQc(Da.clientId);if(!nc)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(nc.status){case 1:return Da?nb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.b8k(Da)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}c0l(Da){if(this.u$d.LWc)return this.u$d.JBb(Da.email,
"O365",n.AFrameworkApplication.im,0)}Iim(Da){Da=this.settings.lib(Da.clientId);return!Da||Da&&1===Da.status?!0:!1}Kim(Da){var nb=String.format("buttonPeoplesWellUser-{0}",Da.clientId),nc=Da.clientId,Hc=this.Xim(Da);const bd=Da.userName,ee=Da.color;var ic=Object,af=ic.assign,Vc=new Ua,Mg=this.settings.Pyd.toString(),We=this.settings.Kje.cluster,Jh=this.settings.Kje.zHd,pi=this.s8h(),Yj=Da.isAnonymous,Zk;if(Zk=[bd],Zk.length){var sj=new Sys.StringBuilder("STRARRY@");for(const tk of Zk)sj.append(tk?
tk.length:0),sj.append(","),sj.append(tk),sj.append(",");Zk=sj.toString().slice(0,-1)}else Zk=null;nb=af.call(ic,Vc,{Id:nb,Command:Mg,LabelText:"{0}",Image32by32:We,Image32by32Class:Jh,MenuItemId:nc,CommandValueId:nc,Alt:bd,DisplayMode:pi,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Hc,ImageBackColor:ee,IsAnonymous:Yj,LabelTextUserGeneratedPlaceholderReplacements:Zk,Upn:Da.email});n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.u$d&&(nc=this.c0l(Da),Hc=this.Iim(Da),nb.ImageUrl=nc,nb.ActiveStatus=Hc,nb.JoinTimeInMS=Da.LQa,Da=this.gBh(Da.clientId,this.settings.hQc(Da.clientId),!1),nb.CanJump=Da,""===nc&&k.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return nb}nZl(){return Object.assign(new Fb.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}s8h(){return this.kIm?"Initials":
"Menu32"}Mim(Da){const nb=[];for(const nc of Da)Da=this.Kim(nc),Array.add(nb,Da);return nb}CYd(){return 0<this.nza.Xlb}NNn(Da){if(!this.pHe)return!0;this.cZd||(Da[Vb.a.Visible]=!0);let nb,nc,Hc,bd,ee;({Kyn:nb,Lyn:nc,Gyn:Hc,Iyn:bd,Hyn:ee}=this.XSl());Da[Vb.a.LabelText]=nb;nc&&nc.length&&(Da[Vb.a.LabelTextUserGeneratedPlaceholderReplacements]=nc);Da[Vb.a.ImageIsVisible]=Hc;Da[Vb.a.Image16by16Class]=bd;Da[Vb.a.ImageBackColor]=ee;this.pHe=!1;return!0}bFn(Da){if(0>=this.nza.Xlb)return!1;var nb=this.$Ao(this.nza.iog),
nc=this.Mim(nb);nb=Object.assign(new $a.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});nc=Object.assign(new kb.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.s8h(),ControlList:nc});n.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.u$d&&(nc.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,nc.TitleId="menuCoauthorsTitle",nc.Theme="Light");Array.add(nb.MenuSectionList,nc);n.AFrameworkApplication.K.$("DocChatIsEnabled")&&n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
n.AFrameworkApplication.ta&&n.AFrameworkApplication.ta.Nb.yr&&(nc=[],Array.add(nc,this.nZl()),nc=Object.assign(new kb.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:nc}),Array.add(nb.MenuSectionList,nc));n.AFrameworkApplication.ta&&n.AFrameworkApplication.ta.Nb.yr?Da.MenuItems=nb:Da.PopulationXML=vb.o(nb);return!0}fog(Da){k.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Da=Da.MenuItemId;if(!Da)return!1;const nb=this.settings.hQc(Da);if(!this.gBh(Da,nb,
!0))return!1;this.lXm(nb);return!0}LUn(){const Da=this.iNl();this.nza.Mpo(Da);this.cZd&&1<=this.nza.Xlb&&(k.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.cZd=!1);this.pHe=!0}Mca(){this.fDe||(window.setTimeout(()=>{this.dde();this.fDe=!1},3E3),this.fDe=!0)}iNl(){let Da;Da=this.hNl()||[];for(const nb of Da)this.Jao(nb);return Da}Jao(Da){Da.clientId||(Da.clientId=M.a.create().toString());Da.userName||(Da.userName="Anonymous user");Da.capabilities||(Da.capabilities=
new wa.a);Da.color||(Da.color="#cccccc");Da.LQa||(Da.LQa=0)}$Ao(Da){const nb=[];Array.addRange(nb,Da);nb.sort(Xb.tyn);return nb}cYn(){n.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.$Ne&&(n.AFrameworkApplication.va.y_(ob.a.NFh)&&Sa.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||n.AFrameworkApplication.va.eb(ob.a.NFh,Ob.a.frame,Object(f.a)(this,this.enn,"onCoauthorGalleryFirstRender"),96));this.dYn();this.$Ne=
!0;this.dde()}enn(Da,nb,nc,Hc,bd){this.wVe.YR(bd.RenderTime);return 32}get Fzj(){return this.wVe.task}dde(){if(!this.$Ne&&(this.wVe.YR((new Date).getTime()),k.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.Bvi))return;this.LUn();this.Bvi&&this.cZd?n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||xb.a.Aec("ribbon","coauthorGallery"):
(n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(xb.a.ppa("ribbon","coauthorGallery"),xb.a.zRa("ribbon","coauthorGallery")),this.MUn())}dispose(){this.uD&&(this.uD.n6f(Object(f.a)(this,this.Mca,"onUsersUpdated")),this.uD=null)}static tyn(Da,nb){return Da.capabilities.JEa(1)&&nb.capabilities.JEa(1)||!Da.capabilities.JEa(1)&&!nb.capabilities.JEa(1)?Qb.a.localeCompare(Da.userName,nb.userName):Da.capabilities.JEa(1)?
-1:1}}Object(l.a)(Xb,"APeoplesWell",null,[922,10]);var Xa=c(12);const Pb=()=>!0;class rc extends Xb{constructor(Da,nb,nc=null,Hc=null){super(Da,nc,Hc);this.ZIm=(bd,ee,ic,af,Vc)=>this.M1a(ic,Vc,()=>this.CYd(),Pb);this.ONn=(bd,ee,ic,af,Vc)=>this.M1a(ic,Vc,Mg=>this.NNn(Mg),Pb);this.cFn=(bd,ee,ic,af,Vc)=>this.M1a(ic,Vc,Pb,Mg=>this.bFn(Mg));this.J1k=(bd,ee,ic,af,Vc)=>this.M1a(ic,Vc,Pb,Pb);this.I1k=(bd,ee,ic,af,Vc)=>this.M1a(ic,Vc,Pb,Pb);this.x1o=(bd,ee,ic,af,Vc)=>this.M1a(ic,Vc,Pb,Mg=>this.fog(Mg));this.UCn=
(bd,ee,ic,af,Vc)=>this.M1a(ic,Vc,Pb,()=>{this.dde();return!0});this.ga=nb}M1a(Da,nb,nc,Hc){let bd=!1;switch(Da){case 1:bd=nc(nb);break;case 2:bd=Hc(nb)}return bd?32:8}dYn(){this.ga.qa(this.settings.Jyd,Xa.a.application,this.ZIm);this.ga.eb(this.settings.Nyd,Xa.a.application,this.ONn,96);this.ga.eb(this.settings.Lyd,Xa.a.application,this.J1k,96);this.ga.eb(this.settings.Kyd,Xa.a.application,this.I1k,96);this.ga.eb(this.settings.Myd,Xa.a.application,this.cFn,96);this.ga.qa(this.settings.Pyd,Xa.a.application,
this.x1o);this.ga.eb(this.settings.DYe,Xa.a.application,this.UCn,96)}}Object(l.a)(rc,"ABox4PeoplesWell",Xb,[]);var Ta=c(3),Ab=c(46),Db=c(8),ac=c(28),Pa=c(163);class bb{static isSupported(Da){for(let nb=0;nb<bb.oxj.length;nb++)if(Da===bb.oxj[nb])return!0;return!1}}bb.oxj=[1];Object(l.a)(bb,"RTTDataVersion",null,[]);var lc=c(1633);const rb=Da=>{if("number"!==typeof Da.RK||"number"!==typeof Da.DK)return!1;let nb,nc=!1,Hc=!1,bd=!1;switch(Da.RK){case 0:Hc=nb=!0;break;case 1:bd=nc=Hc=nb=!0;break;case 2:if(null!=
Da.PE&&"number"!==typeof Da.PE)return!1;nb=!0;break;case 4:nb=!0;break;case 3:Hc=nb=!0;break;case 5:nc=nb=!0;break;default:return!1}return nb&&("number"!==typeof Da.PS||"number"!==typeof Da.TS)||Hc&&("object"!==typeof Da.OS||!Da.OS||!lc.validateVersionedCpData(Da.OS))||nc&&("number"!==typeof Da.PE||"number"!==typeof Da.TE)||bd&&("object"!==typeof Da.OE||!Da.OE||!lc.validateVersionedCpData(Da.OE))?!1:!0},La=Da=>{let nb="";if("number"!==typeof Da.I)return{returnValue:!1,jha:"Invalid PacketId Type"};
if("number"!==typeof Da.O)return{returnValue:!1,jha:"Invalid Operation Type"};if("string"!==typeof Da.A)return{returnValue:!1,jha:"Invalid ClientId Type"};if("object"!==typeof Da.AN)return{returnValue:!1,jha:"Invalid Anchor Object Type"};if(!Da.AN)return{returnValue:!1,jha:"Null AnchorObject"};if(!rb(Da.AN)){let nc;try{nc=U.c(Da.AN)}catch(Hc){nc=String.format("Failed to JSON-serialize payload : {0}",Hc)}8E3<nc.length&&(nc=String.format("Payload exceeds maximum length: {0} > {1}, not logging",nc.length,
8E3));nb="Invalid AnchorObject: "+nc+", Client: "+Da.C;return{returnValue:!1,jha:nb}}return!Da.O&&Da.AN.RK?(nb="Invalid RangeKind:"+Da.AN.RK+" for Caret",{returnValue:!1,jha:nb}):2===Da.O&&("number"!==typeof Da.TF||"undefined"!==typeof Da.TX&&"string"!==typeof Da.TX||1!==Da.AN.RK&&Da.AN.RK)?{returnValue:!1,jha:"Invalid TypingData"}:3!==Da.O||"object"===typeof Da.AP&&Da.AP&&"number"===typeof Da.AP.TFA&&"number"===typeof Da.AP.PN&&"number"===typeof Da.AP.TN&&2===Da.AN.RK?6!==Da.O||"object"===typeof Da.MP&&
Da.MP&&"number"===typeof Da.MP.PM&&"number"===typeof Da.MP.TM&&5===Da.AN.RK?4!==Da.O||"object"===typeof Da.SP&&Da.SP&&"number"===typeof Da.SP.PA&&"number"===typeof Da.SP.TA&&"number"===typeof Da.SP.PB&&"number"===typeof Da.SP.TBS&&3===Da.AN.RK&&(Da.AN.PS===Da.SP.PA||Da.AN.PS===Da.SP.PB)?7!==Da.O||"object"===typeof Da.SPS&&Da.SPS&&"string"===typeof Da.SPS.SF&&"boolean"===typeof Da.SPS.SL?null!=Da.ISS&&"number"!==typeof Da.ISS?{returnValue:!1,jha:"invalid StrictlySequentialId"}:{returnValue:!0,jha:nb}:
{returnValue:!1,jha:"Invalid SymbolData"}:{returnValue:!1,jha:"Invalid SplitParaData"}:{returnValue:!1,jha:"Invalid RemoveParaData"}:{returnValue:!1,jha:"Invalid AddParaData"}};var sb=c(1601);class Sb{constructor(Da,nb=null,nc=null){this.i1=this.YXf=this.kjg=null;null!=Da&&(this.kjg=Da);null!=nb&&(this.YXf=nb);null!=nc&&(this.i1=nc)}}Object(l.a)(Sb,"AddParaData",null,[]);class kc{constructor(Da=null,nb=null){this.zlc=this.XXf=null;null!=Da&&(this.XXf=Da);null!=nb&&(this.zlc=nb)}}Object(l.a)(kc,"MergeRemoveParaData",
null,[]);class Lb{constructor(Da,nb,nc,Hc,bd,ee,ic=null,af=null,Vc=null,Mg=null,We=null,Jh=null,pi=0,Yj=null){this.d$c=this.text=this.gQb=this.yPb=this.rZc=this.C0b=this.Jja=null;this.packetId=Da;this.client=nc;this.$s=Hc;this.clientId=nb.toLowerCase();this.eT=bd;this.version=pi;ee&&(this.Jja=ee);null!=ic&&(this.gQb=ic);void 0!==af&&null!==af&&(this.text=af);Vc&&(this.C0b=Vc);Mg&&(this.rZc=Mg);We&&(this.yPb=We);Jh&&(this.d$c=Jh);this.strictlySequentialId=Yj}}Object(l.a)(Lb,"RTTData",null,[]);class Qc{constructor(Da=
null,nb=null,nc=null,Hc=null){this.jjg=this.WXf=this.gjg=this.VXf=null;null!=Da&&(this.VXf=Da);null!=nb&&(this.gjg=nb);null!=nc&&(this.WXf=nc);null!=Hc&&(this.jjg=Hc)}}Object(l.a)(Qc,"SplitParaData",null,[]);class Dc{constructor(Da=null,nb=null){this.Lhg=this.Khg=null;Da&&(this.Khg=Da);null!=nb&&(this.Lhg=nb)}}Object(l.a)(Dc,"SymbolData",null,[]);class Fd{constructor(Da,nb=null,nc=null){null!=Da&&(this.TFA=Da);null!=nb&&(this.PN=nb);null!=nc&&(this.TN=nc)}}Object(l.a)(Fd,"SerializableAddParaDataV1",
null,[]);class pe{constructor(Da=null,nb=null){null!=Da&&(this.PM=Da);null!=nb&&(this.TM=nb)}}Object(l.a)(pe,"SerializableMergeRemoveParaDataV1",null,[]);class ye{}Object(l.a)(ye,"SerializableRTTDataV1",null,[]);class pf{constructor(Da=null,nb=null,nc=null,Hc=null){null!=Da&&(this.PA=Da);null!=nb&&(this.TA=nb);null!=nc&&(this.PB=nc);null!=Hc&&(this.TBS=Hc)}}Object(l.a)(pf,"SerializableSplitParaDataV1",null,[]);class Yf{constructor(Da=null,nb=null){Da&&(this.SF=Da);null!=nb&&(this.SL=nb)}}Object(l.a)(Yf,
"SerializableSymbolDataV1",null,[]);const Ed=Da=>{var nb;if(!({jha:nb}=La(Da)).returnValue)return k.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",nb),null;let nc=nb=null,Hc=null,bd=null,ee=null,ic=null,af=null,Vc=null;Da.WD&&(nb=Da.WD);null!=Da.TF&&(nc=Da.TF);void 0!==Da.TX&&null!==Da.TX&&(Hc=Da.TX);Da.AP&&(bd=new Sb(Da.AP.TFA,Da.AP.PN,Da.AP.TN));Da.MP&&(ee=new kc(Da.MP.PM,Da.MP.TM));Da.SP&&(ic=new Qc(Da.SP.PA,Da.SP.TA,Da.SP.PB,Da.SP.TBS));Da.SPS&&(af=new Dc(Da.SPS.SF,
Da.SPS.SL));null!=Da.ISS&&(Vc=Da.ISS);return new Lb(Da.I,Da.A,Da.C,Da.O,sb.a(Da.AN),nb,nc,Hc,bd,ee,ic,af,1,Vc)},Rc=Da=>{let nb=Da;if("number"===typeof nb.V){if(1===nb.V)return Ed(Da);k.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let nc=0,Hc=null;for(let bd=0;bd<Da.length;bd++)nb=Da[bd],bb.isSupported(nb.V)&&nb.V>nc&&(nc=nb.V,Hc=Da[bd]);return 1===nc?Ed(Hc):null},Yc=Da=>{if(Da){const nb=new ye;nb.I=Da.packetId;nb.V=1;nb.A=Da.clientId;nb.C=Da.client;nb.O=Da.$s;nb.AN=sb.c(Da.eT);
Da.Jja&&(nb.WD=Da.Jja);null!=Da.gQb&&(nb.TF=Da.gQb);void 0!==Da.text&&null!==Da.text&&0<Da.text.length&&(nb.TX=Da.text);Da.C0b&&(nb.AP=new Fd(Da.C0b.kjg,Da.C0b.YXf,Da.C0b.i1));Da.rZc&&(nb.MP=new pe(Da.rZc.XXf,Da.rZc.zlc));Da.yPb&&(nb.SP=new pf(Da.yPb.VXf,Da.yPb.gjg,Da.yPb.WXf,Da.yPb.jjg));Da.d$c&&(nb.SPS=new Yf(Da.d$c.Khg,Da.d$c.Lhg));nb.ISS=Da.strictlySequentialId;Da=nb}else Da=null;return Da};var Mc=c(58);class ge{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc){this.LocalCobaltSessionId=Da;this.SkypeChatThreadId=
nb;this.ChatThreadDiscoveryUri=nc;this.InChat=Hc;this.Capabilities=bd;this.Email=ee;this.UserName=ic;this.IsAnonymous=af;this.PresenceStatus=Vc}}Object(l.a)(ge,"SerializableWacData",null,[]);class Ne{constructor(){this.nvd=this.mvd=0}C5l(){this.nvd===Number.MAX_VALUE&&(this.nvd=0);this.nvd++;return this.nvd}B5l(){this.mvd===Number.MAX_VALUE&&(this.mvd=0);this.mvd++;return this.mvd}static get instance(){return Ne.olk}}Ne.olk=new Ne;Object(l.a)(Ne,"StrictlySequentialIdGenerator",null,[265]);var Ee=
c(1529);class Ve{constructor(Da,nb,nc,Hc,bd,ee,ic,af=0){this.Osa=null;this.dryDeletion=0;this.CI=Da;this.BLa=ee;this.qd=bd;this.Zyb=ic;this.Lc=nb;this.shapeId=af;this.JGa=nc;this.B9=ic.create(this,Hc,bd,ee)}clone(){return new Ve(this.CI,this.Lc,this.JGa,this.B9.Sqb,this.qd,this.BLa,this.Zyb,this.shapeId)}get paragraphId(){return this.Osa?this.Osa:this.CI.Zhb(this.Lc)}GVf(){this.Osa||(this.Osa=this.paragraphId,this.B9.GVf())}isValid(){return 0<=this.B9.cp}getData(){const Da=this.B9.Sqb;return Da?new Ee.a(0,
this.Lc,this.JGa,Da,null,null,null,0,this.shapeId):null}static xBb(Da,nb,nc,Hc,bd){return nb?new Ve(nb,parseInt(Da.TRa),Da.w7a,Da.xR,nc,Hc,bd,Da.shapeId):null}}Object(l.a)(Ve,"WordPresenceIp",null,[240,100,241]);class mc{constructor(Da,nb,nc){this.vTa=this.oca=this.kxc=!1;this.Lbb=Da;this.uWa=nc;this.user=nb}get ip(){return this.uWa}get Mdc(){return this.kxc}set Mdc(Da){(this.kxc=Da)&&this.ip.GVf()}guf(){const Da=Ne.instance.B5l();return new Lb(this.Lbb,this.user.clientId,1,0,this.ip?this.ip.getData():
null,new ge(this.user.bP,this.user.qGc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Da)}t$h(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():Mc.a.nil.toString())}isValid(){const Da=!!this.user&&this.user.isValid(),nb=!this.ip||this.ip.isValid();return Da&&nb}clone(){const Da=new mc;Da.Lbb=this.Lbb;Da.kxc=this.kxc;
Da.user=this.user?this.user.clone():null;Da.uWa=this.ip?this.ip.clone():null;Da.oca=this.oca;Da.vTa=this.vTa;return Da}static Qaf(Da,nb,nc,Hc,bd){if(!Da||!nb)return null;if(Da.$s)return k.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Da.$s),null;let ee;ee=void 0!==Da.Jja&&null!==Da.Jja?eb.LLh(Da.clientId,Da.Jja.UserName,Da.Jja.Capabilities,Da.Jja.LocalCobaltSessionId,Da.Jja.SkypeChatThreadId,Da.Jja.Email,Da.client,Da.Jja.ChatThreadDiscoveryUri,Da.Jja.InChat,
!1,Da.Jja.IsAnonymous,Da.Jja.PresenceStatus):eb.LLh(Da.clientId,null,0,void 0,void 0,void 0,Da.client);return new mc(Da.packetId,ee,Ve.xBb(Da.eT,nb,nc,Hc,bd))}}Object(l.a)(mc,"WordPresenceInfo",null,[248,100]);class Oc extends rc{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc,Mg,We,Jh,pi,Yj){super(Da,ee,Yj,nb);this.kZj=nc;this.Sik=Hc;this.phk=bd;this.hb=ic;Oc.Yt=af;this.CI=Vc;this.qd=Mg;this.BLa=We;this.fYe=Jh;this.CJa=pi}fog(Da){this.CJa.HEi(Da.CommandValueId);return super.fog(Da)}lXm(Da){let nb;({I_f:nb}=
this.CFf(Da)).returnValue&&(this.Sik(nb.ip.paragraphId,nb.ip.B9.cp),n.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Da=Oc.Ucm(nb),void 0!==Da&&null!==Da?(k.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.hb.setSelection(Da),Wa.FocusManager.bK()&&Wa.FocusManager.instance().mg(Bb.AFrame.Pn)):k.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Da=new pa.a(2,1,0,
()=>{this.ga.Qb(Ta.a.lje,2,nb)}),Mb.a.instance.Vb(Da))}Eei(Da){return Da?(Da=mc.Qaf(Rc(Da),this.CI,this.qd,this.BLa,this.fYe.instance))&&Da.isValid()&&Da.ip?Da:null:null}zTk(Da){return this.$Qm(Da)?this.TTk(Da)?!0:(k.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(k.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}$Qm(Da){return!!this.Eei(Da)}CFf(Da){Da=this.Eei(Da);return{returnValue:!!Da,
I_f:Da}}TTk(Da){let nb;return({I_f:nb}=this.CFf(Da)).returnValue?this.kZj(nb.ip.paragraphId,nb.ip.B9.cp):!1}hNl(){if(!this.uD)return[];const Da=[];for(const nb of this.uD.L0a())nb.userName?Da.push(nb):k.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Da}b8k(Da){let nb;return({I_f:nb}=this.CFf(Da)).returnValue&&nb.user&&nb.user.presenceStatus&&"0"!==nb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,nb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}MUn(){this.phk(this.settings.id)}static createInstance(Da,
nb,nc,Hc,bd,ee,ic){const af=Ea.App.xa.ib,Vc=n.AFrameworkApplication.va,Mg=Ab.a.instance,We=Na.a.instance.resolve("Box4.ICoauthCashTelemetry");return new Oc(Da,nb,Jh=>af.rc.Wi?af.rc.m6e(Jh,!0):!1,(Jh,pi)=>{af.rc.Wi&&af.rc.USa(Jh,pi,!0,!0,!1)},()=>{Ea.App.Ev.NI.obd()},Vc,Mg,af,nc,Hc,bd,ee,We,ic)}static Ucm(Da){const nb=Oc.Yt.Uc.od.Db(Da.ip.paragraphId);if(void 0===nb||null===nb)return k.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!Db.ParagraphReader.Wb(nb))return k.ULS.sendTraceTag(20764577,
325,15,"The obtained node is not a paragraph node"),null;Da=ac.a.Qc(nb,Da.ip.B9.cp);return new Pa.Selection([Da],!0)}}Oc.Yt=null;Object(l.a)(Oc,"WordEditorPeoplesWell",rc,[]);class xd{constructor(){this.Px=()=>{n.AFrameworkApplication.u1i?xd.jqa.OD().continueWith(this.t0c):k.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.t0c=()=>{xd.hj=xd.jqa.OD().result;if(xd.hj){var Da=()=>{const nb=Ea.App.xa.ib;return nb?nb.Uc?nb.Uc.od:(k.ULS.sendTraceTag(23196876,
325,15,"ActivePage is null"),null):(k.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Ea.App.Tna().continueWith(()=>{const nb=Ea.App.Tna().result.mj,nc=ub.CuiHelper.a9l(n.AFrameworkApplication.Ws,n.AFrameworkApplication.Ws,n.AFrameworkApplication.Ws,n.AFrameworkApplication.Ws),Hc=ab.createInstance(nc,nb,Object(f.a)(xd.hj.hfe,xd.hj.hfe.hQc,"getUserPresence"),Object(f.a)(xd.hj.hfe,xd.hj.hfe.lib,"getUserStatusInfo"),n.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));
Na.a.instance.ha("RealtimePresenceUI.WordEditorPeoplesWell",()=>Oc.createInstance(Hc,za.a.zp(xd.W.Sa("Common.IPeopleInfoProvider")),xd.W.Na("WordEditor.ParagraphWordIdMapping"),xd.W.Na("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Da,xd.W.Sa("WordEditor.Presence.IWordPresenceCpFactory"),xd.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").singleInstance();xd._instance=Na.a.instance.resolve("Common.IPeoplesWell");xd._instance.cYn();k.ULS.sendTraceTag(23196877,
325,50,"PeoplesWellControl is fully initialized")})}else k.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}xc(Da){xd.W=Da}init(){n.AFrameworkApplication.K.Po(this.Px)}dispose(){xd._instance&&(xd._instance.dispose(),xd._instance=null)}static get jqa(){return null!=xd.pGg?xd.pGg:xd.pGg=Na.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}xd._instance=null;xd.W=null;xd.hj=null;Object(l.a)(xd,
"WordEditorPeoplesWellControlPackage",null,[1,2]);var Dd=c(97),ud=c(160);class He{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc=!1){this.Z8a=null;this.nBe=!0;this.BOe=this.Cl=this.$te=null;this.ra=new Ha.a;this.uLa=Da;this.HZ=nb;this.obh=nc;this.uzc=Hc;this.KMg=ee;He.Gb=bd;this.rgk=ic;this.Q6=af;this.xhk=Vc;E.Task.WAA(nb,nc).continueWith(Object(f.a)(this,this.xym,"initOnTaskReady"))}hAk(Da){this.ra.addHandler("u",Da)}c7i(){this.ra.raiseEvent("u",null,this)}xym(){this.HZ.result&&this.obh.result&&(this.Cl=
this.HZ.result,this.BOe=this.obh.result,this.Cl.iZa(Object(f.a)(this,this.J4,"onPresenceUpdated")),this.$te=new pa.a(2,2,this.KMg,Object(f.a)(this,this.yUo,"updateAwayClientsTask"),88),He.Gb.Vb(this.$te))}J4(Da,nb){(this.nBe||this.nRn(nb.dra))&&He.Gb.O0(this.$te,0)}nRn(Da){for(let nc in Da){var nb=this.uzc.ORd({key:nc,value:Da[nc]});if(nb&&nb.clientId&&(nb=nb.clientId.toLowerCase(),(nb=this.Z8a[nb]||this.Z8a[nb.toUpperCase()])&&2===nb.status))return!0}return!1}yUo(Da){var nb=this.Cl.vNc();if(nb){var nc=
new Date,Hc=!1;if(this.nBe){this.Z8a=nb;this.nBe=!1;var bd=this.Z8a;for(var ee in bd){nb=ee;var ic=bd[ee];ic.Scc<nc&&(nc=ic.Scc);2===ic.status&&(Hc=!0,this.BOe.M4c(nb))}Hc&&this.c7i();He.Gb.O0(Da,this.sci(nc))}else{ic=new Q.a;ee=!1;var af=this.Z8a;for(bd in af){af=bd;if(!(af in this.Z8a)||this.uLa.clientId===af)continue;var Vc=this.Z8a[af];const Mg=nb[af];if(Vc&&Mg){Vc=Vc.status;const We=Mg.status;2===Vc&&1===We?(ic.add(af),k.ULS.sendTraceTag(38052609,392,50,af+" returned from away")):1===Vc&&2===
We&&(ee=Hc=!0,this.BOe.M4c(af),k.ULS.sendTraceTag(38052610,392,50,af+" went away"));1===We&&Mg.Scc<nc&&(nc=Mg.Scc)}}this.Z8a=nb;He.Gb.O0(Da,this.sci(nc));(0<ic.count||Hc)&&this.c7i();0<ic.count&&!this.xhk?(Da=this.hRl(ic),this.HLo(Da)):Da=new Q.a;(ee||0<Da.count)&&this.rgk(ob.a.wEd,2)}}}HLo(Da){if(Da.count)for(let nb of Da)Da=this.Q6.Dma(String.format(CommonUIStrings.l_EditorsToastArriving,nb),!1),Da.image=5,Da.eoa="CoAuth_AuthorStatus_16x16x32",this.Q6.lA(Da)}hRl(Da){const nb=this.Cl.TDb(),nc=new Q.a;
for(let Hc in nb){const bd={key:Hc,value:nb[Hc]};if(Da.contains(bd.key)){const ee=this.uzc.ORd(bd);ee&&(nc.add(ee.userName),Da.remove(bd.key))}}nc.count||k.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return nc}sci(Da){const nb=new Date;return Math.max(Da.getTime()+this.KMg-nb.getTime(),0)}}He.Gb=null;Object(l.a)(He,"AwayManager",null,[]);var uf=c(762);class Lh{constructor(Da=0){this.updates=Da}get Oxf(){return 0!==this.updates}JEa(Da){return!!(this.updates&Da)}x6a(Da){this.updates|=
Da}toString(){if(this.JEa(0))return"none";const Da=new Q.a;this.JEa(1)&&Da.add("user(s) joined");this.JEa(2)&&Da.add("user(s) disconnected");this.JEa(4)&&Da.add("user(s) updated");return Da.toArray().join(", ")}}Object(l.a)(Lh,"UserUpdateEvent",null,[]);var Sf=c(34);class fc{constructor(Da,nb,nc,Hc,bd=null){this.ra=new Ha.a;this.mK=this.hj=null;this.M7g=this.i8g=this.am=!1;this.uq=new Ib.a;Da.continueWith(()=>{this.hj=Da.result;this.hj.iZa(Object(f.a)(this,this.MXi,"onRtcPresenceUpdate"));this.hj.Kta(Object(f.a)(this,
this.LXi,"onRtcConnectionChange"));this.Fng(null,null)});nb.continueWith(()=>{this.mK=nb.result;this.mK.Hdb(Object(f.a)(this,this.X_c,"onEditorsTableUpdated"))});bd&&bd.continueWith(()=>{bd.result.hAk(Object(f.a)(this,this.Fng,"updateUserStatus"));this.Fng(null,null)});this.NLa=nc;this.uzc=Hc}get users(){return this.uq}U0b(Da){this.ra.addHandler("UU",Da)}n6f(Da){this.ra.removeHandler("UU",Da)}Fng(){if(this.hj){var Da=!1,nb=this.hj.vNc();for(let Hc in nb){var nc=nb[Hc];const bd=Hc;this.users.mb(bd)&&
(nc=this.xBj(nc),Da=this.users.J(bd).SAb!==nc||Da,this.users.J(bd).SAb=nc)}Da&&(Da=new Lh(4),this.ige(Da))}}xBj(Da){return 1===Da.status?0:1}L0a(){this.users.count||(this.i8g||(Sf.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.i8g=!0),this.BFn());const Da=[];for(let nb of this.users)Array.add(Da,nb.value);return Da}BFn(){if(this.hj){var Da=this.hj.TDb();this.lNf(Da)}if(this.mK){Da=this.mK.pNc();for(const nb of Da)nb.Id&&(Da=this.VNh(nb.Id),this.Eng(new Lh,Da))}}ALf(Da){({value:Da}=
this.users.Dc(Da));return Da}dispose(){this.am||(this.hj&&(this.hj.iNb(Object(f.a)(this,this.MXi,"onRtcPresenceUpdate")),this.hj.xhc(Object(f.a)(this,this.LXi,"onRtcConnectionChange"))),this.mK&&this.mK.obj(Object(f.a)(this,this.X_c,"onEditorsTableUpdated")),this.am=!0)}LXi(Da,nb){2===nb.newState&&(Da=this.lNf(this.hj.TDb()),Da.Oxf&&this.ige(Da))}X_c(Da,nb){Da=new Lh;var nc=this.mK.pNc();k.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
nc.length,nb.Okn,nb.XQi);const Hc=new Ib.a;for(var bd of nc){nc=bd.Id;const ee=this.VNh(nc);this.Eng(Da,ee);Hc.Z(nc,ee)}if((nb=nb.leaving)&&0<nb.length)for(bd=0;bd<nb.length;bd++)k.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,nb.J(bd).Id),({value:nc}=this.users.Dc(nb.J(bd).Id)).returnValue?nc?(this.users.remove(nb.J(bd).Id),Da.x6a(2),Hc.Z(nb.J(bd).Id,nc)):k.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",nb.J(bd).Id):
k.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",nb.J(bd).Id);nb=this.hj.TDb();for(let ee in nb)bd=this.uzc.ORd({key:ee,value:nb[ee]}),Hc.Z(bd.clientId,bd);for(let ee of this.users)Hc.mb(ee.value.clientId)||(k.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",ee.key),this.users.remove(ee.key),Da.x6a(2));Da.Oxf&&this.ige(Da)}MXi(Da,nb){Da=this.lNf(nb.dra);for(const nc of nb.eJd)this.users.mb(nc)&&(Da.x6a(2),this.users.J(nc).SAb=
2);Da.Oxf&&this.ige(Da)}lNf(Da){const nb=new Lh;if(!Da)return nb;for(let Hc in Da){var nc=this.uzc.ORd({key:Hc,value:Da[Hc]});nc&&(nc=nc.clone(),this.Eng(nb,nc))}return nb}Eng(Da,nb){if(nb){var nc=nb.clientId;var Hc=this.Y7n(nb);({value:nb}=this.users.Dc(nc)).returnValue?nb.equals(Hc)||(Da.x6a(4),this.users.Z(nc,Hc)):(k.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,nc),Da.x6a(1),this.users.Z(nc,Hc))}}VNh(Da){return this.users.mb(Da)?this.users.J(Da):
Ga.a.Mal(Da)}Y7n(Da){if(!Da||!Da.clientId||!this.mK)return Da;const nb=Da.clone();nb.SAb=this.gRl(Da);if(Da=this.mK.D7b(nb.clientId))nb.isReadOnly=nb.isReadOnly||Da.IsReadOnly?!0:!1,nb.userName=this.X7n(nb,Da),nb.capabilities=this.Sdn(nb.capabilities,Da.Capabilities),nb.email=nb.email||Da.SIPAddress||Da.EmailAddress,Da.JoinCoauthTime&&(nb.LQa=Da.JoinCoauthTime);nb.color=this.NLa.o9b(new uf.a(nb.email,void 0,nb.userName,void 0,nb.isAnonymous,nb.clientId),3);return nb}gRl(Da){if(!this.hj)return 2;if(Da&&
Da.clientId){const nb=this.hj.vNc();if(Da.clientId in nb)return this.xBj(nb[Da.clientId])}return 2}s3k(Da,nb){nb.Name&&Da.userName&&nb.Name!==Da.userName&&!this.M7g&&(this.M7g=!0,Sf.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}Sdn(Da,nb){Da=Da||new wa.a;nb&&(nb.SupportsRealtimeChannel&&Da.x6a(1),nb.SupportsRename&&Da.x6a(2),nb.SupportsChat&&Da.x6a(4));return Da}X7n(Da,nb){this.s3k(Da,nb);return nb.Name||Da.userName||(Da.isAnonymous||nb.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}ige(Da){k.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Da.toString());this.ra.raiseEvent("UU")}}Object(l.a)(fc,"PeopleInfoProvider",null,[937,10]);var yc;(function(Da){Da[Da.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Da[Da.peopleImageClassName=1]="peopleImageClassName";Da[Da.peopleImageClusterPath=4]="peopleImageClusterPath";Da[Da.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Da[Da.imageDimension=6]="imageDimension";
Da[Da.rtl=8]="rtl";Da[Da.pointerInputManager=9]="pointerInputManager";Da[Da.clickInputManager=10]="clickInputManager";Da[Da.vertical=11]="vertical";Da[Da.zIndex=12]="zIndex";Da[Da.contextMenuInputManager=13]="contextMenuInputManager";Da[Da.imageDomElement=14]="imageDomElement";Da[Da.useIdleTooltip=15]="useIdleTooltip";Da[Da.viewportBoundsCallback=16]="viewportBoundsCallback";Da[Da.flipHorizontalDirection=17]="flipHorizontalDirection";Da[Da.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
Da[Da.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";Da[Da.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(yc||(yc={}));Object(l.b)("PresenceTooltipSettingKeys",yc);class Uc{constructor(){this.tu={}}get(Da,nb=null){Da=yc[Da];return"number"===typeof nb?(nb=this.tu[Da])?Number.parseInvariant(nb.toString()):0:this.tu[Da]}add(Da,nb){this.tu[yc[Da]]=nb}RMa(Da,nb){yc[Da]in this.tu||(this.tu[yc[Da]]=nb)}remove(Da){delete this.tu[yc[Da]]}}Object(l.a)(Uc,"PresenceTooltipSettings",null,
[]);class zd extends Ha.a{constructor(Da){super();this._element=null;this.element=Da}get element(){return this._element}set element(Da){this._element=Da}get visible(){return"visible"===this.element.style.visibility}set visible(Da){this.element.style.visibility=Da?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Da){this.element.dir=Da?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Da){this.element.style.zIndex=String(Da)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Da){return this.element.ownerDocument.createElement(Da)}kja(){return!0}static iNh(Da){return"prControl"+(Da?"Rtl":"")}}Object(l.a)(zd,"BasePresenceControl",Ha.a,[10,949]);class ie extends Sys.EventArgs{constructor(Da,nb){super();this.type=Da;this.Lo=nb}}ie.jU="InteractivityChanged";Object(l.a)(ie,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class Oe{static pUl(Da){return Oe.qUl(Da)}static qUl(Da){const nb=
document.createElementNS(Oe.lqg,"svg");nb.setAttribute("viewBox",String.format(Oe.Mhl,Oe.rKj,Oe.qKj));nb.appendChild(Oe.cfm(Da));return nb}static cfm(Da){const nb=Oe.rKj/Da,nc=2*nb,Hc=Oe.qKj/2;Da=(Da-12-8)*nb/2;const bd=document.createElementNS(Oe.lqg,"g");Sys.UI.DomElement.addCssClass(bd,Oe.Lhl);for(let ee=1;3>=ee;ee++)bd.appendChild(Oe.TQl(ee,nc,Da+(6*ee-2)*nb,Hc));return bd}static TQl(Da,nb,nc,Hc){const bd=document.createElementNS(Oe.lqg,"circle");Sys.UI.DomElement.addCssClass(bd,String.format("{0}-{1}",
Oe.aYk,Da));bd.setAttribute("cx",String.format("{0}",nc));bd.setAttribute("cy",String.format("{0}",Hc));bd.setAttribute("r",String.format("{0}",nb));return bd}}Oe.lqg="http://www.w3.org/2000/svg";Oe.Lhl="prDancingDots";Oe.aYk="prAnimateCircle";Oe.Mhl="0 0 {0} {1}";Oe.qKj=40;Oe.rKj=120;Object(l.a)(Oe,"ModernPresenceTooltipDancingDots",null,[]);var Ge=c(95),re=c(88),mf=c(11),Xe=c(27),qf=c(137),kf=c(54);class $f extends zd{constructor(Da,nb){super(Da);this.Pkh=this.P$a=this.Nve=this._img=this.pE=this.hs=
this.ig=null;this.fMa=nb.get(8,!1);this.w$a=nb.get(6,0);this.Eok=nb.get(15,!1);this.Uf=nb;this.RUg=0;this.element=Da;this.element.className=$f.wlf;this._span=document.createElement("span");this.element.appendChild(this._span);this.m2j=Oe.pUl(nb.get(6,0));this.UB(nb);this._state=5}szb(Da){this.addHandler(ie.jU,Da)}dNb(Da){this.removeHandler(ie.jU,Da)}get user(){return this.Pkh}get state(){return this._state}dispose(){this.element&&(this.ig.sc(mf.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),
this.ig.sc(mf.a.pB,this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior")),this.hs.sc(mf.a.pointerDown,this.element,Object(f.a)(this,this.ZC,"onPointerDown")),this.hs.sc(mf.a.pointerOut,this.element,Object(f.a)(this,this.IJ,"onPointerOut")),this.hs.sc(mf.a.pointerOver,this.element,Object(f.a)(this,this.gP,"onPointerOver")),this.pE.sc(this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}UB(Da){this.ig=Da.get(10);this.ig.nb(mf.a.click,
this.element,Object(f.a)(this,this.onClick,"onClick"));this.ig.nb(mf.a.pB,this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior"));this.hs=Da.get(9);this.hs.nb(mf.a.pointerOver,this.element,Object(f.a)(this,this.gP,"onPointerOver"));this.hs.nb(mf.a.pointerOut,this.element,Object(f.a)(this,this.IJ,"onPointerOut"));this.hs.nb(mf.a.pointerDown,this.element,Object(f.a)(this,this.ZC,"onPointerDown"));this.pE=Da.get(13);this.pE.nb(this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior"))}hide(Da=
null,nb=0,nc=0){this.Eok&&Da?this.Hxo(Da,nb,nc):(3===this.state&&this.Z$i(),this.visible=!1,this._state=5)}Hxo(Da,nb,nc=0){this.show(Da,nb,15,4,void 0,nc)}Trj(Da,nb,nc=!1,Hc=!1,bd=!1,ee=0){this.show(Da,nb,20,nc?2:Hc?1:0,bd,ee)}exo(Da,nb,nc,Hc=!1,bd=0){this.show(Da,nb,nc+20,3,Hc,bd)}show(Da,nb,nc,Hc=3,bd=!1,ee=0){!Da||Hc===this.state&&this.Zrm(nb,nc)||(this.Wrk(Hc,bd,ee),this.rfa(Da,Hc,ee),this._state=Hc,4===ee||0===ee&&!this.fMa?this.element.style.left=nb+"px":this.element.style.right=nb+"px",this.element.style.top=
nc+"px",this.visible=!0)}rfa(Da,nb,nc){this.Pkh=Da;kf.a.wC(this._span);qf.a.JZk(this._span);this._span.id="fly_"+Da.clientId;this._span.style.backgroundColor=Da.color;4!==nb?(this._span.style.height=this.w$a+"px",this._span.style.lineHeight=this.w$a+"px",qf.a.EOb(this._span,"border-radius",this.w$a+"px")):4===nc||0===nc&&!this.fMa?this._span.style.left="0px":this._span.style.right="0px";2!==nb&&(4===nb?kf.a.Jy(this._span,""):1===nb?this._span.appendChild(this.m2j):(this._span.setAttribute("dir","auto"),
nc=Qb.a.B0l(Da.userName),(!Da.isAnonymous||n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&nc||0!==nb?(Da=Da.userName,0===nb&&(Da=nc,qf.a.EOb(this._span,"text-align","center")),kf.a.Jy(this._span,Da)):(this._img||(this._img=this.H9k()),this._span.appendChild(this._img),qf.a.EOb(this._span,"text-align","start"))))}onClick(Da){if(0===this.state)return this.raiseEvent(ie.jU,new ie(1,Da)),!0;3===this.state&&k.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}IJ(Da){3===this.state&&this.raiseEvent(ie.jU,new ie(3,Da));return!1}gP(Da){3!==Da.lg&&this.raiseEvent(ie.jU,new ie(2,Da));return!1}ZC(Da){if(3!==Da.lg)return!0;this.raiseEvent(ie.jU,new ie(4,Da));return!1}H9k(){const Da=document.createElement("img");Da.src=Ge.a.dba("doughperson_white_glyph.svg");Da.setAttribute("Unselectable","on");Xe.a.hr(Da,Xe.a.qh,Xe.a.fz);return re.createClusteredImageFromClusterWithImageClass(this.w$a,this.w$a,null,null,$f.UGl,
"",!1,"",this.element.ownerDocument,Da)}Wrk(Da,nb=!1,nc=0){if(!this.TTc(this.state)||!this.TTc(Da))switch(Sys.UI.DomElement.removeCssClass(this.element,this.Nve),this.state){case 4:3===Da?this.XYa($f.xlf,$f.f1h):this.TTc(Da)&&this.XYa($f.vlf,$f.f1h);break;case 3:4===Da?this.XYa($f.Alf,$f.e1h):this.TTc(Da)&&(nb&&this.Z$i(),this.XYa($f.vlf,$f.e1h,nb?$f.TGl:""));break;case 0:case 1:case 2:4===Da?this.XYa($f.Alf,$f.ylf):3===Da&&(nb&&this.ctk(),this.XYa($f.xlf,$f.ylf,nb?$f.g1h:"",3===nc?$f.XGl:$f.VGl));
break;default:4===Da?this.XYa($f.Alf):3===Da?this.XYa($f.xlf):this.TTc(Da)&&this.XYa($f.vlf)}}XYa(...Da){this.Nve=Da.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.Nve)}ctk(){this.RUg=window.setTimeout(()=>{this.element&&(this.P$a=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.P$a),this.element.style.zIndex="2",this.P$a.style.zIndex="1")},300)}Z$i(){window.clearTimeout(this.RUg);this.P$a&&(Sys.UI.DomElement.removeCssClass(this.P$a,$f.ylf+" "+$f.g1h),Sys.UI.DomElement.addCssClass(this.P$a,
$f.SGl),E.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.P$a.parentNode&&this.element.parentNode.removeChild(this.P$a)}),qf.a.vhc(this.element,"z-index"))}TTc(Da){return 0===Da||1===Da||2===Da}Zrm(Da,nb){const nc=qf.a.xY(this.element.style.top);return qf.a.xY(this.element.style.left)===Da&&nc===nb}x7f(Da){3===Da&&qf.a.Xaa(this.element,"left")?(Da=qf.a.xY(this.element.style.left),qf.a.vhc(this.element,"left"),this.element.style.right=-1*Da+"px"):4===Da&&qf.a.Xaa(this.element,
"right")&&(Da=qf.a.xY(this.element.style.right),qf.a.vhc(this.element,"right"),this.element.style.left=-1*Da+"px")}}$f.wlf="prModernFlyout UIFont";$f.Alf="flyoutIdle";$f.xlf="flyoutExpanded";$f.vlf="flyoutCollapsed";$f.f1h="flyoutFromIdle";$f.e1h="flyoutFromExpanded";$f.ylf="flyoutFromCollapsed";$f.g1h="flyoutStacked";$f.TGl="flyoutFromStacked";$f.SGl="flyoutFadeOut";$f.UGl="cui-img-cont-float cui-img-20by20";$f.VGl="flyoutLtrDir";$f.XGl="flyoutRtlDir";Object(l.a)($f,"ModernPresenceTooltipFlyoutControl",
zd,[]);class xf{constructor(Da,nb,nc=2,Hc=4){this.offsetTop=Da;this.offsetLeft=nb;this.oKj=nc;this.Doi=Hc}}Object(l.a)(xf,"FlyoutsPositioningInfo",null,[]);var Qg=c(39);class zb{constructor(Da=!1,nb=!1){this.fm=Da;this.sBe=nb}O1l(Da,nb,nc,Hc,bd){const ee=bd.y,ic=bd.height;var af=this.oPl(Hc);const Vc=af+nb,Mg=Da*nc+2*(Da-1);nc=null;1===Da||this.pTk(af,Mg,ee,ic)?Da=new xf(0,0,2):(Da=this.flf(Vc,Mg,ee,ic),Da.offsetTop-=af);this.sBe?nc=new xf(0,0,void 0,this.fm?4:3):(Hc=this.nPl(Hc,bd),af=Math.max(0,
bd.x),bd=bd.width,nb=Hc+nb,this.qTk(Hc,af,bd)?nc=new xf(0,0,void 0,this.fm?3:4):this.rTk(nb,af)&&(nc=new xf(0,0,void 0,this.fm?4:3)),nc||(nc=this.CFl(Hc,nb,af,bd)));return new xf(Da.offsetTop,nc.offsetLeft,Da.oKj,nc.Doi)}oPl(Da){return Qg.a.gEa(Da)}nPl(Da,nb){return this.fm?nb.width-Qg.a.t5h(Da):Qg.a.eof(Da)}pTk(Da,nb,nc,Hc){return Da+nb<=nc+Hc}flf(Da,nb,nc,Hc){let bd=1,ee=Math.max(nc,Da-nb);nb>Da-nc&&(bd=2,ee=nb<Hc?Hc-nb:nc);return new xf(ee,0,bd)}qTk(Da,nb,nc){return Da+150<=nb+nc}rTk(Da,nb){return 150<=
Da-nb}CFl(Da,nb,nc,Hc){Hc-nb>=Da-nc?Da=4:(nb=Da,Da=3);return new xf(0,nb,void 0,Da)}}Object(l.a)(zb,"ModernPresenceTooltipPositioner",null,[]);class Yb{constructor(Da,nb,nc,Hc,bd,ee,ic){this.K$=Da;this._parent=nb;this.tPg=nc;this.b_j=Hc;this.Y6j=bd;this.e_b=ee;this.fMa=ic;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Da,nb){if(3!==Da)if(5!==Da&&this.K$&&this.K$.length){if(4===Da){var nc=this.Y6j;var Hc=(this.e_b-nc)/2;
this.element.style.height=this.e_b+"px";this.element.style.width=this.e_b+"px";Da=qf.a.xY(this.K$[0].element.style.top);nb=qf.a.xY(this.fMa?this.K$[0].element.style.right:this.K$[0].element.style.left)}else nc=this.tPg,Hc=(this.e_b-nc)/2,this.element.style.height=this.e_b+"px",this.element.style.width=this.kRl()+2*Hc+"px",Da=qf.a.xY(this.K$[this.K$.length-1].element.style.top),nb=this.sSk(this.K$[this.K$.length-1].element,nc,nb);qf.a.EOb(this.element,"border-radius",this.e_b+"px");this.element.style.top=
Da-Hc-nc+"px";this.fMa?this.element.style.right=nb-Hc+"px":this.element.style.left=nb-Hc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}sSk(Da,nb,nc){return this.fMa&&!nc?qf.a.xY(Da.style.right):this.fMa||nc?this.fMa&&nc?-qf.a.xY(Da.style.left)-nb:-qf.a.xY(Da.style.right)-nb:qf.a.xY(Da.style.left)}kRl(){return this.K$&&this.K$.length?this.tPg+Math.min(this.K$.length-1,2)*
this.b_j:0}}Object(l.a)(Yb,"ModernPresenceTooltipTarget",null,[]);var Tc=c(128),Id=c(189);class Xc extends zd{constructor(Da,nb,nc){super(Da);this.DYb=this.QKa=this.QZg=this.Gtb=!1;this.uq=[];this.Ykd={};this.Uf=nc;this.fm=nc.get(8,!1);this.GYg=nc.get(15,!1);this.f1j=nc.get(12,0);this.qeb=nc.get(6,0);this.pla=nb;this.klh=nc.get(16);this.sBe=nc.get(17,!1);this.b7j=nc.get(19,!1);this.hgk=nc.get(20,!1);this.Xnd=0;this.bgk=new zb(this.fm,this.sBe);this.Foc=this.$7h();this.Bwb=!1;this.vSb=[];this.Guc=
[];this.element.id=Xc.ghb();this.element.className=zd.iNh(this.fm);this.K_a&&(this.zIndex=this.K_a);this.rtl=this.fm;this.zag(nb);this.u6=this.createElement("div");this.u6.className="prFlyoutContainer";this.element.appendChild(this.u6);this.K$=[];this.pab=new Yb(this.M3,this.element,this.qeb,4,6,32,this.fm);this.hs=nc.get(9);this.hs.nb(mf.a.pointerDown,this.pab.element,Object(f.a)(this,this.Xec,"onHitTarget"));this.hs.nb(mf.a.pointerOver,this.pab.element,Object(f.a)(this,this.Xec,"onHitTarget"));
this.hs.nb(mf.a.pointerOut,this.pab.element,Object(f.a)(this,this.Xec,"onHitTarget"))}get uae(){return Id.a.clone(this.uq)}get M3(){return this.K$}get K_a(){return this.f1j}get A0a(){return this.M3?this.M3.length:0}get sQb(){return 0<this.A0a?this.M3[0].state:5}get tDf(){return 3===this.sQb&&!this.Gtb}szb(Da){this.addHandler(ie.jU,Da)}dNb(Da){this.removeHandler(ie.jU,Da)}dispose(){if(this.tDf)this.Bwb=!0;else{if(this.M3)for(const Da of this.M3)Da.dNb(Object(f.a)(this,this.GRa,"onInteractivityChanged")),
Dd.a.YB(Da);this.K$=null;this.hs.sc(mf.a.pointerDown,this.pab.element,Object(f.a)(this,this.Xec,"onHitTarget"));this.hs.sc(mf.a.pointerOver,this.pab.element,Object(f.a)(this,this.Xec,"onHitTarget"));this.hs.sc(mf.a.pointerOut,this.pab.element,Object(f.a)(this,this.Xec,"onHitTarget"));super.dispose()}}fkc(){this.i3b();this.visible=!0}K8c(){this.visible=!0;this.DYh();this.Gtb=!0}leg(){this.K8c()}hide(){this.Faj();this.X1a();this.pab.update(this.sQb,this.DYb)}rfa(Da){const nb=this.sQb,nc=this.Gtb;Da.clientId||
(Da.clientId=(Xc.avc++).toString());if(Da.clientId in this.Ykd){var Hc=this.tDb(Da.clientId);if(0<=Hc){Hc=this.uq[Hc];if(Hc.color===Da.color&&Hc.userName===Da.userName)return;this.O5a(Da.clientId)}}this.hide();Hc=new $f(this.createElement("div"),this.Uf);Hc.szb(Object(f.a)(this,this.GRa,"onInteractivityChanged"));this.u6.insertBefore(Hc.element,this.u6.firstChild);this.Ykd[Da.clientId]=Hc;Array.add(this.uq,Da);Array.add(this.M3,Hc);this.xIj(nb,nc);this.visible=!0}O5a(Da){if(this.tDf)Array.add(this.Guc,
Da);else{var nb=this.sQb,nc=this.Gtb;this.hide();this.L4c(Da);this.xIj(nb,nc)}}gQi(Da){const nb=this.tDb(Da);if(!(0>=nb)){var nc=this.uq[nb];Da=this.Ykd[Da];Array.removeAt(this.uq,nb);Array.insert(this.uq,0,nc);Array.removeAt(this.M3,nb);Array.insert(this.M3,0,Da);this.u6.removeChild(Da.element);this.u6.appendChild(Da.element);this.i3b()}}xIj(Da,nb){0>=this.uq.length?this.hide():3===Da&&nb?this.K8c():this.fkc()}Xif(Da){if(this.tDf&&this.b7j)return!1;Da=Xc.Etf(Da);if(this.u6!==Da&&kf.a.eQa(this.u6,
Da))return!0;for(const nb of this.M3)if(kf.a.eQa(nb.element,Da))return!0;return!1}position(Da,nb){this.element.style.top=nb+"px";this.element.style.left=Da+"px"}i3b(Da=!1){if(!Da||this.QKa){this.QZg&&this.Cnj(!0);var nb=Math.min(3,this.A0a)-1;Da=0;var nc=1,Hc=0;this.DYb&&(Da=this.Foc,nc=-1,Hc=-this.qeb);for(let bd=this.A0a-1;bd>nb;bd--)this.M3[bd].Trj(this.uq[bd],-4*nb*nc+Hc,!0,!1,!0,Da);for(;0<=nb;nb--)this.M3[nb].Trj(this.uq[nb],-4*nb*nc+Hc,0<nb,Array.contains(this.vSb,this.uq[nb].clientId),nb!==
this.Xnd,Da);this.Xnd=0;this.pab.update(0,this.DYb);this.zIndex=this.K_a;this.Gtb=!1;this.Faj(0);this.Bwb&&this.dispose()}}DYh(){this.QZg&&this.Cnj(!1);this.zIndex=this.K_a+1;let Da,nb,nc;({offsetX:nb,offsetY:Da,Coi:nc}=this.Zko());for(let Hc=0;Hc<this.A0a;Hc++)this.M3[Hc].exo(this.uq[Hc],nb,Da+(this.qeb+2)*Hc,Hc!==this.Xnd,nc)}X1a(){let Da=0,nb=0;this.DYb&&(Da=this.Foc,nb=-6);for(let nc=0;nc<this.A0a;nc++)this.M3[nc].hide(this.uq[nc],nb,Da);this.zIndex=this.K_a;this.visible=this.Gtb=!1;this.Bwb&&
this.dispose()}D8e(Da=0){Da?(this.QKa=!0,E.Task.delay(Da).continueWith(()=>{this.GYg?this.Itm():this.i3b(!0);this.QKa=!1})):this.GYg?this.hide():this.i3b()}Itm(){this.QKa&&this.hide()}sLk(){if(n.AFrameworkApplication.ta&&n.AFrameworkApplication.ta.Nb.Noa&&Tc.c()){const Da=appChrome.selectors.getShyState();return Da.isActive&&0!==Da.state}return!1}GRa(Da,nb){Da=this.sQb;this.sLk()||2!==nb.type&&(4!==nb.type||3===Da)?4===nb.type&&3===Da?(this.QKa&&(this.QKa=!1),this.D8e()):3!==nb.type||3!==Da||this.Gtb||
(1<this.A0a?(this.QKa=!0,E.Task.delay(250).continueWith(()=>{this.i3b(!0);this.QKa=!1})):this.D8e()):(this.QKa&&(this.QKa=!1),3!==Da&&(this.DYh(),3===nb.Lo.lg&&this.D8e(2E3)));this.raiseEvent(ie.jU,nb)}Xec(Da){3===Da.lg?this.GRa(this,new ie(4,Da)):Da.eventName===mf.a.pointerOver?this.GRa(this,new ie(2,Da)):Da.eventName===mf.a.pointerOut&&this.GRa(this,new ie(3,Da));return!1}zag(Da){this.element.style.width=Da+"px";this.element.style.height=this.qeb+"px"}L4c(Da){this.QZn(Da);Da=this.tDb(Da);if(!(0>
Da)){var nb=this.uq[Da];Array.removeAt(this.uq,Da);delete this.Ykd[nb.clientId];nb=this.M3[Da];this.u6.removeChild(nb.element);this.Uf.get(18,!1)&&nb.dNb(Object(f.a)(this,this.GRa,"onInteractivityChanged"));Array.removeAt(this.M3,Da);nb.dispose()}}Faj(Da=5){if(this.Guc.length){this.visible&&this.X1a();for(let nb=0;nb<this.Guc.length;nb++)this.L4c(this.Guc[nb]);Array.clear(this.Guc);0>=this.uq.length||5===Da?this.hide():0===Da&&this.fkc()}}tDb(Da){for(let nb=0;nb<this.uq.length;nb++)if(this.uq[nb].clientId===
Da)return nb;return-1}QZn(Da){-1===this.tDb(Da)?k.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.vSb,Da)&&(Array.remove(this.vSb,Da),this.uq[0].clientId===Da&&0<this.vSb.length&&this.gQi(this.vSb[this.vSb.length-1]),this.uq[0].clientId===Da&&1===this.sQb&&this.i3b())}Cnj(Da){Da?Sys.UI.DomElement.addCssClass(this.u6,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.u6,"prBackgroundSelection")}Zko(){let Da,nb;nb=Da=0;var nc=
this.Foc;if(this.klh){const Hc=this.klh(this);if(!Hc)return{offsetX:Da,offsetY:nb,Coi:nc};const bd=4===this.sQb;nc=this.bgk.O1l(this.A0a,bd?6:this.qeb,this.qeb,this.element,Hc);nb=nc.offsetTop;this.Xnd=this.q0l(nc.oKj,nc.offsetTop);nc=nc.Doi;nc!==this.Foc&&(this.x7f(nc),this.element.dir=3===nc?"rtl":"ltr",this.Foc=nc);nc!==this.$7h()?(Da=this.hgk?-2:bd?-6:-this.qeb,this.DYb=!0):this.DYb=!1}return{offsetX:Da,offsetY:nb,Coi:nc}}q0l(Da,nb){if(1===Da)return this.A0a-1;Da=Math.abs(nb);return 0<Da?Da/(this.qeb+
2):0}x7f(Da){for(let nb=0;nb<this.A0a;nb++)this.M3[nb].x7f(Da)}$7h(){return this.fm?3:4}static ghb(){return String.format("{0}-{1}","presencetooltip",Xc.avc++)}static Etf(Da){return Da.Hb.rawEvent.relatedTarget}}Xc.avc=0;Object(l.a)(Xc,"ModernPresenceTooltipControl",zd,[1198,10]);var Le=c(228),cf=c(271);class Ig{constructor(Da){this.Uf=Da;this.Uf.RMa(10,Le.a.instance);this.Uf.RMa(9,ud.a.instance);this.Uf.RMa(6,20);this.Uf.RMa(13,cf.a.instance);this.Uf.RMa(17,!1)}vaf(Da,nb=!1){this.Uf.RMa(15,nb);return new Xc(Da,
20,this.Uf)}}Object(l.a)(Ig,"ModernPresenceTooltipFactory",null,[1197]);class Ji extends zd{constructor(Da,nb){super(Da);this.uq=null;this.fMa=nb.get(8,!1);this.w$a=nb.get(6,0);this.element=Da;this.element.className=Ji.wlf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.ig=nb.get(10);this.ig.nb(mf.a.click,this.element,Object(f.a)(this,this.onClick,"onClick"));this.hs=nb.get(9);this.hs.nb(mf.a.pointerOut,this.element,Object(f.a)(this,this.IJ,"onPointerOut"));this.hs.nb(mf.a.pointerDown,
this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior"));this.pE=nb.get(13);this.pE.nb(this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior"))}szb(Da){this.addHandler(ie.jU,Da)}dNb(Da){this.removeHandler(ie.jU,Da)}get users(){return this.uq}dispose(){this.element&&(this.ig.sc(mf.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.hs.sc(mf.a.pointerDown,this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior")),
this.hs.sc(mf.a.pointerOut,this.element,Object(f.a)(this,this.IJ,"onPointerOut")),this.pE.sc(this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Da,nb,nc){this.hide();!Da||0>=Da.length||(this.fMa?this.element.style.right=nb+"px":this.element.style.left=nb+"px",this.element.style.top=nc+"px",this.Iwk(Da),this.visible=!0)}Iwk(Da){this.uq=Da;kf.a.wC(this._ul);for(let nb=Da.length-1;0<=nb;nb--)this.rfa(Da[nb])}rfa(Da){const nb=
document.createElement("li");nb.style.backgroundColor=Da.color;nb.style.height=this.w$a+"px";nb.id="fly_"+Da.clientId;nb.style.lineHeight=this.w$a+"px";kf.a.Jy(nb,Da.userName);nb.setAttribute("dir","auto");this._ul.appendChild(nb)}onClick(){this.hide();return!1}IJ(Da){this.raiseEvent(ie.jU,new ie(3,Da));return!1}}Ji.wlf="prFlyout UIFont";Object(l.a)(Ji,"PresenceTooltipFlyoutControl",zd,[]);class Th extends zd{constructor(Da,nb,nc){super(Da);this._img=null;this.uq=[];this.element.className="prGlyph";
this.Uf=nb;this.iYb=this.Uf.get(9);this.Mq=this.Uf.get(10);this.pE=this.Uf.get(13);this.cum();this.rfa(nc);this.RFe=!1}get D4a(){return this.uq.length}get users(){return this.uq}szb(Da){this.addHandler(ie.jU,Da)}dNb(Da){this.removeHandler(ie.jU,Da)}dispose(){this.nSo();super.dispose()}rfa(Da){Array.add(this.uq,Da);2===this.D4a?this.Dja(!0):1===this.D4a?this.Dja(!1):this.Dja(this.RFe)}O5a(Da){this.YCl(Da)&&(1<this.D4a&&this.Dja(!0),1===this.D4a?this.Dja(!1):1>this.D4a&&this.hide())}show(){this.Dja(2<=
this.D4a);this.visible=!0}hide(){this.visible=!1}a0l(Da){return Da?this.y6h(0,5):this.y6h(1,4)}YCl(Da){for(let nb=0;nb<this.D4a;nb++)if(this.uq[nb].clientId===Da)return Da=this.uq[nb],Array.removeAt(this.uq,nb),Da;return null}Dja(Da){this.RFe!==Da&&(this._img&&this.element.removeChild(this._img),this._img=this.a0l(Da),this.element.appendChild(this._img),this.RFe=Da);this._img.childNodes[0].style.backgroundColor=this.uq[this.uq.length-1].color}y6h(Da,nb){const nc=this.Uf.get(6,0),Hc=this.Uf.get(14);
return re.createClusteredImageFromClusterWithImageClass(nc,nc,this.Uf.get(Da),this.Uf.get(nb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Hc?Hc.cloneNode(!0):null)}gP(Da){3!==Da.lg&&this.raiseEvent(ie.jU,new ie(2,Da));return!1}onClick(Da){this.raiseEvent(ie.jU,new ie(1,Da));return!0}IJ(Da){3!==Da.lg&&this.raiseEvent(ie.jU,new ie(3,Da));return!1}nSo(){this.element&&(this.iYb.sc(mf.a.pointerDown,this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior")),
this.iYb.sc(mf.a.pointerOver,this.element,Object(f.a)(this,this.gP,"onPointerOver")),this.iYb.sc(mf.a.pointerOut,this.element,Object(f.a)(this,this.IJ,"onPointerOut")),this.Mq.sc(mf.a.pB,this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior")),this.Mq.sc(mf.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.pE.sc(this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior")))}cum(){this.element&&(this.iYb.nb(mf.a.pointerDown,this.element,
Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior")),this.iYb.nb(mf.a.pointerOver,this.element,Object(f.a)(this,this.gP,"onPointerOver")),this.iYb.nb(mf.a.pointerOut,this.element,Object(f.a)(this,this.IJ,"onPointerOut")),this.Mq.nb(mf.a.pB,this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior")),this.Mq.nb(mf.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.pE.nb(this.element,Object(f.a)(this,this.kja,"stopPropagationAndPreventDefaultBehavior")))}}
Object(l.a)(Th,"PresenceTooltipGlyph",zd,[]);class Ah extends zd{constructor(Da,nb,nc){super(Da);this.uq=[];this.CK=[];this.xLa=0;this.uBc=this.uVb=!1;this.aLg=null;this.Zkd={};this.Uf=nc;this.fm=nc.get(8,!1);this.Lka=nc.get(11,!1);Da=nc.get(12,0);this.imageDimension=nc.get(6,0);this.pla=nb;this.element.id=Ah.ghb();this.element.className=zd.iNh(this.fm);Da&&(this.zIndex=Da);this.rtl=this.fm;this.zag(nb);this.yAa=this.createElement("div");this.yAa.className=this.Lka?"prContainerV":"prContainerHr";
this.element.appendChild(this.yAa);this.$Vg=Array(this.xLa);for(nb=0;nb<this.xLa;nb++)this.zba[nb]=new Ji(this.createElement("div"),this.Uf),this.zba[nb].szb(Object(f.a)(this,this.GRa,"onInteractivityChanged")),this.element.appendChild(this.zba[nb].element)}get uae(){return Id.a.clone(this.uq)}get zba(){return this.$Vg}get gnh(){return this.aLg}get Rje(){return this.imageDimension+2}get width(){return this.Lka?this.Rje:this.pla}get height(){return this.Lka?this.pla:this.Rje}szb(Da){this.addHandler(ie.jU,
Da)}dNb(Da){this.removeHandler(ie.jU,Da)}dispose(){if(this.zba)for(const Da of this.zba)Da.dNb(Object(f.a)(this,this.GRa,"onInteractivityChanged")),Dd.a.YB(Da);Dd.a.f9f(this.CK);this.CK=this.$Vg=null;super.dispose()}fkc(){this.X1a();this.zeg();this.visible=!0;this.uVb=!1}K8c(){!this.CK||1>this.CK.length||(this.X1a(),this.visible=!0,this.zeg(),this.iae(this.CK[this.CK.length-1]),this.uVb=!0)}leg(){if(this.CK&&!(1>this.CK.length)){this.visible=!0;this.zeg();var Da=0;for(const nb of this.CK)this.iae(nb,
Da++);this.uVb=!1;this.uBc=!0}}hide(){this.visible=!1;this.X1a();for(let Da=0;Da<this.CK.length;Da++)this.CK[Da].hide();this.uVb=!1}hDh(){if(!this.uBc)return!1;let Da=0;for(const nb of this.zba)nb.visible&&Da++;return this.uBc=0<Da&&(this.uq.length<=this.xLa?Da===this.uq.length:Da===this.xLa)}rfa(Da){if(!(0>=this.xLa)){Da.clientId||(Da.clientId=(Ah.avc++).toString());if(Da.clientId in this.Zkd){var nb=this.tDb(Da.clientId);if(0<=nb){nb=this.uq[nb];if(nb.color===Da.color&&nb.userName===Da.userName)return;
this.O5a(Da.clientId)}}nb=this.hDh();var nc=0;if(this.uq.length<this.xLa){var Hc=new Th(this.createElement("div"),this.Uf,Da);Hc.szb(Object(f.a)(this,this.GRa,"onInteractivityChanged"));this.fm&&!this.Lka&&0<this.uq.length?this.yAa.insertBefore(Hc.element,this.yAa.firstChild):(this.yAa.appendChild(Hc.element),nc=this.CK.length);Array.add(this.CK,Hc)}else this.fm&&!this.Lka?Hc=this.CK[0]:(nc=this.CK.length-1,Hc=this.CK[nc]),Hc.rfa(Da);Hc.show();this.Zkd[Da.clientId]=Hc;Array.add(this.uq,Da);this.hGj(Hc,
nc);nb&&this.leg()}}O5a(Da){const nb=this.hDh();nb&&this.X1a();this.L4c(Da);this.uq.length>=this.xLa&&this.CK.length<this.xLa&&this.rRn();0>=this.uq.length?this.hide():nb&&this.leg()}gQi(){}L4c(Da){var nb=this.tDb(Da);0>nb||(Da=this.uq[nb],Array.removeAt(this.uq,nb),nb=this.Zkd[Da.clientId],delete this.Zkd[Da.clientId],nb.O5a(Da.clientId),this.hGj(nb),0>=nb.D4a&&(this.yAa.removeChild(nb.element),Array.remove(this.CK,nb),nb.dispose()))}rRn(){var Da=this.g7l();!Da||1>=Da.users.length||(Da=Array.clone(this.uq),
Da.forEach(nb=>{this.L4c(nb.clientId)}),Da.forEach(nb=>{this.rfa(nb)}))}tDb(Da){for(let nb=0;nb<this.uq.length;nb++)if(this.uq[nb].clientId===Da)return nb;return-1}g7l(){return this.fm&&!this.Lka?this.CK[0]:this.CK[this.CK.length-1]}position(Da,nb){this.element.style.top=nb+"px";this.element.style.left=Da+"px"}zeg(){for(let Da=0;Da<this.CK.length;Da++)this.CK[Da].show()}X1a(){for(let Da=0;Da<this.xLa;Da++)this.zba[Da].hide();this.uBc=!1}iae(Da,nb=0){if(Da)if(this.aLg=Da,this.Lka){const nc=this.imageDimension;
if(1<Da.users.length)this.zba[nb].show(Da.users,nc,this.height-this.imageDimension);else{const Hc=this.yAa.children.length;for(let bd=0;bd<this.yAa.children.length;bd++)Da.element===this.yAa.children[bd]&&this.zba[nb].show(Da.users,nc,this.height-(Hc-bd)*this.Rje+2)}}else this.zba[nb].show(Da.users,this.width,0)}GRa(Da,nb){var nc=Object(y.a)(Th,Da);nc=nc?this.x_h(nc):-1;if(2===nb.type||1===nb.type&&-1!==nc&&!this.zba[nc].visible)this.iae(Da);else if(1===nb.type)this.X1a(),this.uVb=!1;else if(3===
nb.type){if(this.Xif(nb.Lo))return;this.uVb||this.X1a()}this.raiseEvent(ie.jU,nb)}Xif(Da){Da=Ah.Etf(Da);let nb=!1;for(const nc of this.zba)if(kf.a.eQa(nc.element,Da)){nb=!0;break}return this.yAa!==Da&&kf.a.eQa(this.yAa,Da)||nb}hGj(Da,nb=0){const nc=this.bGm(Da);nc&&0>=Da.D4a?this.zba[nb].hide():nc?this.iae(Da):this.zba[nb].hide()}x_h(Da){let nb=0;for(const nc of this.CK){if(Da===nc)return nb;nb++}return-1}bGm(Da){const nb=this.x_h(Da);return!!this.gnh&&Da===this.gnh&&-1!==nb&&this.zba[nb].visible}zag(Da){this.xLa=
Da===this.imageDimension?1:Math.floor(Da/this.Rje);this.Lka?(this.element.style.height=Da+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=Da+"px",this.element.style.height=this.imageDimension+"px")}static ghb(){return String.format("{0}-{1}","presencetooltip",Ah.avc++)}static Etf(Da){Da=Da.Hb.rawEvent;return Da.relatedTarget||Da.toElement}}Ah.avc=0;Object(l.a)(Ah,"PresenceTooltipControl",zd,[1198,10]);class Pm{constructor(Da){this.Uf=Da;this.Uf.RMa(10,Le.a.instance);
this.Uf.RMa(9,ud.a.instance);this.Uf.RMa(6,16);this.Uf.RMa(13,cf.a.instance)}vaf(Da){return new Ah(Da,16,this.Uf)}}Object(l.a)(Pm,"PresenceTooltipFactory",null,[1197]);var zf=c(250),lg=c(113),md=c(53),td=c(6),Bd=c(5),nl=c(18),ni=c(78),si=c(510),zi=c(305),yl=c(111);class Dl extends Sys.EventArgs{constructor(Da,nb){super();this.paragraphId=Da;this.$Zm=nb}}Object(l.a)(Dl,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class ji extends zd{constructor(Da,nb,nc,Hc,bd,ee=null,ic=null){super(null);this.Skd=
this.Um=null;this.IXc=!1;this.Vqa=0;this.vp=Da;this.xCc=nb;this.hs=nc;this.oj=Hc;this.CJa=bd;ji.bub=0;this.zsh=new Ib.a;this.Eej=new Ib.a;this.rW=ee;this.Fa=ic;this.X3j=this.Fa.mc("PresenceIpRenderedFloodgateTimeLapseSec",30);this.Rnk=this.Fa.mc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.Jra=0}get s4a(){return n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}uxk(Da){this.addHandler("CR",Da)}mbj(Da){this.removeHandler("CR",Da)}Hce(){this.raiseEvent("CR",new Dl(this.vp.ip.paragraphId,
this.IXc))}gOf(){if(Object(yl.a)(Xc,this.Um)){const Da=Object(y.a)(Xc,this.Um);ji.bub=0<ji.bub?ji.bub+1:Da.K_a+1;Da.zIndex=ji.bub;this.element.style.zIndex=String(ji.bub)}}b7n(){if(Object(yl.a)(Xc,this.Um)){const Da=Object(y.a)(Xc,this.Um);ji.bub=Da.K_a;Da.zIndex=Da.K_a;this.element.style.zIndex=String(Da.K_a)}}UKi(){this.rW&&!this.EOo()&&this.rW.continueWith(()=>{this.rW.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.X3j)&&this.Jra++})}EOo(){return this.Jra>=this.Rnk}static eKi(){ji.MVg||
(ji.MVg=!0,k.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static ghb(Da){return ji.vvm+Da.t$h()}}ji.z3i="data-presence-control";ji.j_i="OverlayControlElementOwner";ji.vvm="ipId_";ji.A3i="WacPresence";ji.xzn="PresenceIpPaddingDiv";ji.MVg=!1;ji.bub=0;Object(l.a)(ji,"APresenceControl",zd,[1470,10]);class ej{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.N6a=!1}}Object(l.a)(ej,"PresenceImageControlStyle",null,[1469]);class fj extends ji{constructor(Da,
nb,nc,Hc,bd,ee=null,ic=null){super(Da,nb,nc,Hc,bd,ee,ic);this.IJ=()=>{this.mPi();return!1};this.M8d=af=>{this.Um&&3===af.lg&&(2!==this.Vqa?(this.gOf(),this.rPb()):this.mPi());return!1}}O5a(Da){this.Um&&this.Um.O5a(Da)}Soe(){return this.Um?this.Um.uae.length:0}updatePosition(Da){if(this.element&&this.element.parentNode){var nb=this.S$h(Da);if(nb){var nc=Sys.UI.DomElement.getBounds(this.element.parentNode),Hc,bd;({left:nc,top:Hc,height:bd,width:nb}=this.K9l(nb,nc,this.element.parentNode,this.oj.instance));
this.element.style.top=Hc+"px";this.element.style.left=nc+"px";this.element.style.height=bd+"px";this.element.style.width=nb+"px";nc=this.$$h(Da);qf.a.l5(this.element,nc);Da=this.brf(Da,this.vp.ip.shapeId);this.hoj(nc,nb,this.isSelected(Da),n.AFrameworkApplication.isRtl);this.rPb()}}}BY(){this.element&&(kf.a.lx(this.element),this.Um.O5a(this.vp.user.clientId),this.Hce())}AHh(Da,nb,nc,Hc){nb=new ej;if(!Hc||!nc)return nb;nc=this.S$h(Da);if(!nc)return nb;nb.top=nc.y;nb.left=nc.x;nb.height=nc.height;
nb.width=nc.width;nb.rotation=this.qbm(Da);nb.N6a=!0;return nb}ncj(Da,nb,nc,Hc){ji.eKi();this.Skd=Da;if(Hc){const bd=this.brf(Da,this.vp.ip.shapeId);if(!bd)return;const ee=!this.element;ee&&this.zaf(nb.ownerDocument,Da);ee||!this.element.parentNode?bd.appendChild(this.element):this.element.parentNode!==bd&&(this.element.parentNode.removeChild(this.element),bd.appendChild(this.element));this.Um.rfa(this.vp.user);this.element.style.borderColor=this.vp.user.color;this.element.id=ji.ghb(this.vp);nc.N6a&&
(this.element.style.height=nc.height+"px",this.element.style.top=nc.top+"px",this.element.style.left=nc.left+"px",this.element.style.width=nc.width+"px",qf.a.l5(this.element,nc.rotation),qf.a.l5(this.Um.element,-1*nc.rotation),this.hoj(nc.rotation,nc.width,this.isSelected(bd),n.AFrameworkApplication.isRtl),this.rPb())}this.IXc=!Hc;this.Hce()}qbm(Da){return this.element&&this.element.parentNode&&this.Zfi(qf.a.getTransform(this.element.parentNode))?this.Zfi(qf.a.getTransform(this.element)):this.$$h(Da)}Zfi(Da){return Da&&
-1<Da.indexOf("deg")&&(Da=parseInt(Da.substring(Da.indexOf("(")+1,Da.indexOf("deg"))),!isNaN(Da))?Da:0}IFj(Da){this.element.style.borderColor=this.vp.user.color;this.element.id=ji.ghb(this.vp);this.updatePosition(Da)}zaf(Da,nb){this.element=Da.createElement("div");this.element.setAttribute(ji.z3i,!0);lg.a.Kl(this.element,ji.j_i,this);this.element.className=fj.AHn;n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoopsCoAuthSelectionIssueFixIsEnable",
!1)&&(Da=nb.Bb)&&Da.yQ&&(this.element.style.pointerEvents="none");this.element.dir=n.AFrameworkApplication.isRtl?"rtl":"ltr";this.Um=this.xCc.vaf(this.createElement("div"),!0);this.Um.rfa(this.vp.user);this.Um.hide();this.hs.nb(mf.a.pointerOut,this.Um.element,this.IJ);this.hs.nb(mf.a.pointerDown,this.Um.element,this.M8d);this.Um.element.classList.add(ji.A3i);this.element.appendChild(this.Um.element)}K9l(Da,nb,nc,Hc){let bd=Da.y,ee=Da.x,ic=Da.height;Da=Da.width;(1<Math.abs(nb.width-nc.offsetWidth)||
1<Math.abs(nb.height-nc.offsetHeight))&&Hc&&(bd=Math.round(bd/Hc.jj),ee=Math.round(ee/Hc.jj),ic=Math.round(ic/Hc.jj),Da=Math.round(Da/Hc.jj));return{left:ee,top:bd,height:ic,width:Da}}isSelected(Da){return Da.classList.contains(zi.a.P4b)}hoj(Da,nb,nc,Hc){this.Um.element.style.left="auto";this.Um.element.style.top="auto";this.Um.element.style.right="auto";this.Um.element.style.bottom="auto";nc=nc?Math.round(.5*fj.Uqa)+fj.rMo:0;0<=Da&&90>Da||360===Da?(this.Um.element.style.top=-.5*fj.Uqa-nc+"px",Hc?
this.Um.element.style.right=nb-.5*fj.Uqa+"px":this.Um.element.style.left=nb-.5*fj.Uqa+"px"):90<=Da&&180>Da?(this.Um.element.style.left=-.5*fj.Uqa-nc+"px",Hc?this.Um.element.style.bottom=-.5*fj.Uqa+"px":this.Um.element.style.top=-.5*fj.Uqa+"px"):180<=Da&&270>Da?(this.Um.element.style.bottom=-.5*fj.Uqa-nc+"px",Hc?this.Um.element.style.left=nb-.5*fj.Uqa+"px":this.Um.element.style.right=nb-.5*fj.Uqa+"px"):(this.Um.element.style.right=-.5*fj.Uqa-nc+"px",Hc?this.Um.element.style.top=-.5*fj.Uqa+"px":this.Um.element.style.bottom=
-.5*fj.Uqa+"px")}xl(Da,nb){const nc=this.cQd(Da,nb);return nc?nc.properties:(Da=this.Y$h(Da,nb))?Da.properties:null}brf(Da,nb){var nc=this.cQd(Da,nb);return nc&&(nc=nc.Rva(Da.fh,Da))?nc.element:(nb=this.Y$h(Da,nb))?Object(y.a)(si.a,nb).De(Da.fc).htmlElement:null}cQd(Da,nb){Da=ni.i(Da.Bb,5);for(const nc of Da)if(nc.properties.getValue(td.a.GCb)===nb)return nc;return null}Y$h(Da,nb){Da=Bd.GraphIterator.$a(Da.Bb);let nc=Da.Sb(6);for(;nc;){const Hc=nc.properties.getValue(td.a.GCb);if(nl.ImageReader.Ju(nc)&&
Hc===nb)return nc;nc=Da.Pf(6)}return null}O_l(Da){const nb=md.a.vf(nl.ImageReader.fF(Da),0);Da=md.a.vf(nl.ImageReader.yG(Da),1);return{Mja:nb,Zsm:Da}}$$h(Da){Da=this.xl(Da,this.vp.ip.shapeId);return nl.ImageReader.D_(Da)}S$h(Da){var nb=this.vp.ip;if(!nb||!nb.shapeId)return null;var nc=this.xl(Da,nb.shapeId);const Hc=this.brf(Da,nb.shapeId);if(!nc||!Hc)return null;const bd=nl.ImageReader.Ui(nc);let ee=Da=1,ic;({Mja:nb,Zsm:ic}=this.O_l(nc));Ea.App.instance&&Ea.App.instance.h4(bd)?(nc=nl.ImageReader.yna(nc),
Da=md.a.vf(nc[0],0),ee=md.a.vf(nc[2],1)):nc.hasProperty(td.a.Uca)?(nc=nc.getValue(td.a.Uca),Da+=md.a.vf(nc[0],0),ee+=md.a.vf(nc[2],1)):(Da+=0<Hc.offsetWidth?(Hc.offsetWidth-nb)/2:2,ee+=0<Hc.offsetHeight?(Hc.offsetHeight-ic)/2:2);return new Sys.UI.Bounds(Math.round(Da),Math.round(ee),Math.round(nb),Math.round(ic))}mPi(){this.Um&&(this.Um.fkc(),this.Vqa=1)}rPb(){for(const Da of this.Um.uae)if(Da.clientId===this.vp.user.clientId&&!Da.equals(this.vp.user)){this.Um.rfa(this.vp.user);break}if(this.vp.vTa||
2===this.Vqa)this.Um.K8c(),this.vp.vTa=!1,this.vp.oca=!0,this.Vqa=2;this.vp.oca&&1!==this.Vqa||(this.Um.fkc(),this.vp.oca=!0,this.Vqa=1)}}fj.AHn="WACImgPresenceHighlight";fj.Uqa=20;fj.rMo=6;Object(l.a)(fj,"PresenceImageControl",ji,[]);var um=c(275);class Gg{constructor(){this.height=this.top=this.left=this.sui=0;this.N6a=!1;this.QB=this.Ih=null}}Object(l.a)(Gg,"PresenceIpControlStyle",null,[1469]);var dg=c(60);class Ri extends ji{constructor(Da,nb,nc,Hc,bd,ee=null,ic=null,af=null){super(Da,nb,nc,
Hc,bd,ee,ic);this.BBc=this.vWa=this.FZb=null;this.gP=Vc=>{!this.Um||this.s4a&&!this.Um.Xif(Vc)||(this.gOf(),this.Cfe(Vc));this.IFj(this.Skd);return!1};this.IJ=()=>{this.Um&&this.ZQ();return!1};this.M8d=Vc=>{this.Um&&3===Vc.lg&&(2!==this.Vqa?(this.gOf(),this.Cfe(Vc)):this.ZQ());return!1};this.uD=af}zaf(Da){this.element=Da.createElement("div");this.element.setAttribute(ji.z3i,!0);lg.a.Kl(this.element,ji.j_i,this);this.element.className=ji.xzn;this.element.dir=n.AFrameworkApplication.isRtl?"rtl":"ltr";
this.hs.nb(mf.a.pointerOver,this.element,this.gP);this.s4a&&(this.hs.nb(mf.a.pointerOut,this.element,this.IJ),this.hs.nb(mf.a.pointerDown,this.element,this.M8d));this.vWa=this.createElement("div");this.vWa.className=Ri.BHn;this.s4a||(this.BBc=this.createElement("div"),this.BBc.className=Ri.EHn,this.vWa.appendChild(this.BBc));this.Um=this.xCc.vaf(this.createElement("div"),this.s4a);Da=this.Fa.$("NoPresenceUserLookUpBeforeRender");this.uD&&!Da&&(this.vp.user=this.uD.ALf(this.vp.user.clientId)||this.vp.user);
this.Um.rfa(this.vp.user);this.Um.hide();this.Um.element.classList.add(this.s4a?ji.A3i:Ri.MCn);this.vWa.appendChild(this.Um.element);this.element.appendChild(this.vWa)}Dkl(){this.FZb&&(Mb.a.instance.Xe(this.FZb),this.FZb=null)}rPb(Da){for(var nb of this.Um.uae)if(nb.clientId===this.vp.user.clientId&&!nb.equals(this.vp.user)){this.Um.rfa(this.vp.user);break}nb=!1;Ri.wil===this.vp.user.color?({value:nb}=this.zsh.Dc(this.vp.user.clientId,!1),nb||(this.zsh.Z(this.vp.user.clientId,!0),k.ULS.sendTraceTag(17954772,
302,50,'{ "ClientID" : "'+this.vp.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:nb}=this.Eej.Dc(this.vp.user.clientId,!1),nb||(this.Eej.Z(this.vp.user.clientId,!0),k.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.vp.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Da||this.vp.vTa||2===this.Vqa?(this.UKi(),this.Um.K8c(),this.vp.vTa=!1,this.vp.oca=!0,this.Vqa=2,Ri.aLo):this.vp.oca&&1!==this.Vqa?0:(this.UKi(),this.Um.fkc(),this.vp.oca=!0,this.Vqa=1,Ri.$Ko)}Cfe(Da=null){this.Dkl();
const nb=this.rPb(!!Da);this.s4a&&Da&&Da.eventName===mf.a.pointerOver||this.Wbo(nb)}ZQ(){this.Um&&this.Vqa&&(this.b7n(),this.Um.hide(),this.Vqa=0)}Wbo(Da){this.FZb=new pa.a(2,1,Da,()=>{this.FZb=null;this.ZQ()},56);Mb.a.instance.Vb(this.FZb)}updatePosition(Da){if(this.element&&this.element.parentNode){var nb=this.Hai(Da);if(nb){Da=Sys.UI.DomElement.getBounds(this.element.parentNode);nb=new Sys.UI.Bounds(nb.x-Da.x,nb.y-Da.y,Ri.wui,nb.height);var nc;({left:Da,top:nb,height:nc}=this.N9l(nb,Da,this.element.parentNode,
this.oj.instance));this.element.style.height=2*Ri.Jfc+nc+"px";this.element.style.top=nb-Ri.Jfc+"px";this.element.style.left=Da-Ri.Jfc+"px";this.vWa.style.height=Math.max(Ri.bPi,nc)+"px";this.Cfe()}}}BY(){this.element&&(kf.a.lx(this.element),this.Hce())}AHh(Da,nb,nc,Hc,bd){const ee=new Gg;if(!Hc||!nc)return ee;Hc=this.Hai(Da);if(!Hc)return ee;var ic=nc;nc=Da;if(Da.zj){var af=Da.oc;ic=Da.Fg.V8b(this.vp.ip.B9.cp);0>ic&&0==ic;Da.oc.zwa?kf.a.eQa(af.editingElement,Da.Fg.Oi.J(ic))||(nc=dg.InteractiveViewManager.instance.Bd.Fj(Da.source),
nb=nc.Fg.Oi.J(ic)):nb=nc.Fg.Oi.J(ic);ic=nb.getBoundingClientRect()}ic=new Sys.UI.Bounds(Hc.x-ic.x,Hc.y-ic.y,Ri.wui,Hc.height);Da=ic.y;Hc=ic.x;ic=ic.height;af=this.oj.instance;bd&&af&&(bd=af.jj,Da=Math.round(Da/bd),Hc=Math.round(Hc/bd),ic=Math.round(ic/bd));ee.top=Da-Ri.Jfc;ee.left=Hc-Ri.Jfc;ee.height=2*Ri.Jfc+ic;ee.sui=Math.max(Ri.bPi,ic);ee.N6a=!0;ee.Ih=nb;ee.QB=nc;return ee}ncj(Da,nb,nc,Hc){ji.eKi();this.Skd=Da;Da=nc.Ih;nb=nc.QB;if(Da&&nb){if(Hc){const bd=!this.element;bd&&this.zaf(Da.ownerDocument);
bd||!this.element.parentNode?Da.appendChild(this.element):this.element.parentNode!==Da&&(this.element.parentNode.removeChild(this.element),Da.appendChild(this.element));this.Skd=nb;Da=this.vp.user.color;this.vWa.style.borderColor=Da;this.s4a||(this.BBc.style.borderColor=Da);this.element.id=ji.ghb(this.vp);nc.N6a&&(this.element.style.height=nc.height+"px",this.element.style.top=nc.top+"px",this.element.style.left=nc.left+"px",this.vWa.style.height=nc.sui+"px",this.Cfe())}this.IXc=!Hc;this.Hce()}else k.ULS.sendTraceTag(520950942,
302,50,`Skip IpControl rendering due to paragraphElement is null:${!Da} or paragraphViewElement is null:${!nb}`)}dispose(){this.element&&(this.BY(),this.hs.sc(mf.a.pointerOver,this.element,this.gP),this.s4a&&(this.hs.sc(mf.a.pointerOut,this.element,this.IJ),this.hs.sc(mf.a.pointerDown,this.element,this.M8d)),Dd.a.YB(this.Um),this.element=this.Um=null);super.dispose()}IFj(Da){const nb=this.vp.user.color;this.vWa.style.borderColor=nb;this.s4a||(this.BBc.style.borderColor=nb);this.element.id=ji.ghb(this.vp);
this.updatePosition(Da)}N9l(Da,nb,nc,Hc){let bd=Da.y,ee=Da.x;Da=Da.height;(1<Math.abs(nb.width-nc.offsetWidth)||1<Math.abs(nb.height-nc.offsetHeight))&&Hc&&(bd=Math.round(bd/Hc.jj),ee=Math.round(ee/Hc.jj),Da=Math.round(Da/Hc.jj));return{left:ee,top:bd,height:Da}}Hai(Da){const nb=this.vp.ip;if(!nb)return null;let nc;try{const Hc=nb.B9.cp;nc=um.a.b_(Hc,Da,0<Hc,!1,!1,!1)}catch(Hc){k.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",Mb.a.instance.Nv,
Hc.message,Hc.stack),nc=null}return nc}}Ri.MCn="WacPawn";Ri.wui=2;Ri.$Ko=7E3;Ri.aLo=2E3;Ri.Jfc=5;Ri.BHn="presenceIp";Ri.EHn="PresenceSmallBox";Ri.bPi=10;Ri.wil="0xcccccc";Object(l.a)(Ri,"PresenceIpControl",ji,[]);class am{constructor(Da,nb,nc,Hc,bd=null,ee=null,ic=null){this.erc={};this.crc={};this.aPg={};this.xCc=Da;this.hs=nb;this.Vm=nc;this.CJa=Hc;this.rW=bd;this.Fa=ee;this.uD=ic}get ahl(){return this.erc}get DOh(){return this.crc}J9l(Da){const nb=!!this.Fa&&this.Fa.$("PeoplesWellExtraButtonInfoIsEnabled");
return Da.ip.shapeId&&nb?this.O9l(Da):this.P9l(Da)}O9l(Da){const nb=Da.ip.shapeId.toString();this.aPg[Da.user.clientId]=nb;const nc=this.crc[nb];return nc?(nc.vp=Da,{returnValue:nc,Qoe:!0}):{returnValue:this.crc[nb]=new fj(Da,this.xCc,this.hs,this.Vm,this.CJa,this.rW,this.Fa),Qoe:!1}}P9l(Da){const nb=Da.user.clientId,nc=this.erc[nb];return nc&&nc.vp.user.equals(Da.user)?(nc.vp=Da,{returnValue:nc,Qoe:!0}):{returnValue:this.erc[nb]=new Ri(Da,this.xCc,this.hs,this.Vm,this.CJa,this.rW,this.Fa,this.uD),
Qoe:!1}}Iai(Da){return this.erc[Da]}K_l(Da){return(Da=this.crc[this.aPg[Da]])&&!Da.Soe()?Da:null}Wpl(){var Da=this.erc;for(const nb in Da)Da[nb].dispose();Da=this.crc;for(const nb in Da)Da[nb].dispose()}}Object(l.a)(am,"PresenceControlProvider",null,[]);var gj=c(156);class Tg{constructor(){this.Lbb=0}xci(){this.Lbb++;this.Lbb===Number.MAX_VALUE&&(this.Lbb=1);return this.Lbb}static get instance(){return Tg.Hyc}}Tg.Hyc=new Tg;Object(l.a)(Tg,"PacketIdGenerator",null,[258]);var Si=c(1093);class kj{constructor(Da,
nb,nc){this.jco=Da;this.Zwm=nb;this.pFi=nc}}Object(l.a)(kj,"SuccessfulInboundReplicationCallbackData",null,[]);class Mh{constructor(Da,nb,nc,Hc,bd,ee,ic){this.M$n=(af,Vc)=>{Vc.type||(af=this.Pk.mVh>=this.q2j,this.fnk&&af?(af=this.sCe())?af.fXh():k.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.cF())};this.Dvn=af=>{if(af=Object(y.a)(kj,af)){var Vc=af.Zwm.si.toString(),Mg=this.sCe(),We=Mg.Ht,Jh="";We!==af.pFi&&(k.ULS.sendTraceTag(19964236,
500,50,"Time saved due to force inbound on update notification message = {0} ms",af.jco.toString()),Jh=this.h5l(Mg,We,af.pFi));k.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",Jh,Vc)}else k.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.E$n=Da;this.sCe=nb;this.Pk=nc;this.fnk=bd;this.q2j=ee;this.DWb=Hc;this.Fq=ic;this.E$n.g3(this.M$n)}cF(){const Da=this.sCe();if(!Da)k.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");
else if(!this.DWb()&&Da.RQa){let nb=-1;Object(yl.a)(Si.a,Da)&&(nb=Da.ik.hHa());const nc=this.Fq.Zf("Task","ShoulderTapInboundReplicationTimer");Da.cF(this.Dvn,null,new kj(nb,nc,Da.Ht))}}h5l(Da,nb,nc){const Hc=new Sys.StringBuilder;Da=Da.node.od.store.getRevision(nb);if(!Da)return k.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:nb}),"";for(Hc.append(Da.id.guid);nb!==nc;){Hc.append(", ");Hc.append(nb.guid);Da=Da.jm;if(!Da)break;
nb=Da.id}return Hc.toString()}}Object(l.a)(Mh,"ContentNotificationManager",null,[]);class Qh extends Mh{constructor(Da,nb,nc,Hc,bd,ee,ic){super(Da,nb,nc,Hc,bd,ee,ic)}static get jqa(){return null!=Qh.rGg?Qh.rGg:Qh.rGg=Na.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(Ea.App.xa){var Da=Ea.App.xa.ib;Da&&(Da.sfa(Qh.G_c),Da=Da.Uc)&&(Qh.Av=Da.contentReplicator,Qh.Av&&Ea.App.Tna().continueWith(Qh.wTf))}}static wTf(){Qh.Rfd=Ea.App.Tna().result;Qh.Rfd&&Qh.Rfd.Qo&&Qh.jqa.OD().continueWith(Qh.t0c)}static t0c(){Qh.hj=
Qh.jqa.OD().result;if(Qh.hj){var Da=n.AFrameworkApplication.K,nb=Da.$("Box4ThrottleInboundRequests");Da=Da.mc("Box4ThrottleInboundsAtUserCount",20);Qh.Av.iSd=()=>Qh.hj.eRa;Qh.Ofd=Qh.Ofd||new Qh(Qh.hj,()=>Qh.Av,Qh.Rfd,()=>n.AFrameworkApplication.Nk,nb,Da,Ea.App.xa.Hq);Qh.Ofd.cF()}}static G_c(Da){Qh.Ofd||(Da.Knb(Qh.G_c),Qh.init())}}Qh.Ofd=null;Qh.hj=null;Qh.Av=null;Qh.Rfd=null;Object(l.a)(Qh,"WordContentNotificationManager",Mh,[]);var Qk=c(48);class Hj{constructor(Da,nb,nc,Hc,bd,ee){this.Mgd=null;this.mbh=
Da;this.qd=nc;this.BLa=Hc;this.Oy=bd;this.xh=ee;this.Sqb=nb}clone(){return new Hj(this.mbh,this.Sqb.clone(),this.qd,this.BLa,this.Oy,this.xh)}get cp(){if(null!=this.Mgd)return this.Mgd;var Da=this.mbh.paragraphId;if(Da.equals(Mc.a.nil))return 0;var nb=this.BLa();if(!nb)return 0;Da=nb.Db(Da);if(!Da)return k.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;nb=this.qd.sBb(this.qd.VRa(Da.characterData,Da.pa),this.Sqb);if(Qk.a.Vj&&this.Oy){var nc=ac.a.Qc(Da,nb);
this.xh&&Da.Vs&&(nc.Eb=this.xh.cRd(Da,nb,this.Sqb.wua));nb=this.Oy.iba(nc,!0)}else this.Oy&&this.xh&&Da.Vs&&(nc=ac.a.Qc(Da,nb),nc.Eb=this.xh.cRd(Da,nb,this.Sqb.wua),nb=this.Oy.iba(nc,!0));return nb}GVf(){null==this.Mgd&&(this.Mgd=this.cp)}equals(Da){return Da?this.Sqb.isEqual(Da.Sqb,!1):!1}}Object(l.a)(Hj,"WordPresenceCp",null,[271,100,272]);class tl{constructor(Da,nb){this.Oy=Da;this.xh=nb}create(Da,nb,nc,Hc){return new Hj(Da,nb,nc,Hc,this.Oy,this.xh)}}Object(l.a)(tl,"Factory",null,[257]);class Qj extends Sys.EventArgs{constructor(Da,
nb,nc){super();this.paragraphId=Da;this.presence=nb;this.MBf=nc}}Object(l.a)(Qj,"ParagraphChangedEventArg",Sys.EventArgs,[]);class zl{constructor(Da){this.cp=Da}equals(Da){return Da?this.cp===Da.cp:!1}clone(){return new zl(this.cp)}}Object(l.a)(zl,"PresenceCp",null,[271,100]);class Rh{constructor(Da,nb,nc,Hc,bd){this.paragraphId=Da;this.cp=nb;this.length=nc;this.shapeId=Hc;this.dryDeletion=bd}}Object(l.a)(Rh,"SerializablePresenceIpData",null,[]);class Dk{constructor(Da,nb,nc,Hc=0,bd=0){this.Osa=null;
Da&&(this.Osa=Mc.a.Ef(Da));this.lbh=new zl(nb);this.JGa=nc;this.Nfh=Hc;this.yTg=bd}get paragraphId(){return this.Osa}get B9(){return this.lbh}get shapeId(){return this.Nfh}get dryDeletion(){return this.yTg}isValid(){return 0<=this.B9.cp&&!!this.paragraphId&&!this.paragraphId.equals(Mc.a.nil)}getData(){return new Rh(this.paragraphId.toString(),this.B9.cp,this.JGa,this.shapeId,this.dryDeletion)}clone(){const Da=new Dk;Da.Osa=this.paragraphId;Da.lbh=this.B9?this.B9.clone():null;Da.JGa=this.JGa;Da.Nfh=
this.shapeId;Da.yTg=this.dryDeletion;return Da}static xBb(Da){return Da.paragraphId&&void 0!==Da.cp&&null!==Da.cp&&void 0!==Da.length&&null!==Da.length?new Dk(Da.paragraphId,Da.cp,Da.length,void 0,Da.dryDeletion):null}}Object(l.a)(Dk,"PresenceIp",null,[240,100]);class ok{constructor(Da,nb){this.ip=Da;this.user=nb}}Object(l.a)(ok,"SerializablePresenceData",null,[]);class Rk{constructor(Da,nb){this.vTa=this.oca=this.Mdc=!1;this.uWa=nb;this.user=Da}get ip(){return this.uWa}guf(){return new ok(this.ip?
this.ip.getData():null,this.user.getData())}t$h(){return this.user.clientId+(this.uWa?this.uWa.paragraphId.toString():Mc.a.nil.toString())}isValid(){const Da=!!this.user&&this.user.isValid(),nb=!this.ip||this.ip.isValid();return Da&&nb}clone(){const Da=new Rk;Da.user=this.user?this.user.clone():null;Da.uWa=this.uWa?this.uWa.clone():null;Da.oca=this.oca;Da.Mdc=this.Mdc;Da.vTa=this.vTa;return Da}static xBb(Da){return Da?new Rk(eb.xBb(Da.user),Da.ip?Dk.xBb(Da.ip):null):null}}Object(l.a)(Rk,"PresenceInfo",
null,[248,100]);class Gm extends Ha.a{constructor(){super();this.Tyc={};this.fVa={};this.GVg=!1}get AAn(){return this.Tyc}get eAi(){return!!n.AFrameworkApplication.K&&n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}arh(Da){this.addHandler("PPC",Da)}Tbj(Da){this.removeHandler("PPC",Da)}qPc(Da){return Da.ip.paragraphId.toString()}VZe(Da,nb=!1){this.GVg||(this.GVg=!0,k.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var nc=({CHn:Hc}=this.pVm(Da)).returnValue;
if(Hc&&!nb)(nc=this.fVa[Da.user.clientId])&&0<=nc.length&&(nc[nc.length-1].ip.JGa=Da.ip.JGa);else{nc||this.Jaj(Da.user.clientId);this.eAi&&nc&&this.rXo(Da);nb=this.qPc(Da);var Hc=Da.user.clientId;var bd=this.Tyc[nb]||[],ee=this.fVa[Hc]||[];ee.length>=Gm.MNi&&(ee=ee.splice(-Gm.Wjn,Gm.MNi));nc||bd.push(Hc);ee.push(Da);this.Tyc[nb]=bd;this.fVa[Hc]=ee;Da.ip.paragraphId.equals(Mc.a.nil)||this.R2f(Da.ip.paragraphId,Da,!0)}}pVm(Da){var nb=this.fVa[Da.user.clientId];const nc=!nb||0>=nb.length?null:nb[nb.length-
1],Hc=!!nc&&this.qPc(nc)===this.qPc(Da);nb=Hc&&nc.ip.B9.equals(Da.ip.B9)&&nc.user.equals(Da.user);this.eAi&&nb&&nc.ip.shapeId&&Da.ip.shapeId&&nc.ip.shapeId!==Da.ip.shapeId&&(nb=!1);return{returnValue:Hc,CHn:nb}}rXo(Da){const nb=this.nhl(Da);nb&&nb.ip.shapeId&&(Da.ip.shapeId&&Da.ip.shapeId===nb.ip.shapeId||this.R2f(nb.ip.paragraphId,nb,!1))}nhl(Da){Da=this.fVa[Da.user.clientId];return!Da||0>=Da.length?null:Da[Da.length-1]}Jaj(Da){const nb=this.fVa[Da];if(nb&&0<nb.length){const nc=nb[0].ip.paragraphId,
Hc=this.qPc(nb[0]);delete this.fVa[Da];this.z0n(Hc,Da);nc.equals(Mc.a.nil)||this.R2f(nc,nb[0],!1)}}r6h(Da){return this.Tyc[Da]}tNc(Da,nb,nc,Hc=!1){const bd=[],ee=this.r6h(Da);if(!ee)return bd;for(let ic=0;ic<ee.length;ic++){const af=ee[ic],Vc=this.fVa[af];let Mg=!1;for(let We=Vc.length-1;0<=We;We--){const Jh=Vc[We];if(Hc){if(Jh.oca&&Jh.ip.paragraphId.equals(Mc.a.Ef(Da))){Mg=!0;bd.push(Jh);break}}else if(Object(yl.a)(Rk,Jh)?Jh.ip.JGa===nb:Jh.ip.JGa===nc){Mg=!0;Jh.Mdc=!0;bd.push(Jh);this.fVa[af]=Vc.splice(We,
Vc.length);break}}!Mg&&0<Vc.length&&Vc[0].Mdc&&Vc[0].ip.paragraphId.equals(Mc.a.Ef(Da))&&bd.push(Vc[0])}return bd}YMl(Da){if(!Da||!Da.Oa||!Da.Oa.node)return null;Da=this.tNc(Da.Oa.node.id.toString(),0,0,!0);Da=this.bjm(Da);Da.sort((nb,nc)=>{if(!(nb&&nb.userName&&nc&&nc.userName))return k.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return Da}bjm(Da){if(!Da||!Da.length)return[];const nb=[],nc=new L.a(I.a.Fh());for(let Hc=0;Hc<Da.length;Hc++){const bd=
Da[Hc].user;bd.isAnonymous&&nc.contains(bd.clientId)||!bd.isAnonymous&&bd.email&&nc.contains(bd.email)||(nb.push(bd),nc.add(bd.isAnonymous?bd.clientId:bd.email))}return nb}R2f(Da,nb,nc){this.raiseEvent("PPC",new Qj(Da,nb,nc))}z0n(Da,nb){Array.remove(this.Tyc[Da],nb)}}Gm.MNi=10;Gm.Wjn=2;Object(l.a)(Gm,"PresenceDataManager",Ha.a,[1423]);class bm extends Gm{constructor(Da){super();this.jH=Da}VZe(Da,nb=!1){super.VZe(Da,nb)}qPc(Da){return Da.ip.Lc.toString()}r6h(Da){Da=this.jH.Db(Mc.a.Ef(Da));if(!Da)return null;
Da=Da.ia(td.a.Lc,0);return this.AAn[Da.toString()]}}Object(l.a)(bm,"WordPresenceDataManager",Gm,[]);var cm=c(1484),qg=c(1062),Yk=c(1874),Wl=c(17);class kg{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc,Mg,We,Jh,pi,Yj,Zk,sj,tk,Qm,Li,km,Kg,sf,he,oe){this.DMa=Array(5);this.UWe=this._started=this.VRe=!1;this.yOe=null;this.Nbh=new L.a(I.a.Fh());this.jrd={};this.UGe=!1;this.gAn=()=>{if(!this.UWe&&!this.ul.vy){var $e=new pa.a(0,1,20,()=>{const fe=new Q.a;var El=this.Ubb.ahl;for(var Im in El){const Yh=El[Im];Yh.IXc&&
fe.add(Yh.vp.ip.paragraphId)}if(this.o6d){El=this.Ubb.DOh;for(const Yh in El)Im=El[Yh],Im.IXc&&!fe.contains(Im.vp.ip.paragraphId)&&fe.add(Im.vp.ip.paragraphId)}this.B4h(fe);this.UWe=!1},72);this.Gb.Vb($e);this.UWe=!0}};this.kVi=()=>{this.VRe&&(this.s$f(),this.VRe=!1)};this.L4=($e,fe)=>{this.Gjj(fe.ol.kb)};this.J4=($e,fe)=>{$e=fe.dra;for(var El in $e){const Im=$e[El];this.Fa.$("CashTelemetryIsEnabled")&&this.cLc(Im,new Date,null);Im.ip?this.OZe(Im):this.M4c(Im.user.clientId)}fe=fe.eJd;for(El=0;El<
fe.length;++El)this.qll(fe[El]);this.Vde()};this.HVf=($e,fe)=>{fe.paragraphId?this.sZo(fe.paragraphId.toString(),fe.$Zm,this.jrd):k.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.B3i=($e,fe)=>{fe.paragraphId&&($e=this.HF.Db(fe.paragraphId))&&((Object(yl.a)(Rk,fe.presence)?this.iCe($e):this.jCe($e))===fe.presence.ip.JGa&&this.cco(fe.paragraphId),this.o6d&&this.DHn(fe))};this.dw=Da;this.hb=Hc;this.uD=bd;this.Iwb=ee;this.ul=Vc;this.o2j=Mg;this.Ubb=We;this.HF=nc;this.DXg=Jh;this.iCe=pi;this.jCe=
Yj;this.sVj=ic;this.r2j=af;this.uLa=Zk;this.Oq=sj;this.Ic=tk;this.Gb=Qm;this.Uih=sf;this.khk=oe;this.zOe=km;this.Fa=Kg;this.Nqd=nb;kg.Rrd=new Ib.a;for(Da=0;Da<this.Nqd.length;Da++)this.Nqd[Da].TXn(this);this.Iwb.arh(this.B3i);this.dw.iZa(this.J4);he&&this.ul.Pla(this.gAn);this.dw.mde(this)}get o6d(){return!!this.Fa&&this.Fa.$("PeoplesWellExtraButtonInfoIsEnabled")}Vde(Da=!1){this.Uih&&!Da||this.jcj()}jcj(){const Da=new Q.a,nb=this.jrd;for(const nc in nb)Da.add(Mc.a.Ef(nc));this.B4h(Da);this.jrd={}}s$f(){this.hb.gb&&
this.Gjj(this.hb.gb.kb,!0)}Gjj(Da,nb=!1){this.khk||(this.HF.km.Qwa||nb?Da?(nb=this.Hdl(Da))?this.dw.A$f(nb):(this.dw.A$f(null),k.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Da.Oa.contextId)):this.dw.A$f(null):this.VRe=!0)}Hdl(Da){if(!this.o6d||!Da.Akb)if(Da=Wl.SelectionEditor.Cj(Da,!0,!1),!Wl.SelectionEditor.Sl(Da))return null;return this.Ryh(Da)}Ryh(Da){const nb=Da.Oa.cpBegin,nc=Da.Oa.node.id;Da=this.iCe(Da.Oa.node);return new Dk(nc.toString(),nb,Da)}cLc(Da,nb,nc){if(this.zOe)if(Da&&
Da.user&&Da.user.clientId){var Hc=Da.user.clientId;this.Nbh.contains(Hc)||(this.yOe?(this.yOe.cLc(Hc,nb,null,kg.Abm(nc||Da.user.client)),this.Nbh.add(Hc)):this.zOe.continueWith(()=>{this.yOe=this.zOe.result;this.cLc(Da,nb,nc)}))}else k.ULS.sendTraceTag(42262876,302,15,"invalid presence")}L9l(Da){const nb=new Q.a;for(let nc=0;nc<Da.length;nc++)nb.add(this.Sim(Da[nc]));return nb}OZe(Da){var nb=null;Da&&Da.user&&(nb=Da.user.client);Da=Da.clone();Da.user=this.uD.ALf(Da.user.clientId)||Da.user;this.Fa.$("CashTelemetryIsEnabled")&&
this.cLc(Da,new Date,nb);Da.isValid()&&!Da.user.lU()&&(nb=Da.user.clientId,kg.Rrd.mb(nb)||this.zli(nb),this.gZo(nb),Da.user.userName=CommonUIStrings.l_AnonymousUserName);this.Iwb.VZe(Da,!1)}gZo(Da){const {value:nb}=kg.Rrd.Dc(Da,!1);nb||(kg.Rrd.Z(Da,!0),k.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Da+'" , "Event" : "CreateAnonymousGrayPawn"}'))}zli(){}M4c(Da){this.Iwb.Jaj(Da)}qll(Da){this.M4c(Da);const nb=this.Ubb.Iai(Da);nb&&(nb.mbj(this.HVf),nb.dispose());this.o6d&&(Da=this.Ubb.K_l(Da))&&
(Da.mbj(this.HVf),Da.dispose())}w8b(Da){if(12!==Da.type)return new Q.a;Da=this.Iwb.tNc(Da.id.toString(),this.iCe(Da),this.jCe(Da));return 0>=Da.length?new Q.a:this.L9l(Da)}sZo(Da,nb,nc){!nb&&Da in nc&&delete nc[Da]}dispose(){this.stop();this.Iwb.Tbj(this.B3i);this.dw.iNb(this.J4);this.dw.Tlg(this);for(let Da=0;Da<this.Nqd.length;Da++)this.Nqd[Da].gTo(this);Dd.a.f9f([this.sVj,this.r2j,this.dw]);this.Ubb.Wpl()}Sim(Da){let nb=!1;Da=({Qoe:nb}=this.Ubb.J9l(Da)).returnValue;nb||Da.uxk(this.HVf);return Da}Eji(Da){Da=
this.HF.Db(Da);if(!Da)return this.DMa[0]||(k.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.DMa[0]=!0),null;if(!Db.ParagraphReader.Wb(Da))return this.DMa[1]||(k.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.DMa[1]=!0),null;if(!Da.De(this.ul.fc))return this.DMa[2]||(k.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.DMa[2]=!0),null;if(!Da.anchor)return this.DMa[3]||(k.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.DMa[3]=
!0),null;this.DMa[4]||(k.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.DMa[4]=!0);return Da}paj(Da){Da=this.Iwb.tNc(Da.toString(),-1,-1,!0);if(!Id.a.jf(Da))for(const nb of Da)(Da=this.Ubb.Iai(nb.user.clientId))&&Da.element&&Da.BY()}B4h(Da){if(Da.count){var nb=new Q.a;for(var nc of Da)(Da=this.Eji(nc))?nb.add(Da):this.paj(nc);if(nb.count){nc=this.Ic.Oc(2);try{nc.set(this.Oq);for(const Hc of nb)this.vTh(Hc)}finally{nc&&nc.dispose()}}}}vTh(Da){Da.tJ(this.ul.fc,32,
!0);Da.tJ(this.o2j,32,!0)}cco(Da){this.jrd[Da.toString()]=null;this.Uih&&!this.UGe&&(Da=new pa.a(0,1,200,()=>{this.UGe=!1;this.jcj()},70),this.Gb.Vb(Da),this.UGe=!0)}DHn(Da){if(Da.presence.ip.shapeId&&!Da.MBf){var nb=this.Ubb.DOh[Da.presence.ip.shapeId.toString()];nb&&nb.O5a(Da.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.hb.CY(this.L4),this.DXg.Nbj(this.kVi))}start(){if(!this._started){this._started=!0;this.hb.Pw(this.L4);this.DXg.U_e(this.kVi);var Da=this.dw.TDb();delete Da[this.uLa.clientId];
this.J4(null,new Yk.a(Da,[]));this.s$f()}}lje(Da){if(Da&&Da.isValid()&&Da.ip){var nb=this.Iwb.tNc(Da.ip.paragraphId.toString(),-1,-1),nc=!1,Hc=null;for(let bd=0;bd<nb.length;bd++)if(Hc=nb[bd],Hc.user.clientId===Da.user.clientId){nc=Hc.vTa=!0;break}if(nc)if(nb=Hc.ip.paragraphId,Da=this.Eji(nb)){nb=this.Ic.Oc(2);try{nb.Cb(Da),this.vTh(Da)}finally{nb&&nb.dispose()}}else this.paj(nb)}}static Abm(Da){return Da?Da?1===Da?1:2===Da?2:0:2:0}}kg.Rrd=null;Object(l.a)(kg,"PresenceManager",null,[1419,10,221,1420,
1421,1422]);class Hd{constructor(Da,nb,nc,Hc){this.XTb=null;this._started=this.vFe=!1;this.Jyb=null;this.upa=(bd,ee)=>{if(!n.AFrameworkApplication.Nk&&(bd=this.GGj(ee.ol),this.XTb&&bd)){bd=this.Wxe.tNc(this.XTb.toString(),-1,-1,!0);for(ee=0;ee<bd.length;ee++)this.Jyb[bd[ee].user.clientId]=bd[ee];0>=bd.length||(bd=this.lal(bd),this.Wp.sendNotification(bd,!0))}};this.YWi=(bd,ee)=>{this.hb.gb&&!n.AFrameworkApplication.Nk&&this.vFe&&this.XTb&&this.XTb.equals(ee.paragraphId)&&(bd=null,!ee.MBf||ee.presence.user.clientId in
this.Jyb?ee.MBf||(bd=this.TMh(ee.presence.user.userName,!1),delete this.Jyb[ee.presence.user.clientId]):(bd=this.TMh(ee.presence.user.userName,!0),this.Jyb[ee.presence.user.clientId]=ee.presence),bd&&this.Wp.sendNotification(bd,!0))};this.hj=Hc;this.hb=nb;this.Wxe=Da;this.Wp=nc;this.hj.mde(this)}start(){this._started||(this._started=!0,this.Jyb={},this.Wxe.arh(this.YWi),this.hb.Pw(this.upa),this.GGj(this.hb.gb))}stop(){this._started&&(this._started=!1,this.Jyb=null,this.Wxe.Tbj(this.YWi),this.hb.CY(this.upa))}lal(Da){if(1===
Da.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Da[0].user.userName);const nb=[],nc=Da.length;for(let Hc=0;Hc<nc;Hc++)nb.push(Da[Hc].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,nb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}TMh(Da,nb){return String.format(nb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Da)}dispose(){this.hj.Tlg(this);this.stop()}GGj(Da){if(!Da)return!1;
Da=Da.kb;if(!Da)return!1;Da=Da.Oa;if(!Da)return!1;this.vFe=Wl.SelectionEditor.gf(Da);Da=Da.node.id;if(Da.equals(this.XTb)||!this.vFe)return!1;this.XTb=Da;this.Jyb={};return!0}}Object(l.a)(Hd,"PresenceAccessibilityManager",null,[10,221]);class Ad{constructor(Da,nb){this._started=!1;this.mK=null;this.$ld=!1;this.X_c=()=>{this._started&&this.qjj()};this.hj=Da;nb&&(this.mK=nb,this.mK.Hdb(this.X_c));this.hj.mde(this)}start(){this._started||(this._started=!0,this.mK?this.qjj():this.hj.bN(1,this.zLh()))}qjj(){const Da=
this.$ld;(this.$ld=!!this.mK.Nx)&&!Da&&this.hj.bN(1,this.zLh())}zLh(){const Da={};Da.Id="{"+n.AFrameworkApplication.userSessionId.toUpperCase()+"}";Da.HQ=!1;Da.NT=1;Da.WEB=!0;return Da}stop(){this._started&&(this._started=this.$ld=!1)}dispose(){this.hj.Tlg(this);this.mK&&this.mK.obj(this.X_c)}}Object(l.a)(Ad,"EditorsTableNotifier",null,[10,221]);var wf=c(368),eg=c(15);class tg extends kg{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc,Mg,We,Jh,pi,Yj,Zk,sj,tk,Qm,Li,km,Kg,sf,he,oe,$e,fe,El,Im,Yh,Kk,bf){super(Da,
nb,nc,Hc,bd,ee,ic,af,Vc,Mg,We,pi,Yj,Zk,sj,Li,km,Kg,sf,he,oe,$e,fe,Yh);this.Pk=null;this.Wtl=tf=>{const Ep=!!this.Pk.aC.D7b(tf);k.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",tf,Ep)};this.Vtl=(tf,Ep)=>{k.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",Ep,tf)};this.dia=()=>{if(2===tg.hj.connectionState&&!Ma.SessionStatusManager.instance.kca){const tf={};tf.qs=n.AFrameworkApplication.rootQuerySignature;tg.hj.sqb(tf)}};Jh.eb(eg.a.qyo,
Xa.a.application,tg.Ruk,64);Jh.eb(eg.a.F5f,Xa.a.application,tg.F5f,64);Jh.eb(eg.a.o2f,Xa.a.application,tg.o2f,96);Jh.eb(Ta.a.lje,Xa.a.application,tg.pyo,64);this.CI=tk;this.qd=Qm;this.Zyb=El;this.uLa.zgc=Im;this.uLa.zgc.Bzk(tg.ZWi);Kk.continueWith(()=>{this.Pk=Kk.result});k.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.L2=bf)&&this.L2.execute(tf=>{tf.fZa(this.dia)})}zEa(Da){if(!Da||!Da.anchor)return null;for(Da=Da.anchor.hq;Da;Da=Da.KA)if(Da.wFa)return Da.zr.node;return null}Ryh(Da){var nb=
null;nb=n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");var nc=Da.Oa.cpBegin,Hc=Da.Oa.node;nb&&nl.ImageReader.Ju(Hc)&&(Hc=this.zEa(Hc));if(!Hc)return k.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Hc=this.jCe(Hc);const bd=Da.Oa.node.ia(td.a.Lc,0);if(!this.CI)return k.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var ee=this.CI.value.Zhb(bd);const ic=tg.jH.Db(ee);if(!ic)return k.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+ee),null;
nc=this.qd.Enc(this.qd.VRa(ic.characterData,ic.pa),nc);nc.wua=-1===Da.Oa.Eb?0:Da.Oa.Eb;ee=0;nb&&Da.Akb&&(ee=this.jdm(Da));return nb=new Ve(this.CI.value,bd,Hc,nc,this.qd,()=>tg.jH,this.Zyb,ee)}jdm(Da){const nb=nl.ImageReader.rEa(Da.Oa);return nb?nb.properties.ia(td.a.GCb,0):Da.Oa.node.properties.ia(td.a.GCb,0)}zli(Da){this.Pk&&this.Pk.Zma&&this.Pk.Zma.cF(this.Wtl,this.Vtl,Da)}dispose(){this.L2&&this.L2.execute(Da=>{Da.hNb(this.dia)});super.dispose()}static get zu(){return Na.a.instance.resolve("Common.Utils.IAriaNotifier")}static OD(){return tg.bvc.task}static get_instance(){return tg.Qrd.task}static Q9l(){return tg.nbh.task}static get jqa(){return null!=
tg.qGg?tg.qGg:tg.qGg=Na.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){tg.Qrd||(tg.Qrd=new x.a);tg.TVg&&(k.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),tg.TVg=!1);if(Ea.App.xa){var Da=Ea.App.xa.ib;Da?(Da.sfa(tg.G_c),tg.Oyc=Da.rc,Da.Foa()?(tg.HN=Da.Uc.contentReplicator,tg.HN?(tg.jH=Da.Uc.od,tg.jH?tg.jqa.OD().continueWith(tg.tun):k.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):
k.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):k.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):k.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else k.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static tun(){tg.hj=
tg.jqa.OD().result;if(tg.hj){var Da=[tg.Oyc.Q0c,tg.Oyc.editingView.Q0c],nb=Ab.a.instance,nc=Na.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),Hc=new Hd(nc,nb,tg.zu,tg.hj),bd=n.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?Ea.App.rd.aC:null;bd=new Ad(tg.hj,bd);var ee=Na.a.instance.Ue("WordEditor.IParagraphWordIdMapping"),ic=Na.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),af=Na.a.instance.resolve("Common.IPeopleInfoProvider");
tg._instance=new tg(tg.hj,Da,tg.jH,nb,af,nc,Hc,bd,tg.Oyc,tg.Oyc.editingView.fc,Na.a.instance.resolve("Box4.Presence.PresenceControlProvider"),n.AFrameworkApplication.va,tg.HN,Db.ParagraphReader.textLength,Db.ParagraphReader.$ma,Na.a.instance.resolve("Box4.Presence.MyPresenceUser"),ee,ic,Ea.App.Xj.zl,new wf.a,Mb.a.instance,cm.a.get_instance(),za.a.zp(Na.a.instance.Sa("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),n.AFrameworkApplication.K,n.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),
n.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),Na.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),Na.a.instance.resolve("Common.IPresenceStatusProvider"),!Ea.App.us&&!Ea.App.vm,Ea.App.Tna(),Na.a.instance.Sa("Common.ISessionExpirationManager"));k.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");tg.Qrd.Bg(tg._instance);tg.bvc.Bg(tg._instance);tg.nbh.Bg(tg._instance);Da=Na.a.instance;Da.ha("WordEditor.Presence.WordPresenceManager",()=>tg._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").singleInstance();
Da.resolve("WordEditor.Presence.WordPresenceManager")}else k.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static G_c(Da){tg._instance||(k.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Da=Object(y.a)(13,Da))&&Da.Knb(tg.G_c),tg.init())}static ZWi(){tg._instance.s$f()}static Ruk(Da,nb,nc,Hc,bd){nc=bd.split(",");if(!nc||3!==nc.length)return 8;Da=nc[0].trim();nb=nc[1].trim();nc=
Number.parseInvariant(nc[2].trim());Da=new Rk(new eb(Da),new Dk(nb,nc,-1));if(!tg.bvc.task.isCompleted)return 8;nb=tg.OD().result;nb.OZe(Da);nb.Vde();return 32}static F5f(Da,nb,nc,Hc,bd){if(!tg.bvc.task.isCompleted)return 8;Da=tg.OD().result;Da.M4c(bd);Da.Vde();return 32}static pyo(Da,nb,nc,Hc,bd){if(!tg.bvc.task.isCompleted)return 8;Da=tg.OD().result;if(!Da)return 8;Da.lje(bd);return 32}static o2f(Da,nb,nc,Hc,bd){if(1===nc)return 32;if(!tg.jqa.OD().isCompleted)return 8;Da=tg.jqa.OD().result;if(!Da)return k.ULS.sendTraceTag(4301136,
302,10,"rtcProxy is null when trying to display RTC connection status"),8;bd[qg.a.Value]=2===Da.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Da.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:"";return 32}}tg._instance=null;tg.TVg=!0;tg.Qrd=new x.a;tg.bvc=new x.a;tg.nbh=new x.a;tg.jH=null;tg.Oyc=null;tg.HN=null;tg.hj=null;Object(l.a)(tg,"WordPresenceManager",kg,[]);class ce{constructor(Da){this.ra=new Ha.a;this.kZ=Da;this.kZ.CWR(()=>this.kZ.result.wxk(()=>{this.ra.raiseEvent("X")}))}Bzk(Da){this.ra.addHandler("X",
Da)}L2n(Da){this.ra.removeHandler("X",Da)}getStatus(){return this.kZ.isCompleted&&this.kZ.result?this.kZ.result.LHd.toString():"0"}}Object(l.a)(ce,"WordPresenceStatusProvider",null,[249]);class jd{constructor(Da,nb,nc,Hc){this.hj=null;this.LVg=this.OJe=!1;this.uun=()=>{this.HZ.isCompleted&&this.HZ.result?(this.hj=this.HZ.result,this.hj.iZa(this.J4),k.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):k.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};
this.J4=(bd,ee)=>{bd=ee.dra;for(const ic in bd)if(ee=bd[ic],!this.OJe&&ee.user.bP&&ee.user.bP!==this.C2.bP){k.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.C2.bP,ee.user.bP);this.OJe=!0;break}this.OJe&&this.hj.iNb(this.J4);this.LVg||(k.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.LVg=!0)};this.Pk=Da;this.C2=nb;this.HZ=nc;nc.continueWith(this.uun);this.dck=Hc;this.dck.jKf=this.C2}}Object(l.a)(jd,"WordPresenceUpdateMonitor",
null,[]);var gk=c(412),Ch=c(1542),ug=c(221),ul=c(1876),th=c(1877),fg=c(1762);class ag{constructor(Da,nb,nc,Hc,bd,ee,ic){this.ra=new Ha.a;this.n1g=this.d3g=this.RHe=this.N5g=!1;this.ZWe=this.Hxd=0;this.L_b=null;this.uLa=ee;this.uLa.clientId=Da.clientId;this.Cl=Da;this.w$=nb;this.V$=Hc;this.j4j=bd;this.Gb=nc;this.r$a=new ug.a;this.Ep=ic;this.w$&&this.w$.continueWith(()=>{this.w$.yo||this.w$.Ai||this.w$.result.Uph(Object(f.a)(this,this.rTi,"onAmIAloneChanged"))})}get connectionState(){return this.Cl.connectionState}iZa(Da){this.ra.addHandler("PU",
Da)}iNb(Da){this.ra.removeHandler("PU",Da)}Kta(Da){this.ra.addHandler("CSC",Da)}xhc(Da){this.ra.removeHandler("CSC",Da)}fEc(Da){this.ra.addHandler("PSU",Da)}U4c(Da){this.ra.removeHandler("PSU",Da)}Yzd(Da){this.ra.addHandler("PSC",Da)}Qde(Da){this.ra.removeHandler("PSC",Da)}Bjj(){}get clientId(){return this.Cl.clientId}g3(Da){this.ra.addHandler("UN",Da)}jNb(Da){this.ra.removeHandler("UN",Da)}Qym(){this.L_b=Array(12);for(let Da=0;12>Da;Da++)this.L_b[Da]=0;this.d3g=this.Ep?this.Ep.$("UpdateNotificationTaskExperimentIsEnabled"):
!0;n.AFrameworkApplication.cI(()=>{this.R8m()})}init(){this.Cl.Kta(Object(f.a)(this,this.Zha,"onConnectionStateChanged"));this.Cl.iZa(Object(f.a)(this,this.J4,"onPresenceUpdated"));this.Cl.fEc(Object(f.a)(this,this.JRa,"onPersistentStateUpdated"));this.Cl.Yzd(Object(f.a)(this,this.ffc,"onPersistentStateCleared"));this.Cl.g3(Object(f.a)(this,this.A0,"onUpdateNotificationReceived"));this.OHh();this.Qym()}mde(Da){this.r$a.contains(Da,(nb,nc)=>nb===nc)||(this.r$a.add(Da),2===this.connectionState&&Da.start())}Tlg(Da){for(let nb=
0;nb<this.r$a.length;nb++)if(this.r$a.J(nb)===Da){this.r$a.oG(nb);break}}connect(){this.RHe||this.Cl.connect()}disconnect(){this.Cl.disconnect()}get hfe(){return this.Cl}jRh(Da){return Rk.xBb(Da)}Q$f(Da,nb){return(new Rk(Da,nb)).guf()}A$f(Da){Da&&Da.isValid()&&!this.V$()?this.Cl.Bjj(this.Q$f(this.uLa.N4l(),Da)):E.Task.P3(null)}Kic(Da,nb){return this.Cl.Kic(Da,nb)}n7b(Da){return this.Cl.n7b(Da)}vNc(){return this.Cl.vNc()}bN(Da,nb,nc=!1){return this.Cl.bN(Da,nb,nc)}TDb(){return this.qLh(this.Cl.TDb())}sqb(Da){const nb=
new x.a;fg.a.getInstance().a7i(Da,nb);return nb.task}get eRa(){return this.Cl.eRa}Zha(Da,nb){2===nb.newState&&this.r$a.forEach(nc=>{nc.start();return!0});nb.newState||this.Ep.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.RHe||this.r$a.forEach(nc=>{nc.stop();return!0});this.ra.raiseEvent("CSC",nb)}hlf(Da){return Da.toLowerCase()}J4(Da,nb){if(!this.V$()){Da=this.qLh(nb.dra);nb=this.sLh(nb.eJd);var nc=new Yk.a(Da,nb);nb=new pa.a(0,1,0,()=>{this.ra.raiseEvent("PU",nc)},57);this.Gb.Vb(nb)}}qLh(Da){const nb=
{};for(const Hc in Da){var nc=Hc;const bd=this.jRh(Da[Hc]);bd&&bd.isValid()?nb[this.hlf(nc)]=bd:k.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",nc)}return nb}sLh(Da){const nb=Array(Da.length);for(let nc=0;nc<Da.length;nc++)nb[nc]=this.hlf(Da[nc]);return nb}JRa(Da,nb){if(!this.V$()){var nc={};Da=nb.dra;for(var Hc in Da)nc[this.hlf(Hc)]=Da[Hc];Hc=new pa.a(0,1,0,()=>{this.ra.raiseEvent("PSU",new ul.a(nb.type,nc))},80);this.Gb.Vb(Hc)}}ffc(Da,nb){if(!this.V$()){Da=this.sLh(nb.jEd);var nc=new th.a(Da);
Da=new pa.a(0,1,0,()=>{this.ra.raiseEvent("PSC",nc)},81);this.Gb.Vb(Da)}}A0(Da,nb){this.d3g?this.XYi(nb):(Da=new pa.a(0,1,0,()=>{this.XYi(nb)},58),this.Gb.Vb(Da))}XYi(Da){var nb=Date.now();this.ra.raiseEvent("UN",Da);nb=Date.now()-nb;500<=nb&&(this.Hxd++,k.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Da.type,nb),this.SEl(Da));this.ZWe++}SEl(Da){0>Da.type||21<=Da.type?k.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",
Da.type):this.L_b[Da.type]++}R8m(){if(!this.n1g){var Da={};Da.TC=this.ZWe;Da.HRC=this.Hxd;this.L_b&&0<this.Hxd&&(Da.TBC=this.L_b);this.Hxd=this.ZWe=0;this.L_b=null;k.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",Da);this.n1g=!0}}dispose(){this.r$a=new ug.a;this.Cl.xhc(Object(f.a)(this,this.Zha,"onConnectionStateChanged"));this.Cl.iNb(Object(f.a)(this,this.J4,"onPresenceUpdated"));this.Cl.U4c(Object(f.a)(this,this.JRa,"onPersistentStateUpdated"));this.Cl.Qde(Object(f.a)(this,
this.ffc,"onPersistentStateCleared"));this.Cl.jNb(Object(f.a)(this,this.A0,"onUpdateNotificationReceived"));this.w$&&this.w$.continueWith(()=>{this.w$.yo||this.w$.Ai||this.w$.result.J1n(Object(f.a)(this,this.rTi,"onAmIAloneChanged"))});this.Cl.disconnect();k.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}rTi(){this.OHh()}OHh(){let Da=!1;this.w$?this.w$.continueWith(()=>{this.w$.yo||this.w$.Ai||(Da=!this.w$.result.amIAlone);this.Cl.connectionState||!Da&&!this.j4j()?2!==this.Cl.connectionState||
Da||(this.disconnect(),k.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),k.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.N5g&&Da&&(k.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.N5g=!0)}):(this.connect(),k.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}XJc(){this.RHe=!0;this.disconnect();k.ULS.sendTraceTag(4564938,
302,50,"DisconnectForever")}}Object(l.a)(ag,"RtcProxy",null,[1396,10,860,1397]);class Ek extends ag{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc,Mg,We,Jh,pi){super(Da,nb,nc,Hc,bd,ee,pi);this.bfa=null;this.CI=ic;this.qd=af;this.BLa=Vc;this.Hyc=Mg;this.MTe=We;this.Zyb=Jh}get TJ(){return this.bfa||(this.bfa=this.MTe())}Zha(Da,nb){2===nb.newState&&k.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.IZo();super.Zha(Da,nb)}IZo(){this.TJ&&this.TJ.OU("RtcConnectionStatusLabel")}jRh(Da){return mc.Qaf(Rc(Da),
this.CI,this.qd,this.BLa,this.Zyb)}Q$f(Da,nb){return Object(yl.a)(Ve,nb)?(Da=new mc(this.Hyc.xci(),Da,nb),Yc(Da.guf())):super.Q$f(Da,nb)}}Object(l.a)(Ek,"WordRtcProxy",ag,[]);class ze{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc,Mg,We,Jh,pi){this.$p=new x.a;this.ugh=!0;this.ge=nb;this.Gb=nc;this.V$=Hc;this.uLa=bd;this.CI=ee;this.zta=ic;this.BLa=af;this.Hyc=Vc;this.MTe=Mg;this.L2=We;this.Zyb=Jh;this.Fa=pi}OD(){this.jPo();return this.$p.task}POc(){return gk.a.then(this.OD(),Da=>Da)}jPo(){if(this.ugh)if(this.ugh=
!1,Ea.App.tGf()&&Ea.App.rEf()){var Da=n.AFrameworkApplication.Ne;if(Da){Da=Ch.RealtimeChannel.createInstance("{"+n.AFrameworkApplication.userSessionId+"}",n.AFrameworkApplication.userSessionId,n.AFrameworkApplication.tgj,Da,this.L2,1,this.ge,this.Fa.jb("RtcEndpointUrl"),void 0,void 0,null,this.Fa.$("FindSessionOnBootIsEnabled")?Na.a.instance.resolve("Common.IFindSessionUtils"):null,this.Fa.jb("RtcBootToken"));var nb=this.Fa.$("RtcAlwaysOnEnabled"),nc=new Ek(Da,nb?null:Ea.App.Tna(),this.Gb,this.V$,
ze.hIl,this.uLa,this.CI,this.zta,this.BLa,this.Hyc,this.MTe,this.Zyb,n.AFrameworkApplication.K);Ea.App.jno(nc);this.KXn(nc);nc.init();gj.App.k6a=nc;this.L2.execute(Hc=>{Hc.Jdb(()=>{nc.XJc()})});this.$p.Bg(nc)}else k.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else k.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}KXn(Da){const nb=Na.a.instance;nb.ha("WordEditor.Presence.WordRtcProxy",
()=>Da).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").singleInstance();nb.resolve("Common.IRealtimeChannelBasic")}static hIl(){return!1}}Object(l.a)(ze,"WordRtcProxyProvider",null,[237,238]);class Kf{constructor(){this.W=null;this.am=!1}get name(){return"WordEditor.Presence"}init(){k.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");Ea.App.NLj&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").OD(),tg.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));
Ea.App.OHc&&Qh.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");if(Kf.b1g){const Da=this.W.resolve("WordEditor.IMainViewModeManager");Da.tzb(this.MWf);Kf.yGe=1===Da.fu}}dispose(){if(!this.am){this.am=!0;tg.OD().continueWith(()=>{Dd.a.YB(tg.OD().result)});var Da=this.W.resolve("Box4.Presence.MyPresenceUser");Da&&Da.zgc&&Da.zgc.L2n(tg.ZWi)}}xc(Da){this.W=Da;this.W.ha("Box4.Presence.MyPresenceUser",()=>new jb).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").singleInstance();
Da.ha("WordEditor.Presence.IWordPresenceCpFactory",()=>new tl(Da.resolve("Box4.CpConversionManagerImpl"),Da.resolve("Box4.IContentControlReader"))).singleInstance();Da.ha("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new jd(new X.a(()=>Ea.App.rd),zf.a.instance,Da.resolve("WordEditor.Presence.WordRtcProxyProvider").POc(),Da.resolve("Box4.Presence.IMyPresenceUser"))).singleInstance();Da.ha("WordEditor.Presence.WordRtcProxyProvider",()=>new ze(n.AFrameworkApplication.buildVersion,Ea.App.xa.Hq,
Mb.a.instance,()=>n.AFrameworkApplication.Nk,Na.a.instance.resolve("Box4.Presence.IMyPresenceUser"),Na.a.instance.Na("WordEditor.ParagraphWordIdMapping"),Na.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>n.AFrameworkApplication.ta&&Ea.App.xa.ib&&Ea.App.xa.ib.Uc?Ea.App.xa.ib.Uc.od:null,Tg.instance,()=>Na.a.instance.Na("WordEditor.IStatusBarUser"),Na.a.instance.Sa("Common.ISessionExpirationManager"),Na.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),
n.AFrameworkApplication.K)).singleInstance().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");Da.ha("Box4.Presence.PresenceControlProvider",()=>new am(Kf.Ffl(),ud.a.instance,Na.a.instance.Sa("Common.IZoomManager"),Na.a.instance.resolve("Box4.ICoauthCashTelemetry"),za.a.zp(Na.a.instance.Sa("Common.ISystemInitiatedFeedbackWithTimeLapse")),n.AFrameworkApplication.K,Da.resolve("Common.IPeopleInfoProvider"))).singleInstance();Da.ha("Common.App.Presence.AwayManager",()=>new He(Na.a.instance.resolve("Common.IPresenceUser"),
Na.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").POc(),tg.Q9l(),Na.a.instance.resolve("Common.IPresenceConverter"),Mb.a.instance,n.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:n.AFrameworkApplication.K.mc("AwayCoauthorThresholdMs",9E5),Object(f.a)(n.AFrameworkApplication.va,n.AFrameworkApplication.va.processAction,"processAction"),Ea.App.xa.notificationBar,n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).singleInstance();Da.ha("WordEditor.Presence.WordPresenceStatusProvider",
()=>new ce(za.a.zp(Na.a.instance.Sa("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").singleInstance();Da.ha("Common.App.Presence.PeopleInfoProvider",()=>new fc(Da.resolve("WordEditor.Presence.WordRtcProxyProvider").POc(),Ea.App.Tna().CWR(()=>Ea.App.Tna().result.aC),Da.resolve("Common.App.People.IPeopleColorUtils"),Da.resolve("Common.IPresenceConverter"),za.a.zp(Da.Sa("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").singleInstance();Da.ha("Box4.Presence.WordPresenceDataManager",
()=>new bm(Ea.App.xa.ib.Uc.od)).as("Box4.IPresenceDataManager").singleInstance()}MWf(Da,nb){Ea.App.xa&&Ea.App.xa.kD&&(Kf.Kqd=null,Kf.yGe=1===nb.Nlb)}static get ZZi(){if(!Kf.Kqd&&Ea.App.xa&&Ea.App.xa.kD){const Da=gj.App.sn.kD;Kf.Kqd=Kf.yGe&&Kf.b1g?Da.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:Da.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return Kf.Kqd}static Ffl(){const Da=n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),nb=n.AFrameworkApplication.K.$("PresenceIgnoreEventOnExpandedTooltip"),
nc=n.AFrameworkApplication.K.$("PresenceIpWidthAdjustForFlyout"),Hc=new Uc;Hc.add(yc.multipleBrowsersImageClassName,re.getImageClassWithCluster(n.AFrameworkApplication.Wba,"MoreUsersGlyph16"));Hc.add(yc.multipleBrowserImageClusterPath,n.AFrameworkApplication.Ws);Hc.add(yc.peopleImageClassName,re.getImageClassWithCluster(n.AFrameworkApplication.Wba,Da?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Hc.add(yc.peopleImageClusterPath,n.AFrameworkApplication.Ws);Hc.add(yc.zIndex,1);Hc.add(yc.rtl,
n.AFrameworkApplication.isRtl);Hc.add(yc.viewportBoundsCallback,Kf.Djm);Hc.add(yc.ignoreEventOnExpandedTooltip,nb);Hc.add(yc.ipWidthAdjustForFlyout,nc);return Da?new Ig(Hc):new Pm(Hc)}static Djm(){return Kf.ZZi?Qg.a.getElementBounds(Kf.ZZi):null}}Kf.yGe=!0;Kf.b1g=n.AFrameworkApplication.K.$("FlippedFlyoutForPaginationViewIsEnabled");Kf.Kqd=null;Object(l.a)(Kf,"WordPresencePackage",null,[1,2]);var rj=c(1041),Ij=c(1405),ai=c(1046),gg=c(186);class ol{constructor(Da,nb){this.PZe=Da;this.paragraphId=nb}get opType(){return 2}get operation(){return this.PZe}}
Object(l.a)(ol,"RttAppliedAddParagraphOp",null,[239]);class oi{constructor(Da,nb){this.O4n=Da;this.paragraphId=nb}get opType(){return 6}get operation(){return this.O4n}}Object(l.a)(oi,"RttAppliedReplaceSymbolRangeOp",null,[239]);class Hm{constructor(Da,nb){this.S4n=Da;this.paragraphId=nb}get opType(){return 1}get operation(){return this.S4n}}Object(l.a)(Hm,"RttAppliedReplaceTextRangeOp",null,[239]);class An{constructor(Da,nb,nc){this.cvj=Da;this.Qje=nb;this.UIc=nc}get opType(){return 4}get operation(){return this.cvj}get bqk(){return this.cvj.e4b()?
this.UIc:this.Qje}}Object(l.a)(An,"RttAppliedSplitParagraphOp",null,[239]);class vg{constructor(){this.l9a=new Ib.a}aIf(Da){return Da.toString()}LDc(Da,nb){Da=this.aIf(Da);this.l9a.mb(Da)||this.l9a.Z(Da,new Q.a);this.l9a.J(Da).add(nb)}pVf(Da){switch(Da.opType){case 1:var nb=Object(y.a)(Hm,Da);this.LDc(nb.paragraphId,Da);break;case 6:nb=Object(y.a)(oi,Da);this.LDc(nb.paragraphId,Da);break;case 4:nb=Object(y.a)(An,Da);this.LDc(nb.Qje,Da);this.LDc(nb.UIc,Da);break;case 2:nb=Object(y.a)(ol,Da),this.LDc(nb.paragraphId,
Da)}}Npn(Da){return this.jmb(Da)}jmb(Da){Da=this.aIf(Da);if(!this.l9a.mb(Da))return new Q.a;const nb=this.l9a.J(Da);this.l9a.remove(Da);for(const nc of nb)nc.operation&&(nc.operation.s7=null);return nb}E6l(Da){let nb;return({value:nb}=this.l9a.Dc(this.aIf(Da),nb)).returnValue?nb:new Q.a}hMl(Da){for(const nb of this.l9a.values){if(!nb.count)continue;if(2!==nb.J(0).opType)continue;const nc=nb.J(0);if(nc.PZe.aRf===Da)return nc}return null}}Object(l.a)(vg,"RttAppliedOpTracker",null,[229]);var sk=c(243),
Ti;(function(Da){Da[Da.xzl=0]="expired";Da[Da.ggp=1]="dried"})(Ti||(Ti={}));Object(l.b)("RemoveChangeReason",Ti);class Tf{constructor(){this.uza=new sk.a}Rrk(Da){if(!Da)return k.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const nb=Da.Lc,nc=Da.uj;this.uza.mb(nb)||this.uza.add(nb,new sk.a);this.uza.J(nb).Z(nc,Da);return this.Khl(nb,nc)?(k.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",nb),this.uza.J(nb).remove(nc),
!1):!0}msf(Da,nb){if(!this.uza.mb(Da))return null;Da=this.uza.J(Da);return Da.mb(nb)?Da.J(nb):null}jRd(Da){const nb=new Q.a;for(const nc of this.uza.keys){const Hc=this.uza.J(nc);for(const bd of Hc.keys){const ee=Hc.J(bd);Da(ee)&&nb.add(ee)}}return nb}Caj(Da,nb){let nc=null;({value:nc}=this.uza.Dc(Da.Lc,nc)).returnValue?(Da.activity.qTf(Ti[nb]),nc.remove(Da.uj),nc.count||this.uza.remove(Da.Lc)):k.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",
Da.Lc,nb)}l5f(Da){this.Caj(Da,1)}o5f(Da){this.Caj(Da,0)}Khl(Da,nb){if(!this.uza.mb(Da))return!1;Da=this.uza.J(Da);if(!Da.mb(nb))return!1;for(var nc=Da.J(nb);nc;){nc=nc.i1;if(nc===nb)return!0;if(!Da.mb(nc))break;nc=Da.J(nc)}return!1}}Object(l.a)(Tf,"RttDataStore",null,[227,228]);var dm=c(284),je=c(96),Xi=c(272),Fk=c(16);class wg{constructor(Da,nb){this.m7d=(nc,Hc)=>{4===this.Gp.opType?k.ULS.shipAssertTag(9204866,355,12===Hc.node.type||11===Hc.node.type,"Unexpected graph modification detected during RTT edit"):
k.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.jmb=()=>{k.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")};this.lVi=()=>{k.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.Gp=Da;if(this.pq=nb)Da=this.pq.Ze(12),Da.$t(this.m7d),Da.Ax(this.jmb),Da.Go(this.lVi)}dispose(){if(this.pq){const Da=this.pq.Ze(12);Da.SU(this.m7d);Da.bqa(this.jmb);Da.TU(this.lVi)}}}Object(l.a)(wg,
"GraphChangeValidator",null,[10]);class bg{constructor(Da,nb,nc,Hc){this.id=Da;this.cpBegin=nb;this.cpEnd=nc;this.FVk=Hc}t2o(Da){var nb=this.id===Da.id;nb&&(nb=this.FVk.replace("\u00a0"," "),Da=Da.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),nb=nb===Da);return nb}}Object(l.a)(bg,"RttOpValidator",null,[262]);class vh{constructor(Da,nb){this.s7=this.o8a=this.activity=null;this.opType=Da;this.metadata=nb}dvf(){return""}serialize(){return null}}Object(l.a)(vh,"RttOp",
null,[236]);class Ej extends vh{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc){super(Vc,af);this.Lc=Da;this.uj=nb;this.xR=nc;this.D4=Hc;this.i1=bd;this.Rpb=ee;this.BH=ic}pNh(){return this.xR.isEqual(this.D4,!0)?new Ee.a(0,this.Lc,this.uj,this.xR,void 0,void 0,void 0,this.BH):new Ee.a(1,this.Lc,this.uj,this.xR,this.Lc,this.uj,this.D4,this.BH)}static yCj(Da){let nb,nc;var Hc=Da.eT;if(1===Hc.Nce&&(Hc.TRa!==Hc.FGa||Hc.w7a!==Hc.ylc))return k.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),
nc=nb=null,Da=Hc=-1,{returnValue:!1,xR:nc,D4:nb,Lc:Da,uj:Hc};if(Hc.BH)return nc=nb=null,Da=Hc=-1,{returnValue:!1,xR:nc,D4:nb,Lc:Da,uj:Hc};nb=nc=Hc.xR;1===Hc.Nce&&(nb=Hc.D4);Da=Hc.TRa;Hc=Hc.w7a;return{returnValue:!0,xR:nc,D4:nb,Lc:Da,uj:Hc}}}Object(l.a)(Ej,"RttReplaceRangeOp",vh,[]);var im=c(1403),Nd=c(382),Qn=c(580);class Cd extends Qn.a{constructor(){super();this.RttStatusRecords=this.FileId=null}fl(){return 110}static eba(Da,nb){const nc=new Cd;nc.FileId=Da;nc.RttStatusRecords=nb;return nc}}Object(l.a)(Cd,
"RttStatusRequest",Qn.a,[]);class pl{}Object(l.a)(pl,"RttStatusOp",null,[]);class Xf{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(l.a)(Xf,"WireRttStatusOpRecord",null,[]);class yg extends Nd.a{constructor(){super();const {App:Da}=c(156);this.WYb=new Q.a;this.bRe=new Q.a;this.ik=new im.a(n.AFrameworkApplication.K.mc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=
1;Da.j1.register(this)}zSj(){const Da=Date.now();for(const nb of this.WYb)nb.cLb&&1===nb.cLb&&(nb.cLb=2,nb.timeToRender=Da-nb.metadata.Cjg)}mqe(Da){const nb=new pl;nb.metadata=Da.operation.metadata;nb.opType=Da.opType;nb.cLb=1;this.WYb.add(nb)}get Tha(){return"RttStatusReplicator"}X3(){return this.ee&&2===this.ee.status?!0:1===this.enabled&&this.ik.JX()?this.RD():!1}RD(){for(const Da of this.WYb)if(Da.cLb&&2===Da.cLb)return!0;return!1}DSa(){if(1===this._state){this._state=3;const nb=this.WYb.toArray().filter(nc=>
2===nc.cLb);var Da=this.L$k(nb);Da=Cd.eba(n.AFrameworkApplication.rootQuerySignature,Da);nb.forEach(nc=>this.WYb.remove(nc));nb.forEach(nc=>this.bRe.add(nc));this.ee.Eq=Da;this.ee.IG="RttStatusRequest";this.ee.status=1}else 3===this._state&&this.ee&&2===this.ee.status&&(this.ik.v1(),2!==this.ee.statusCode&&this.WYb.PC(0,this.bRe),this.bRe.clear(),this._state=1)}L$k(Da){const nb=[];Da.forEach(nc=>{const Hc=new Xf;Hc.clientId=nc.metadata.clientId;Hc.clientType=nc.metadata.clientType;Hc.packetId=nc.metadata.packetId;
Hc.packetVersion=nc.metadata.packetVersion;Hc.strictlySequentialId=nc.metadata.strictlySequentialId;Hc.contentType=nc.opType;Hc.contentState=nc.cLb;Hc.timeToRender=nc.timeToRender;nb.push(Hc)});return nb}Pjc(){return!0}cF(){}forceOutbound(){}}Object(l.a)(yg,"RttStatusReplicator",Nd.a,[]);class cb{constructor(Da,nb,nc,Hc,bd,ee){this.packetId=Da;this.clientId=nb;this.clientType=nc;this.Cjg=Hc;this.packetVersion=bd;this.strictlySequentialId=ee}static create(Da){let nb=null;null!=Da.strictlySequentialId&&
(nb=Da.strictlySequentialId);return new cb(Da.packetId,Da.clientId,Da.client,Date.now(),Da.version,nb)}}Object(l.a)(cb,"RttOpMetadata",null,[]);class Hb extends vh{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc){super(4,Vc);this.i1=0;this.Lc=Da;this.uj=nb;this.offset=nc;this.BH=Hc;this.Jpg=bd;this.hjg=ee;this.Mpe=ic;this.ijg=af;this.Jpg===this.Lc?this.i1=this.hjg:this.Mpe===this.Lc?this.i1=this.ijg:(k.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.i1=0)}e4b(){return this.Lc===
this.Mpe}get PJo(){return this.i1}get W5o(){return this.e4b()?this.Jpg:this.Mpe}get Zyj(){return this.e4b()?this.hjg:this.ijg}serialize(){const Da=new Ee.a(3,this.Lc,this.uj,this.offset,null,null,null,this.BH),nb=new Qc(this.Jpg,this.hjg,this.Mpe,this.ijg);return new Lb(this.metadata.packetId,this.metadata.clientId,1,4,Da,null,void 0,void 0,void 0,void 0,nb,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const nb=Da.eT,nc=Da.yPb;return new Hb(nb.TRa,nb.w7a,nb.xR,nb.BH,nc.VXf,nc.gjg,
nc.WXf,nc.jjg,cb.create(Da))}static Jbm(Da,nb,nc){if(1!==Da.type)return null;const Hc=nc.VRa(Da.E4.characterData,Da.E4.pa);return new Hb(Da.E4.Lc,Da.E4.uj,nc.Enc(Hc,Da.Puj),Da.BH,Da.czb.Lc,Da.czb.uj,Da.lFc.Lc,Da.lFc.uj,nb)}}Object(l.a)(Hb,"RttSplitParagraphOp",vh,[224,236]);class bc{constructor(Da,nb,nc,Hc){this.Kln=()=>{this.txb.zSj()};this.bka=Da;this.dyc=nb;this.Fka=nc;this.lyb=Hc;null!=n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",
!1)&&(this.txb=new yg,dm.GraphTransactionManager.instance.Tph(this.Kln))}ZFk(Da,nb,nc,Hc=null){if(nb.isDirty)return Hc&&Hc.properties.Z(bc.n0i,"1"),!1;const bd=new wg(Da,nb.qj);try{if(1===Da.opType||6===Da.opType){const af=Object(y.a)(Ej,Da),Vc=this.z6k(af,nb);var ee=Vc.node.characterData;const Mg=10<=Vc.cpBegin?Vc.cpBegin-10:0;let We=Vc.cpEnd+10<=ee.length?Vc.cpEnd+10:ee.length;const Jh=ee.substr(Mg,Vc.cpBegin-Mg),pi=ee.substr(Vc.cpEnd,We-Vc.cpEnd);We=We+af.Rpb.length-(Vc.cpEnd-Vc.cpBegin);var ic=
new bg(Vc.node.id,Mg,We,Jh+af.Rpb+pi);const Yj=6===af.opType;ee="";Yj&&(ee=af.font);if(!this.z4n(Vc,af.Rpb,Yj,ee,Hc))return!1;let Zk;Zk=1===Da.opType?new Hm(af,nb.id):new oi(af,nb.id);nb.$ma=Da.i1;af.o8a=ic;Da.s7=Zk;nc.pVf(Zk);null!=this.txb&&this.txb.mqe(Zk)}else return 4===Da.opType?this.YFk(Da,nb,nc):!1}finally{bd&&bd.dispose()}return!0}YFk(Da,nb,nc){const Hc=Object(y.a)(Hb,Da);var bd=this.lyb.VRa(nb.characterData,nb.pa);bd=this.lyb.sBb(bd,Hc.offset);if(!this.NBi(ac.a.createTextRange(nb,0,Db.ParagraphReader.textLength(nb))))return!1;
var ee=Bd.GraphIterator.$a(nb);ee.zb(10);if(this.zbc(ee))return!1;let ic;ee=this.Fka.Oc(3);try{ee.Cb(nb);const af=nb.NY();try{const Vc=Bd.GraphIterator.$a(nb);Vc.zb(10);Vc.jd(11);let Mg=Vc.currentNode;Hc.e4b()&&(Vc.yDf?Mg=null:(Vc.pJ(),Mg=Vc.currentNode));Vc.wc();const We=this.dyc.wfb();Vc.JH(We,Mg,89);Vc.sj(We);ic=nb.clone();const Jh=ic.NY();try{ic.setValue(td.a.Lc,Hc.W5o);ic.setValue(td.a.uj,Hc.Zyj);ic.isDirty=!1;Vc.Af(ic,2);Vc.sj(ic);this.v8k(nb,ic);const pi=Hc.e4b()?ic:nb,Yj=Hc.e4b()?nb:ic;pi.iO=
!0;Yj.iO=!0;this.bka.X6f(this.jDa(pi,bd,Db.ParagraphReader.textLength(pi)),"",!1,"");this.bka.X6f(this.jDa(Yj,0,bd),"",!1,"");nb.$ma=Hc.PJo;ic.$ma=Hc.Zyj}finally{Jh&&Jh.dispose()}}finally{af&&af.dispose()}ee.ZSa()}finally{ee&&ee.dispose()}nb=new An(Hc,nb.id,ic.id);Da.s7=nb;nc.pVf(nb);null!=this.txb&&this.txb.mqe(nb);return!0}zbc(Da){const nb=new Bd.GraphIterator;nb.Zc(Da);nb.jd(11);return je.ListItemReader.yg(nb)?(k.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}XDl(Da,
nb,nc){var Hc=nb.Zhb(Da.Lc);if(Hc.equals(Mc.a.nil))return null;Hc=nc.Db(Hc);if(!Hc||!Db.ParagraphReader.Wb(Hc)||!Hc.isConnected)return null;const bd=Bd.GraphIterator.$a(Hc);if(!bd.zb(23))return null;if(Da.Ipg){Da=nb.Zhb(Da.Ipg);if(Da.equals(Mc.a.nil))return null;nc=nc.Db(Da);if(!nc||!Db.ParagraphReader.Wb(nc)||!nc.isConnected)return null;nc=Bd.GraphIterator.$a(nc);if(!nc.zb(23))return null;nc.jd(11);nc.pJ();nc.Pd();if(nc.currentNode!==Hc)return null}return this.zbc(bd)?null:bd}dPo(Da,nb,nc,Hc){const bd=
nb.currentNode,ee=this.Fka.Oc(3);try{ee.Cb(bd);nb.jd(11);const ic=nb.currentNode;nb.wc();const af=this.dyc.wfb();nb.JH(af,ic,89);nb.sj(af);const Vc=Xi.a.instance.createInstance(393230),Mg=Vc.NY();try{Vc.setValue(Fk.a.lo,""),Vc.xFa=!0,Hc.bNb(Vc),Hc=[0],Vc.setValue(td.a.nq,Hc),Vc.setValue(td.a.ft,Hc),Vc.xFa=!1,Vc.setValue(td.a.Lc,Da.aRf),Vc.setValue(td.a.uj,Da.$Qf),Vc.isDirty=!1,nb.Af(Vc,2),Vc.iO=!0,Vc.$ma=Da.$Qf}finally{Mg&&Mg.dispose()}ee.ZSa();Da.s7=new ol(Da,Vc.id);nc.pVf(Da.s7);null!=this.txb&&
this.txb.mqe(Da.s7)}finally{ee&&ee.dispose()}return!0}jDa(Da,nb,nc){return nb===nc?ac.a.Qc(Da,nb):ac.a.createTextRange(Da,nb,nc)}z4n(Da,nb,nc,Hc,bd=null){const ee=Da.node;if(Da.cpBegin!==Da.cpEnd&&!this.NBi(Da))return bd&&bd.properties.Z(bc.yEj,"1"),!1;bd=this.Fka.Oc(3);try{bd.Cb(ee);const ic=ee.NY();try{ee.iO=!0,this.bka.X6f(Da,nb,nc,Hc)}finally{ic&&ic.dispose()}bd.ZSa()}finally{bd&&bd.dispose()}return!0}v8k(Da,nb){nb.xFa=!0;nb.qqa(Da.characterData);nb.$ma=Da.$ma;nb.pa.clear();for(var nc=0;nc<Da.pa.length;nc++){const Hc=
Da.pa.J(nc).pma(nb);nb.pa.add(Hc)}nb.Yl();if(nb.xe.length)for(Da=0;Da<nb.pa.length;Da++){if((nc=nb.pa.J(Da).formatting)&&-1!==nc.qe)for(;nb.xe.length<=nc.qe;)nb.xe.VX(nb.xe.length-1,256)}else k.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");nb.xFa=!1}AHf(Da){Da=Bd.GraphIterator.$a(Da);Da.zb(23);Da.wc();return{returnValue:89===Da.role,iterator:Da}}Y5f(Da){const nb=new Bd.GraphIterator;nb.Zc(Da);nb.wc();const nc=this.Fka.Oc(3);try{nc.Cb(nb.currentNode),
Da.xg()}finally{nc&&nc.dispose()}}a_n(Da){if(Da.anchor)if(({iterator:nb}=this.AHf(Da)).returnValue)this.Y5f(nb);else{var nb=Da.Kc.km;var nc=this.Fka.Oc(3);try{nc.Cb(Da),Da.load(nb.Db(Da.id)),Da.anchor.WX(4)}finally{nc&&nc.dispose()}}}w8f(Da,nb,nc){for(let ee=nb.count-1;0<=ee;ee--){var Hc=nb.J(ee);switch(Hc.opType){case 4:Hc=Object(y.a)(An,Hc);if(!Da.id.equals(Hc.Qje)){k.ULS.shipAssertTag(9204885,355,Da.id.equals(Hc.UIc));continue}Hc=nc.Db(Hc.UIc);if(!Hc)break;if(!Hc||!Db.ParagraphReader.Wb(Hc)){k.ULS.shipAssertTag(9204886,
355,!1);break}if(!Hc.isConnected)continue;var bd=({iterator:Hc}=this.AHf(Hc)).returnValue;k.ULS.shipAssertTag(9204887,355,bd);bd&&this.Y5f(Hc);break;case 2:(Hc=Object(y.a)(ol,Hc),Da.id.equals(Hc.paragraphId))?Da.isConnected&&(bd=({iterator:Hc}=this.AHf(Da)).returnValue,k.ULS.shipAssertTag(16820002,355,bd),bd&&this.Y5f(Hc)):k.ULS.shipAssertTag(16820001,355,!1)}}}z6k(Da,nb){const nc=this.lyb.VRa(nb.characterData,nb.pa),Hc=this.lyb.sBb(nc,Da.xR);Da=this.lyb.sBb(nc,Da.D4);return Hc===Da?ac.a.Qc(nb,Hc):
ac.a.createTextRange(nb,Hc,Da)}NBi(Da){const nb=Da.node.pa,nc=Da.cpBegin;Da=Da.cpEnd;for(let Hc=0;Hc<nb.length;Hc++){const bd=nb.J(Hc);if(bd.cp>=Da)break;if(bd.cp>=nc){if(bd.rf)return k.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(bd.blob)return k.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(bd.ed||bd.rkb||bd.Fac)return k.ULS.sendTraceTag(8242649,355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}
bc.n0i="ParagraphAlreadyDirty";bc.yEj="UnsafeWetChange";Object(l.a)(bc,"RttEditor",null,[226]);var Cc=c(20),Kc=c(1451),kd=c(247);class Wd{constructor(){this.ged=new Q.a}add(Da){this.ged.add(Da);return!0}jRd(Da){const nb=new Q.a;for(const nc of this.ged)Da(nc)&&nb.add(nc);return nb}l5f(Da){Da.activity.qTf("dried");this.ged.remove(Da)}o5f(Da){Da.activity.qTf("expired");this.ged.remove(Da)}}Object(l.a)(Wd,"RttAddParagraphDataStore",null,[]);class ve extends vh{constructor(Da,nb,nc,Hc,bd,ee,ic,af){super(2,
af);this.Lc=Da;this.uj=nb;this.i1=nc;this.Ipg=Hc;this.aRf=bd;this.$Qf=ee;this.BH=ic}serialize(){const Da=new Ee.a(2,this.Lc,this.uj,null,this.Ipg,null,null,this.BH),nb=new Sb(this.i1,this.aRf,this.$Qf);return new Lb(this.metadata.packetId,this.metadata.clientId,1,3,Da,null,void 0,void 0,nb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const nb=Da.eT,nc=Da.C0b;let Hc=null;null!=Da.eT.FGa&&(Hc=Da.eT.FGa);return new ve(nb.TRa,nb.w7a,nc.kjg,Hc,nc.YXf,nc.i1,nb.BH,cb.create(Da))}static Fbm(Da,
nb){return 3!==Da.type?null:new ve(Da.qpa.Lc,Da.qpa.uj,Da.lhn.uj,Da.BRa?Da.BRa.Lc:null,Da.mxa.Lc,Da.mxa.uj,Da.BH,nb)}}Object(l.a)(ve,"RttAddParagraphOp",vh,[]);class Ie{constructor(Da){this.vV=Da}o8i(){this.vV&&this.vV.properties.Z(Ie.fZh,"1")}JRn(Da){this.vV&&(this.vV.properties.mb(Ie.sOf)||this.vV.properties.Z(Ie.sOf,(Da-this.vV.startTime).toString()))}qTf(Da){this.vV&&(this.vV.properties.Z(Ie.Xbj,Da),this.vV.end())}jTn(Da){this.vV&&this.vV.properties.Z(Ie.p_i,Da.toString())}iTn(Da){this.vV&&this.vV.properties.Z(Ie.LZi,
Da)}static Lzf(Da){Da.g5(eg.a.MNb,Ie.fZh,Kc.a.ixj);Da.g5(eg.a.MNb,Ie.MAl,Kc.a.ixj);Da.g5(eg.a.MNb,Ie.sOf,Kc.a.NJk);Da.g5(eg.a.MNb,Ie.Xbj,Kc.a.Aua);Da.g5(eg.a.MNb,Ie.p_i,Kc.a.Aua);Da.g5(eg.a.MNb,Ie.LZi,Kc.a.Aua)}static create(Da){if(!Da)return null;Da=Da.yp(eg.a.MNb,Ie.N4o);return new Ie(Da)}}Ie.fZh="FailedToFindInitialParaID";Ie.MAl="FailedToFindInitialTextID";Ie.sOf="MsecUntilApplied";Ie.Xbj="RemovedBecause";Ie.p_i="PacketVersions";Ie.LZi="OperationType";Ie.N4o=48E4;Object(l.a)(Ie,"RttOpActivity",
null,[]);var yf;(function(Da){Da[Da.unknown=0]="unknown";Da[Da.Mmp=1]="replaceTextRangeOp";Da[Da.Jdp=2]="addParagraphOp";Da[Da.Hfp=3]="deleteParagraphOp";Da[Da.Lop=4]="splitParagraphOp";Da[Da.tkp=5]="mergeParagraphOp";Da[Da.Lmp=6]="replaceSymbolRangeOp"})(yf||(yf={}));Object(l.b)("RttOpType",yf);var gc=c(122);class ff extends Ej{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc,Mg,We){super(Hc,bd,ee,ic,af,Vc,Mg,We,6);this.font=Da;this.legacy=nb}dvf(){return"OffsetStart: "+this.xR+"OffsetEnd: "+this.D4}serialize(){const Da=
this.pNh();return new Lb(this.metadata.packetId,this.metadata.clientId,1,7,Da,null,this.i1,this.Rpb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){let nb,nc,Hc,bd;if(!({xR:nb,D4:nc,Lc:Hc,uj:bd}=Ej.yCj(Da)).returnValue)return null;let ee,ic;if(1===Da.text.length)ee=!1,ic=gc.AParagraphNode.DC;else if(2===Da.text.length)if(Qb.a.kyi(Da.text,0)&&Qb.a.yz(Da.text,1))ee=!0,ic=Da.text;else return k.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",
Da.$s),null;else return k.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Da.$s),null;const af=Da.d$c,Vc=cb.create(Da);return new ff(af.Khg,af.Lhg,ee,Hc,bd,nb,nc,Da.gQb,ic,Da.eT.BH,Vc)}}Object(l.a)(ff,"RttReplaceSymbolRangeOp",Ej,[224,236]);class Gk extends Ej{constructor(Da,nb,nc,Hc,bd,ee,ic,af){super(Da,nb,nc,Hc,bd,ee,ic,af,1)}dvf(){return"OffsetStart: "+this.xR+"OffsetEnd: "+this.D4+"TextAddedLength: "+this.Rpb.length}serialize(){const Da=
this.pNh();return new Lb(this.metadata.packetId,this.metadata.clientId,1,2,Da,null,this.i1,this.Rpb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){let nb,nc,Hc,bd;if(!({xR:nb,D4:nc,Lc:Hc,uj:bd}=Ej.yCj(Da)).returnValue)return null;let ee="";Da.text&&(ee=Da.text);const ic=cb.create(Da);return new Gk(Hc,bd,nb,nc,Da.gQb,ee,Da.eT.BH,ic)}static Ham(Da,nb,nc){if(Da.type)return null;const Hc=nc.VRa(Da.E4.characterData,Da.E4.pa);return new Gk(Da.E4.Lc,Da.E4.uj,nc.Enc(Hc,
Da.cpBegin),nc.Enc(Hc,Da.cpEnd),Da.mxa.uj,Da.i9,Da.BH,nb)}}Object(l.a)(Gk,"RttReplaceTextRangeOp",Ej,[224,236]);class Sh{constructor(Da,nb,nc,Hc,bd,ee,ic,af,Vc,Mg,We,Jh,pi,Yj,Zk,sj,tk,Qm,Li){this.Cl=null;this.VGe=this.Glh=!1;this.hid=!0;this.P8g=0;this.jfh=this.WRe=this.lfh=this.ifh=this.kfh=!1;this.XVf=()=>{k.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Cl=this.HZ.result;k.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Cl.g3(this.A0)};this.A0=
(km,Kg)=>{if(3===Kg.type||10===Kg.type)if(10===Kg.type)this.P8g="boolean"===typeof Kg.yL?Kg.yL?1:0:Kg.yL;else if(this.mXb.value&&!this.mXb.value.mVd)k.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(Kg.yL){if(this.wTn(),(km=this.Kll(Kg.yL))&&1!==km.metadata.clientType){this.vTn();if(!(!this.Vo||this.Vo.qca||Cc.a.cQa||Cc.a.pca||(n.AFrameworkApplication.ue("1i00j689;ba0dg262"),Cc.a.cQa||Cc.a.pca)))return;if(2!==this.P8g)switch(this.hid&&(this.VYb.w8i(),
this.hid=!1),this.Glh||this.Sym(),km.opType){case 1:case 6:case 4:if(!({Ag:km}=this.Srk(km)).returnValue)break;this.Vih?this.Nhj(km):this.EDj(km);break;case 2:this.Loc.add(km),this.$qi(km),this.Vih?this.Nhj(Mc.a.nil):this.DDj(km)}}}else k.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")};this.wzl=()=>{const km=this.mi.value;if(km){var Kg=this.qD()-Sh.m_n,sf=this.Gsb.jRd(oe=>oe.metadata.Cjg<Kg);0<sf.count&&this.KRn();var he=new kd.a;for(const oe of sf)if(this.Gsb.o5f(oe),oe.s7)switch(oe.s7.opType){case 1:he.add(oe.s7.paragraphId.toString());
break;case 6:he.add(oe.s7.paragraphId.toString());break;case 4:he.add(oe.s7.Qje.toString()),he.add(oe.s7.UIc.toString())}sf=this.Loc.jRd(oe=>oe.metadata.Cjg<Kg);for(const oe of sf)this.Loc.o5f(oe),oe.s7&&he.add(oe.s7.paragraphId.toString());for(const oe of he)(he=km.Db(Mc.a.Ef(oe)))?he.iO?(this.sxb.a_n(he),he.iO||this.Swc.value.kbj(he)):k.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):k.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.mi.Pxf&&
k.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.sxb=Da;this.Gsb=nb;this.Swc=nc;this.mXb=Hc;this.CI=bd;this.HZ=ee;this.mi=ic;this.Gb=af;this.qD=Vc;this.lyb=Mg;this.ud=We;this.COe=pi;this.Ic=Yj;this.Vih=Zk;this.VYb=sj;this.Grb=tk;this.fYe=Qm;this.Uyc=new L.a(I.a.Fh());this.Loc=new Wd;Jh.execute(Sh.Lzf);this.Vo=Li}Sym(){const Da=new pa.a(3,2,Sh.o1n,this.wzl);this.Gb.Vb(Da);this.Glh=!0}init(){return this.HZ?this.HZ.continueWith(this.XVf):E.Task.P3(!1)}Kll(Da){Da=
Rc(Da);if(!Da)return null;switch(Da.$s){case 2:return Gk.create(Da);case 7:return ff.create(Da);case 4:return Hb.create(Da);case 3:return ve.create(Da);default:return k.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Da.$s),null}}Srk(Da){let nb=Mc.a.nil;if(!this.Gsb.Rrk(Da))return{returnValue:!1,Ag:nb};this.$qi(Da);if(!this.CI)return{returnValue:!1,Ag:nb};const nc=this.CI.Zhb(Da.Lc);if(nc.equals(Mc.a.nil)||!this.mi.value.Db(nc))return Da.activity.o8i(),{returnValue:!1,
Ag:nb};this.y8i();return{returnValue:!0,Ag:nc}}Nhj(Da){Da.equals(Mc.a.nil)||this.Uyc.add(Da.toString());this.VGe||(Da=new pa.a(0,1,200,()=>{this.VQo();this.VGe=!1},71),this.Gb.Vb(Da),this.VGe=!0)}Sbo(Da){Da=new pa.a(0,1,0,Da,71);this.Gb.Vb(Da)}$qi(Da){Da.activity=Ie.create(this.ud);Da.activity.jTn(Da.metadata.packetVersion);Da.activity.iTn(yf[Da.opType])}VQo(){var Da=this.Loc.jRd(nc=>!nc.s7);for(const nc of Da)this.DDj(nc);if(this.Uyc.count){Da=null;for(var nb of this.Uyc){nb=Mc.a.Ef(nb);Da=this.mi.value.Db(nb);
break}nb=this.Ic.Oc(3);try{nb.Cb(Da);for(const nc of this.Uyc)this.EDj(Mc.a.Ef(nc))}finally{nb&&nb.dispose()}this.Uyc.clear()}}EDj(Da){Da=this.mi.value.Db(Da);let nb;const nc=this.Ic.Oc(3);try{nc.Cb(Da);nb=this.ud.yp(eg.a.ouh);const Hc=this.tuh(Da,nb);nb.end();Hc&&this.Quk(Hc)}finally{nc&&nc.dispose(),this.VYb.E3f(1),this.hid=!0}}DDj(Da){var nb=this.sxb.XDl(Da,this.CI,this.mi.value);nb&&(this.y8i(),this.sxb.dPo(Da,nb,this.Grb,Na.a.instance.resolve("Box4.IParagraphEditor"))&&(nb=this.mi.value.Db(Da.s7.paragraphId),
this.Muh(nb,Da),this.VYb.E3f(1),this.hid=!0))}Quk(Da){this.COe.continueWith(()=>{if(1===Da.opType){var nb=this.M9l(Da);nb&&(this.COe.result.OZe(nb),this.COe.result.Vde(!0))}})}M9l(Da){const nb=Da.serialize();if(2!==nb.$s||nb.eT.FGa&&nb.eT.TRa!==nb.eT.FGa)return null;const nc=Da.xR.clone();0<Da.Rpb.length&&(nc.OEh(),nc.cp+=Da.Rpb.length);nb.$s=0;nb.text=null;nb.eT.Nce=0;nb.eT.xR=nc;nb.eT.w7a=nb.gQb;nb.eT.FGa=null;nb.eT.ylc=null;nb.eT.D4=null;nb.gQb=null;return mc.Qaf(nb,this.CI,this.lyb,()=>this.mi.value,
this.fYe.instance)}Muh(Da,nb){return this.Swc.value?this.Swc.value.Dqk(Da,nb.metadata.clientId).returnValue?!0:(k.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(k.ULS.shipAssertTag(7866378,355,!!this.Swc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}suh(Da,nb){this.tuh(Da,nb)}tuh(Da,nb){if(!Da)return null;if(!Da.anchor)return nb&&nb.properties.Z(Sh.GRi,"1"),null;if(!Da.hasProperty(td.a.Lc))return k.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),
null;if(!Da.hasProperty(td.a.uj))return k.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(Da.hasProperty(td.a.ySh)&&Da.getValue(td.a.ySh))return k.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const nc=Da.getValue(td.a.Lc);var Hc=Da.$ma;nb&&(nb.properties.Z(Sh.iin,Hc.toString()),nb.properties.Z(Sh.kin,nc.toString()));Hc=this.Gsb.msf(nc,Hc);if(!Hc)return nb&&nb.properties.Z(Sh.sRi,"1"),null;if(!this.Muh(Da,Hc))return nb&&nb.properties.Z(Sh.nKh,
"1"),null;let bd=0,ee=null;for(;Hc;){if(!this.sxb.ZFk(Hc,Da,this.Grb,nb)){nb&&nb.properties.Z(Sh.$Kj,"1");break}bd++;Hc.activity.JRn(this.qD());ee=Hc;Hc=Da.$ma;Hc=this.Gsb.msf(nc,Hc)}0<bd&&this.U7i();nb&&nb.properties.add(Sh.aLj,bd.toString());return ee}Cde(Da){if(Da.hasProperty(td.a.Lc)&&Da.hasProperty(td.a.uj)){var nb=Da.getValue(td.a.Lc),nc=Da.ia(td.a.uj,0),Hc=this.ud.yp(eg.a.p$i),bd=this.Grb.Npn(Da.id);0<bd.count&&(this.sxb.w8f(Da,bd,this.mi.value),this.J_n(Da,bd,nc));var ee=this.Grb.hMl(nb);
if(ee&&!Da.id.equals(ee.paragraphId)){const ic=this.mi.value;this.Sbo(()=>{const af=this.Grb.jmb(ee.paragraphId),Vc=ic.Db(ee.paragraphId);k.ULS.shipAssertTag(16820032,355,!!Vc,"Could not find added graph node");Vc&&(this.sxb.w8f(Vc,af,ic),this.Loc.l5f(ee.PZe))})}this.Gsb.msf(nb,nc)||this.Swc.value.kbj(Da);this.suh(Da,Hc);Hc.end()}}J_n(Da,nb,nc){let Hc=!1;for(let ee=nb.count-1;0<=ee;ee--){var bd=nb.J(ee);switch(bd.opType){case 1:case 6:case 4:bd=Object(y.a)(224,bd.operation);break;default:continue}bd.i1===
nc&&(Hc=!0,bd.o8a&&!bd.o8a.t2o(Da)&&k.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",bd.opType,bd.dvf(),Da.id,bd.o8a.id,bd.o8a.cpBegin,bd.o8a.cpEnd));Hc&&this.Gsb.l5f(bd)}Hc&&this.U7i()}h0c(Da){const nb=this.Grb.jmb(Da.id);0<nb.count&&(2===nb.J(0).opType&&nb.removeAt(0),this.sxb.w8f(Da,nb,this.mi.value))}lie(Da){var nb=this.Grb.E6l(Da.id);for(const nc of nb)if(4===nc.opType&&
(nb=Object(y.a)(An,nc),Da.id.equals(nb.bqk)))return!0;return!1}wTn(){this.kfh||(k.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.kfh=!0)}vTn(){this.ifh||(k.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.ifh=!0)}y8i(){this.lfh||(k.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.lfh=!0)}U7i(){this.WRe||(k.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.WRe=!0)}KRn(){this.WRe||this.jfh||(k.ULS.sendTraceTag(8185608,
355,15,"Failed to apply any wet changes so far"),this.jfh=!0)}static Lzf(Da){const nb=[eg.a.ouh,eg.a.p$i];for(const nc of nb)Da.g5(nc,Sh.aLj,Kc.a.Aua),Da.g5(nc,Sh.sRi,Kc.a.Aua),Da.g5(nc,Sh.GRi,Kc.a.Aua),Da.g5(nc,Sh.nKh,Kc.a.Aua),Da.g5(nc,Sh.$Kj,Kc.a.Aua),Da.g5(nc,bc.n0i,Kc.a.Aua),Da.g5(nc,bc.yEj,Kc.a.Aua);Ie.Lzf(Da)}}Sh.o1n=6E4;Sh.m_n=18E4;Sh.aLj="WetChangeCount";Sh.sRi="NoChangesToApply";Sh.GRi="NodeNotConnected";Sh.nKh="CouldNotGetLock";Sh.$Kj="WetChangeBlocked";Sh.kin="NodeWordId";Sh.iin="NodeTextId";
Object(l.a)(Sh,"RttManager",null,[225]);class jm{constructor(Da,nb){this.vgj=0;this.kj=Da;this.O$n=nb}w8i(){this.vgj=this.kj()}E3f(Da){const nb=this.kj()-this.vgj;0<=nb&&this.O$n.track(Math.round(nb),0===Da?"CTB":"RTP")}}Object(l.a)(jm,"RttPerfCounter",null,[223]);var Jj=c(1975);class Yd{constructor(){this.xAc=new Jj.a}vvk(Da,nb){this.xAc.back()&&nb&&this.xAc.back().Seb(Da)||this.xAc.enqueue(Da)}l5l(){return this.xAc.isEmpty?null:this.xAc.dequeue()}}Object(l.a)(Yd,"RttSendDataStore",null,[222]);class ih extends vh{constructor(Da,
nb,nc,Hc){super(3,Hc);this.Lc=Da;this.uj=nb;this.BH=nc}get i1(){return 0}serialize(){const Da=new Ee.a(4,this.Lc,this.uj,null,null,null,null,this.BH);return new Lb(this.metadata.packetId,this.metadata.clientId,1,5,Da,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const nb=Da.eT;return new ih(nb.TRa,nb.w7a,nb.BH,cb.create(Da))}static Gbm(Da,nb){return 4!==Da.type?null:new ih(Da.U4b.Lc,Da.U4b.uj,Da.BH,nb)}}Object(l.a)(ih,"RttDeleteParagraphOp",
vh,[224,236]);class mg extends vh{constructor(Da,nb,nc,Hc,bd,ee,ic,af){super(5,af);this.Hpg=Da;this.Yyj=nb;this.V5o=nc;this.QJo=Hc;this.BH=bd;this.QLj=ee;this.zlc=ic}get Lc(){return this.Hpg}get uj(){return this.Yyj}get i1(){return this.Hpg===this.QLj?this.zlc:0}serialize(){const Da=new Ee.a(5,this.Hpg,this.Yyj,null,this.V5o,this.QJo,null,this.BH),nb=new kc(this.QLj,this.zlc);return new Lb(this.metadata.packetId,this.metadata.clientId,1,6,Da,null,void 0,void 0,void 0,nb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const nb=
Da.eT,nc=Da.rZc;return new mg(nb.TRa,nb.w7a,nb.FGa,nb.ylc,nb.BH,nc.XXf,nc.zlc,cb.create(Da))}static Hbm(Da,nb){return 2!==Da.type?null:new mg(Da.qpa.Lc,Da.qpa.uj,Da.BRa.Lc,Da.BRa.uj,Da.BH,Da.D4d.Lc,Da.D4d.uj,nb)}}Object(l.a)(mg,"RttMergeParagraphOp",vh,[224,236]);class Do{constructor(Da,nb,nc,Hc,bd,ee){this.bBc=this.hj=null;this.Dea=!1;this.XVe=this.rjh=0;this.Jvd=this.Dkh=!1;this.$Qe=0;this.XVf=()=>{k.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.hj=this.HZ.result;
this.hj.mde(this)};this.LWi=(ic,af)=>{if(this.hj&&2===this.hj.connectionState&&(ic=af.jF,ic.length))if(af.z7)100>this.XVe&&(this.XVe++,k.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",af.vLk,this.rjh,this.XVe));else{for(af=0;af<ic.length;af++)if(!this.GVm(ic[af]))return;for(af=0;af<ic.length;af++){const Vc=ic[af];this.meh.vvk(Vc,!Vc.type&&!af)}this.bBc||this.oWi(this.bBc,this.hj)}};this.HZ=Da;this.meh=nb;this.fbb=nc;this.Yt=Hc;this.zta=bd;this.VYb=
ee}get vn(){return this.fbb.value}init(){return this.HZ?this.HZ.continueWith(this.XVf):E.Task.P3(!1)}start(){this.Dea||(this.Yt.Uc?(this.Yt.Uc.jF.vzk(this.LWi),this.Dea=!0):k.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.Dea&&(this.Dea=!1,this.Yt.Uc.jF.H2n(this.LWi))}GVm(Da){return Da&&-1!==Da.BH?Da.type&&3!==Da.type&&1!==Da.type?!1:!0:!1}Q7m(){this.Jvd||(this.Dkh||(k.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.Dkh=!0),!this.Jvd&&
5>=this.$Qe&&this.$Qe++)}e8m(){!this.Jvd&&5>=this.$Qe&&(k.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.Jvd=!0)}oWi(Da,nb){this.Q7m();Da&&(Da.Ai||Da.yo)&&k.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Da.exception);this.VYb.w8i();(Da=this.Ibm(this.meh.l5l()))?(this.rjh++,this.bBc=nb.bN(3,Yc(Da.serialize())),this.e8m(),this.VYb.E3f(0),this.bBc.continueWith(nc=>{this.oWi(nc,nb)})):this.bBc=null}Ibm(Da){if(!Da)return null;if(!this.vn)return k.ULS.sendTraceTag(8245957,
355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const nb=new cb(Tg.instance.xci(),this.vn.mj,1,0,0,Ne.instance.C5l());let nc=null;switch(Da.type){case 0:nc=Gk.Ham(Da,nb,this.zta);break;case 4:nc=ih.Gbm(Da,nb);break;case 3:nc=ve.Fbm(Da,nb);break;case 2:nc=mg.Hbm(Da,nb);break;case 1:nc=Hb.Jbm(Da,nb,this.zta)}return nc}}Object(l.a)(Do,"RttSendManager",null,[221]);class Eo{constructor(){this.W=null;this.j3l=()=>Ea.App.rd&&Ea.App.rd.Tp?Ea.App.rd.Tp:(k.ULS.sendTraceTag(7866377,
304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}xc(Da){const nb=za.a.zp(Da.Sa("Box4.IOutlineElementEditor")),nc=za.a.zp(Da.Sa("Box4.IFeatureHelper")),Hc=za.a.zp(Da.Sa("Common.IActivityAggregationInfo")),bd=za.a.zp(Da.Sa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),ee=za.a.zp(Da.Sa("Box4.CompositionStateManager"));this.W=Da;const ic=new wf.a;E.Task.WAA.call(null,nb,nc,Hc,bd,ee).continueWith(()=>{Da.ha("WordEditor.RealTimeTyping.IRttEditor",
()=>new bc(Da.resolve("Box4.ICharacterPropertiesEditor"),Da.resolve("Box4.IOutlineElementEditor"),ic,Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).singleInstance();Da.register(jm,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").singleInstance().Rd(()=>new jm(Qg.a.af,rj.a.eF(17,1,new Ij.a(new ai.a(.25)))));Da.ha("WordEditor.RealTimeTyping.RttManager",()=>new Sh(Da.resolve("WordEditor.RealTimeTyping.IRttEditor"),new Tf(gg.a.instance),new X.a(this.j3l),new X.a(()=>
Ea.App.iV),Da.resolve("WordEditor.ParagraphWordIdMapping"),Da.resolve("Box4.Presence.IRtcProxyProvider").OD(),new X.a(()=>Ea.App.xa.ib&&Ea.App.xa.ib.Uc?Ea.App.xa.ib.Uc.od:(k.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),Mb.a.instance,()=>Date.now(),Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),gg.a.instance,Da.Sa("Common.IActivityAggregationInfo"),tg.OD(),ic,n.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),Da.resolve("WordEditor.IRttPerfCounter"),
new vg,Da.Sa("WordEditor.Presence.IWordPresenceCpFactory"),Da.resolve("Box4.CompositionStateManager"))).as("WordEditor.RealTimeTyping.IRttManager").singleInstance();Da.ha("WordEditor.RealTimeTyping.RttSendManager",()=>new Do(Da.resolve("Box4.Presence.IRtcProxyProvider").OD(),new Yd,new X.a(()=>Ea.App.rd),Ea.App.xa.ib,Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Da.resolve("WordEditor.IRttPerfCounter"))).singleInstance();this.Mzf()})}Mzf(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();
this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){Ia.a.instance.Fc(new Eo)}}Object(l.a)(Eo,"WordEditorRealTimeTypingPackage",null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");
la.main();Type.registerNamespace("Common.App.CollabControls");eb.prototype.toString=Ga.a.prototype.toString;jb.prototype.toString=Ga.a.prototype.toString;Ia.a.instance.Fc(new Kf);Eo.main();Type.registerNamespace("RealtimePresenceUI");Ia.a.instance.Fc(new xd);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");ya.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/19794043/wdjs/WordEditorDSVersionHistoryRemoved.collab.js.map